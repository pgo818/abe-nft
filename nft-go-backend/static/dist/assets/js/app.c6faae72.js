(()=>{"use strict";var e={211:(e,t,a)=>{var s=a(130),l=a(768);const i={class:"app-container"},n={class:"navbar navbar-expand-lg navbar-light bg-light"},o={class:"container"},r={class:"collapse navbar-collapse",id:"navbarNav"},d={class:"navbar-nav me-auto"},c={class:"nav-item"},u={class:"nav-item"},m={class:"nav-item"},b={class:"nav-item"},k={key:0,class:"loading-overlay"},p={class:"main-content"};function v(e,t,a,s,v,h){const L=(0,l.g2)("router-link"),g=(0,l.g2)("wallet-connector"),y=(0,l.g2)("router-view"),f=(0,l.g2)("notifications");return(0,l.uX)(),(0,l.CE)("div",i,[(0,l.Lk)("nav",n,[(0,l.Lk)("div",o,[(0,l.bF)(L,{class:"navbar-brand",to:"/"},{default:(0,l.k6)(()=>t[0]||(t[0]=[(0,l.Lk)("i",{class:"bi bi-shield-lock me-2"},null,-1),(0,l.eW)(" NFT+ABE集成平台 ")])),_:1,__:[0]}),t[5]||(t[5]=(0,l.Lk)("button",{class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarNav"},[(0,l.Lk)("span",{class:"navbar-toggler-icon"})],-1)),(0,l.Lk)("div",r,[(0,l.Lk)("ul",d,[(0,l.Lk)("li",c,[(0,l.bF)(L,{class:"nav-link",to:"/"},{default:(0,l.k6)(()=>t[1]||(t[1]=[(0,l.Lk)("i",{class:"bi bi-house me-1"},null,-1),(0,l.eW)("首页 ")])),_:1,__:[1]})]),(0,l.Lk)("li",u,[(0,l.bF)(L,{class:"nav-link",to:"/nft"},{default:(0,l.k6)(()=>t[2]||(t[2]=[(0,l.Lk)("i",{class:"bi bi-collection me-1"},null,-1),(0,l.eW)("NFT管理 ")])),_:1,__:[2]})]),(0,l.Lk)("li",m,[(0,l.bF)(L,{class:"nav-link",to:"/abe"},{default:(0,l.k6)(()=>t[3]||(t[3]=[(0,l.Lk)("i",{class:"bi bi-shield-lock me-1"},null,-1),(0,l.eW)("ABE加密 ")])),_:1,__:[3]})]),(0,l.Lk)("li",b,[(0,l.bF)(L,{class:"nav-link",to:"/did"},{default:(0,l.k6)(()=>t[4]||(t[4]=[(0,l.Lk)("i",{class:"bi bi-person-circle me-1"},null,-1),(0,l.eW)("DID/VC ")])),_:1,__:[4]})])]),(0,l.bF)(g)])])]),s.isLoading?((0,l.uX)(),(0,l.CE)("div",k,t[6]||(t[6]=[(0,l.Lk)("div",{class:"spinner-border text-light",role:"status"},[(0,l.Lk)("span",{class:"visually-hidden"},"加载中...")],-1)]))):(0,l.Q3)("",!0),(0,l.Lk)("div",p,[(0,l.bF)(y)]),(0,l.bF)(f)])}var h=a(782),L=a(232);const g={class:"wallet-connector"},y={key:1,class:"d-flex align-items-center"},f={class:"wallet-info me-3"},D=["title"],w={key:0,class:"did-info small text-muted"},I={class:"modal fade",ref:"connectModal",tabindex:"-1"},C={class:"modal-dialog"},T={class:"modal-content"},F={class:"modal-body"},E={class:"text-center"};function _(e,t,a,s,i,n){return(0,l.uX)(),(0,l.CE)("div",g,[s.isConnected?((0,l.uX)(),(0,l.CE)("div",y,[(0,l.Lk)("div",f,[(0,l.Lk)("div",{class:"wallet-address",title:s.account},(0,L.v_)(s.shortAccount),9,D),s.did?((0,l.uX)(),(0,l.CE)("div",w,"DID: "+(0,L.v_)(s.shortDid),1)):(0,l.Q3)("",!0)]),(0,l.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>s.disconnectWallet&&s.disconnectWallet(...e)),class:"btn btn-outline-dark btn-sm"},t[4]||(t[4]=[(0,l.Lk)("i",{class:"bi bi-box-arrow-right me-1"},null,-1),(0,l.eW)("断开 ")]))])):((0,l.uX)(),(0,l.CE)("button",{key:0,onClick:t[0]||(t[0]=(...e)=>s.connectWallet&&s.connectWallet(...e)),class:"btn btn-outline-dark"},t[3]||(t[3]=[(0,l.Lk)("i",{class:"bi bi-wallet2 me-1"},null,-1),(0,l.eW)("连接钱包 ")]))),(0,l.Lk)("div",I,[(0,l.Lk)("div",C,[(0,l.Lk)("div",T,[t[7]||(t[7]=(0,l.Lk)("div",{class:"modal-header"},[(0,l.Lk)("h5",{class:"modal-title"},"连接钱包"),(0,l.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),(0,l.Lk)("div",F,[t[6]||(t[6]=(0,l.Lk)("p",{class:"text-center"},"请连接MetaMask钱包以使用平台功能",-1)),(0,l.Lk)("div",E,[(0,l.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>s.connectWallet&&s.connectWallet(...e)),class:"btn btn-primary"},t[5]||(t[5]=[(0,l.Lk)("i",{class:"bi bi-wallet2 me-1"},null,-1),(0,l.eW)("连接MetaMask ")]))])]),t[8]||(t[8]=(0,l.Lk)("div",{class:"modal-footer"},[(0,l.Lk)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消")],-1))])])],512)])}var N=a(144),x=a(387),S=a(77);const R={name:"WalletConnector",setup(){const e=(0,h.Pj)(),t=(0,x.rd)(),a=(0,N.KR)(null);let s=null;const i=(0,l.EW)(()=>e.state.wallet.isConnected),n=(0,l.EW)(()=>e.state.wallet.account),o=(0,l.EW)(()=>e.state.wallet.did),r=(0,l.EW)(()=>e.state.wallet.showConnectPrompt),d=(0,l.EW)(()=>e.state.wallet.redirectRoute),c=(0,l.EW)(()=>n.value?`${n.value.substring(0,6)}...${n.value.substring(n.value.length-4)}`:""),u=(0,l.EW)(()=>o.value?o.value.length<=20?o.value:`${o.value.substring(0,10)}...${o.value.substring(o.value.length-10)}`:""),m=async()=>{const a=await e.dispatch("wallet/connectWallet");a&&(d.value&&(t.push(d.value),e.commit("wallet/clearRedirectRoute")),s&&s.hide())},b=()=>{e.dispatch("wallet/disconnectWallet"),t.currentRoute.value.meta.requiresWallet&&t.push("/")};(0,l.wB)(r,t=>{t&&s&&(s.show(),e.commit("wallet/setShowConnectPrompt",!1))}),(0,l.sV)(async()=>{await e.dispatch("wallet/checkWalletConnection"),a.value&&(s=new S.aF(a.value),r.value&&(s.show(),e.commit("wallet/setShowConnectPrompt",!1))),window.ethereum&&(window.ethereum.on("accountsChanged",k),window.ethereum.on("chainChanged",()=>{window.location.reload()}))});const k=async a=>{0===a.length?(e.dispatch("wallet/disconnectWallet"),t.currentRoute.value.meta.requiresWallet&&t.push("/")):a[0]!==n.value&&await e.dispatch("wallet/connectWallet")};return{isConnected:i,account:n,did:o,shortAccount:c,shortDid:u,connectWallet:m,disconnectWallet:b,connectModal:a}}};var A=a(241);const M=(0,A.A)(R,[["render",_],["__scopeId","data-v-06c88956"]]),W=M,X={class:"notifications-container"},O={class:"notification-content"},q={class:"notification-message"},$=["onClick"];function P(e,t,a,i,n,o){return(0,l.uX)(),(0,l.CE)("div",X,[(0,l.bF)(s.F,{name:"notification"},{default:(0,l.k6)(()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.notifications,e=>((0,l.uX)(),(0,l.CE)("div",{key:e.id,class:(0,L.C4)(["notification",`notification-${e.type}`])},[(0,l.Lk)("div",O,[(0,l.Lk)("i",{class:(0,L.C4)([i.getIconClass(e.type),"notification-icon"])},null,2),(0,l.Lk)("span",q,(0,L.v_)(e.message),1)]),(0,l.Lk)("button",{class:"notification-close",onClick:t=>i.removeNotification(e.id)}," × ",8,$)],2))),128))]),_:1})])}const K={name:"Notifications",setup(){const e=(0,h.Pj)(),t=(0,l.EW)(()=>e.state.app.notifications),a=e=>{switch(e){case"success":return"bi bi-check-circle-fill";case"error":return"bi bi-exclamation-circle-fill";case"warning":return"bi bi-exclamation-triangle-fill";case"info":default:return"bi bi-info-circle-fill"}},s=t=>{e.commit("app/removeNotification",t)};return{notifications:t,getIconClass:a,removeNotification:s}}},U=(0,A.A)(K,[["render",P],["__scopeId","data-v-2dc93046"]]),V=U,Q={name:"App",components:{WalletConnector:W,Notifications:V},setup(){const e=(0,h.Pj)(),t=(0,l.EW)(()=>e.state.app.isLoading);return{isLoading:t}}},j=(0,A.A)(Q,[["render",v]]),B=j,G={namespaced:!0,state:{isLoading:!1,notifications:[],appTitle:"NFT+ABE集成管理平台"},mutations:{setLoading(e,t){e.isLoading=t},addNotification(e,t){const a=Date.now();e.notifications.push({id:a,type:t.type||"info",message:t.message,autoClose:!1!==t.autoClose}),!1!==t.autoClose&&setTimeout(()=>{this.commit("app/removeNotification",a)},t.duration||5e3)},removeNotification(e,t){const a=e.notifications.findIndex(e=>e.id===t);-1!==a&&e.notifications.splice(a,1)},clearNotifications(e){e.notifications=[]}},actions:{showSuccess({commit:e},t){e("addNotification",{type:"success",message:t})},showError({commit:e},t){e("addNotification",{type:"error",message:t,duration:8e3})},showInfo({commit:e},t){e("addNotification",{type:"info",message:t})},showWarning({commit:e},t){e("addNotification",{type:"warning",message:t,duration:7e3})}}},J={namespaced:!0,state:{isConnected:!1,account:null,did:null,showConnectPrompt:!1,redirectRoute:null},mutations:{setConnected(e,t){e.isConnected=t},setAccount(e,t){e.account=t},setDID(e,t){e.did=t},setShowConnectPrompt(e,t){e.showConnectPrompt=t},setRedirectRoute(e,t){e.redirectRoute=t},clearRedirectRoute(e){e.redirectRoute=null}},actions:{async connectWallet({commit:e,dispatch:t}){try{if(!window.ethereum)throw new Error("请安装MetaMask钱包");const a=await window.ethereum.request({method:"eth_requestAccounts"}),s=a[0];return s?(e("setAccount",s),e("setConnected",!0),localStorage.setItem("walletConnected","true"),localStorage.setItem("walletAccount",s),t("fetchOrCreateDID",s),s):null}catch(a){return console.error("连接钱包失败:",a),t("app/showError","连接钱包失败: "+a.message,{root:!0}),null}},disconnectWallet({commit:e}){e("setConnected",!1),e("setAccount",null),e("setDID",null),localStorage.removeItem("walletConnected"),localStorage.removeItem("walletAccount"),localStorage.removeItem("userDID")},async checkWalletConnection({commit:e,dispatch:t}){try{const a="true"===localStorage.getItem("walletConnected"),s=localStorage.getItem("walletAccount"),l=localStorage.getItem("userDID");if(a&&s){const a=await window.ethereum.request({method:"eth_accounts"});if(a.length>0){const i=a[0];return s===i?(e("setAccount",i),e("setConnected",!0),l?e("setDID",l):t("fetchOrCreateDID",i),!0):(e("setAccount",i),e("setConnected",!0),localStorage.setItem("walletAccount",i),t("fetchOrCreateDID",i),!0)}localStorage.removeItem("walletConnected"),localStorage.removeItem("walletAccount")}return!1}catch(a){return console.error("检查钱包连接失败:",a),!1}},async fetchOrCreateDID({commit:e,dispatch:t},a){try{const t=await fetch(`/api/did/wallet/${a}`);if(t.ok){const a=await t.json();if(a.did)return e("setDID",a.did),localStorage.setItem("userDID",a.did),a.did}const s=await fetch(`/api/did/wallet/${a}`,{method:"POST",headers:{"Content-Type":"application/json"}});if(s.ok){const t=await s.json();if(t.did)return e("setDID",t.did),localStorage.setItem("userDID",t.did),t.did}throw new Error("创建DID失败")}catch(s){return console.error("获取或创建DID失败:",s),t("app/showError","获取或创建DID失败: "+s.message,{root:!0}),null}},async signMessage({state:e,dispatch:t},a){try{if(!e.isConnected||!e.account)throw new Error("钱包未连接");return await window.ethereum.request({method:"personal_sign",params:[a,e.account]})}catch(s){throw console.error("签名消息失败:",s),t("app/showError","签名消息失败: "+s.message,{root:!0}),s}}},getters:{shortAccount:e=>e.account?`${e.account.substring(0,6)}...${e.account.substring(e.account.length-4)}`:""}};var z=a(373);const H=z.A.create({baseURL:"/api",timeout:1e4,headers:{"Content-Type":"application/json"}});H.interceptors.request.use(e=>{const t=localStorage.getItem("token");return t&&(e.headers["Authorization"]=`Bearer ${t}`),e},e=>Promise.reject(e)),H.interceptors.response.use(e=>e,e=>{if(e.response)switch(e.response.status){case 401:localStorage.removeItem("token"),window.location.href="/";break;case 403:console.error("权限不足");break;case 500:console.error("服务器错误");break;default:console.error(`请求错误: ${e.response.status}`)}else e.request?console.error("网络错误，无法连接到服务器"):console.error("请求配置错误:",e.message);return Promise.reject(e)});const Z=H,Y=(e,t)=>JSON.stringify({action:e,...t,timestamp:Date.now()}),ee=e=>e?`${e.substring(0,6)}...${e.substring(e.length-4)}`:"",te={getAllNFTs:async()=>{const e=await Z.get("/nfts");return e.data},getMyNFTs:async(e,t,a)=>{const s=await Z.get("/nft/my-nfts",{headers:{"X-Ethereum-Address":e,"X-Ethereum-Signature":t,"X-Ethereum-Message":a}});return s.data},mintNFT:async e=>{const t=await Z.post("/nft/mint",e);return t.data},getNFTDetails:async e=>Z.get(`/nft/${e}`),createChildNFT:async e=>Z.post("/nft/createChild",e),updateMetadata:async e=>Z.post("/nft/update-metadata",e),transferNFT:async e=>{const t=await Z.post("/nft/transfer",e);return t.data},getUserNFTs:async e=>Z.get(`/nfts/user/${e}`),getAllRequests:async(e,t,a)=>Z.get("/nft/all-requests",{headers:{"X-Ethereum-Address":e,"X-Ethereum-Signature":t,"X-Ethereum-Message":a}}),processRequest:async e=>Z.post("/nft/process-request",e),requestChildNFT:async e=>Z.post("/nft/request-child",e),getMetadata:async()=>Z.get("/metadata"),createMetadata:async e=>Z.post("/metadata",e),getNFTMetadata:async e=>{const t=await Z.get(`/nft/${e}`);return t.data},async fetchMetadataFromURI(e){try{if(console.log("开始获取元数据，URI:",e),!e||""===e.trim())return console.log("URI为空，返回默认元数据"),{name:"未命名NFT",description:"This NFT has no metadata",image:"",attributes:[{trait_type:"Type",value:"Unknown"},{trait_type:"Rarity",value:"Unknown"}]};if(e.trim().startsWith("{")&&e.trim().endsWith("}")){console.log("URI本身是JSON字符串，尝试直接解析");try{const t=JSON.parse(e);return console.log("成功解析JSON字符串:",t),t.image&&t.image.startsWith("ipfs://")&&(t.image=t.image.replace("ipfs://","https://ipfs.io/ipfs/"),console.log("转换图片IPFS链接为HTTP:",t.image)),t}catch(t){console.error("解析URI中的JSON失败:",t)}}const l=["https://dweb.link/ipfs/","https://cloudflare-ipfs.com/ipfs/","https://gateway.pinata.cloud/ipfs/","https://ipfs.io/ipfs/","https://cf-ipfs.com/ipfs/","https://ipfs.fleek.co/ipfs/","https://ipfs.infura.io/ipfs/"];if(e.startsWith("ipfs://")){const s=e.substring(7);console.log("提取IPFS哈希:",s,"长度:",s.length);const i=s.length>8?`${s.substring(0,8)}...`:s,n={name:`NFT #${i}`,description:"This is an NFT created on our platform",image:e,attributes:[{trait_type:"Type",value:"Main NFT"},{trait_type:"Rarity",value:"Common"}]};for(const e of l)try{const a=`${e}${s}`;console.log(`尝试IPFS网关: ${e}`);const l=new AbortController,i=setTimeout(()=>l.abort(),1e4),n=await fetch(a,{signal:l.signal,headers:{Accept:"application/json"},redirect:"follow"});if(clearTimeout(i),!n.ok){console.warn(`网关 ${e} 返回错误状态码: ${n.status}`);continue}n.redirected&&console.log(`网关 ${e} 重定向到: ${n.url}`);const o=n.headers.get("content-type");console.log(`网关 ${e} 响应内容类型:`,o);const r=await n.text();console.log(`网关 ${e} 响应文本:`,r.substring(0,200)+(r.length>200?"...":""));try{const t=JSON.parse(r);return console.log(`网关 ${e} 成功解析元数据:`,t),t.image&&t.image.startsWith("ipfs://")&&(t.image=t.image.replace("ipfs://",e),console.log("转换图片IPFS链接为HTTP:",t.image)),t}catch(t){console.error(`网关 ${e} 解析JSON失败:`,t),(r.includes("<!DOCTYPE html>")||r.includes("<html>"))&&console.warn(`网关 ${e} 返回了HTML而不是JSON，尝试下一个网关`)}}catch(a){console.error(`网关 ${e} 获取失败:`,a)}return console.warn("所有IPFS网关都失败，使用基本元数据"),n}let i=e;e.startsWith("/")&&(i=`${window.location.origin}${e}`,console.log("转换相对路径为绝对路径:",i)),console.log("使用URL获取元数据:",i);try{const a=new AbortController,s=setTimeout(()=>a.abort(),1e4),n=await fetch(i,{signal:a.signal});if(clearTimeout(s),!n.ok)return console.error(`获取元数据失败，状态码: ${n.status}`),this.createBasicMetadata(e);const o=n.headers.get("content-type");console.log("响应内容类型:",o);const r=await n.text();console.log("响应文本:",r.substring(0,200)+(r.length>200?"...":""));try{const e=JSON.parse(r);return console.log("成功解析元数据:",e),e.image&&e.image.startsWith("ipfs://")&&(e.image=e.image.replace("ipfs://",l[0]),console.log("转换图片IPFS链接为HTTP:",e.image)),e}catch(t){return console.error("解析JSON失败:",t),this.createBasicMetadata(e)}}catch(s){return console.error("获取元数据失败:",s),this.createBasicMetadata(e)}}catch(s){return console.error("处理元数据过程中发生错误:",s),this.createBasicMetadata(e)}},createBasicMetadata(e){console.log("创建基本元数据对象，URI:",e);let t="NFT";if(e){const a=e.split("/"),s=a[a.length-1];s&&(t=`NFT #${s.substring(0,8)}`)}return{name:t,description:"This is an NFT created on our platform",image:e,attributes:[{trait_type:"Type",value:"Main NFT"},{trait_type:"Rarity",value:"Common"}]}},async getNFTRequests(){const e=await Z.get("/nft/all-requests");return e.data},async approveNFTRequest(e,t){const a=await Z.post(`/nft/requests/${e}/approve`,t);return a.data},async rejectNFTRequest(e,t){const a=await Z.post(`/nft/requests/${e}/reject`,t);return a.data},async createNFTRequest(e){const t=await Z.post("/nft/requests",e);return t.data}},ae=te,se={namespaced:!0,state:{allNFTs:[],myNFTs:[],metadata:[],requests:[],selectedNFT:null,isLoading:!1,error:null},mutations:{setAllNFTs(e,t){e.allNFTs=t},setMyNFTs(e,t){e.myNFTs=t},setMetadata(e,t){e.metadata=t},setRequests(e,t){e.requests=t},setSelectedNFT(e,t){e.selectedNFT=t},SET_LOADING(e,t){e.isLoading=t},SET_ERROR(e,t){e.error=t},updateNFTMetadata(e,{tokenId:t,metadata:a}){const s=e.allNFTs.findIndex(e=>e.tokenId===t);-1!==s&&(e.allNFTs[s].metadata=a);const l=e.myNFTs.findIndex(e=>e.tokenId===t);-1!==l&&(e.myNFTs[l].metadata=a)}},actions:{async loadAllNFTs({commit:e,dispatch:t}){e("SET_LOADING",!0);try{const a=await ae.getAllNFTs();console.log("NFT数据:",a);const s=a.nfts||[],l=s.map(e=>e.metadata?e:{...e,metadata:{name:`NFT #${e.tokenId}`,description:"This is an NFT created on our platform",image:e.uri,attributes:[{trait_type:"Type",value:"child"===e.contractType?"Child NFT":"Main NFT"},{trait_type:"Rarity",value:"Common"}]}});return e("setAllNFTs",l),t("loadNFTsMetadata",l),l}catch(a){throw e("SET_ERROR",a.message||"加载NFT失败"),a}finally{e("SET_LOADING",!1)}},async loadMyNFTs({commit:e,rootState:t,dispatch:a}){e("SET_LOADING",!0);try{const s=t.wallet.account;if(!s)throw new Error("钱包未连接");const l=Y("get_my_nfts",{address:s,timestamp:Date.now()}),i=await a("wallet/signMessage",l,{root:!0}),n=await ae.getMyNFTs(s,i,l);console.log("我的NFT数据:",n);const o=n.nfts||[],r=o.map(e=>e.metadata?e:{...e,metadata:{name:`NFT #${e.tokenId}`,description:"This is an NFT created on our platform",image:e.uri,attributes:[{trait_type:"Type",value:"child"===e.contractType?"Child NFT":"Main NFT"},{trait_type:"Rarity",value:"Common"}]}});return e("setMyNFTs",r),a("loadNFTsMetadata",r),r}catch(s){throw e("SET_ERROR",s.message||"加载我的NFT失败"),s}finally{e("SET_LOADING",!1)}},async loadNFTsMetadata({dispatch:e},t){console.log("开始加载NFT元数据:",t),t.forEach(t=>{t.uri&&e("loadNFTMetadata",t)})},async loadNFTMetadata({commit:e},t){try{if(!t.uri)return;console.log("加载NFT元数据:",t.tokenId,t.uri);const a=await ae.fetchMetadataFromURI(t.uri);if(console.log("获取到元数据:",t.tokenId,a),a&&Object.keys(a).length>0){const s={name:a.name||`NFT #${t.tokenId}`,description:a.description||"This is an NFT created on our platform",image:a.image||t.uri,attributes:a.attributes||[{trait_type:"Type",value:"child"===t.contractType?"Child NFT":"Main NFT"},{trait_type:"Rarity",value:"Common"}]};e("updateNFTMetadata",{tokenId:t.tokenId,metadata:s})}else{const a={name:`NFT #${t.tokenId}`,description:"This is an NFT created on our platform",image:t.uri,attributes:[{trait_type:"Type",value:"child"===t.contractType?"Child NFT":"Main NFT"},{trait_type:"Rarity",value:"Common"}]};e("updateNFTMetadata",{tokenId:t.tokenId,metadata:a})}}catch(a){console.error(`加载NFT ${t.tokenId} 元数据失败:`,a);const s={name:`NFT #${t.tokenId}`,description:"This is an NFT created on our platform",image:t.uri,attributes:[{trait_type:"Type",value:"child"===t.contractType?"Child NFT":"Main NFT"},{trait_type:"Rarity",value:"Common"}]};e("updateNFTMetadata",{tokenId:t.tokenId,metadata:s})}},async mintNFT({commit:e,rootState:t,dispatch:a},s){e("SET_LOADING",!0);try{const e=t.wallet.account;if(!e)throw new Error("钱包未连接");const l=Y("mint_nft",{uri:s,timestamp:Date.now()}),i=await a("wallet/signMessage",l,{root:!0}),n={address:e,signature:i,message:l,uri:s},o=await ae.mintNFT(n);return o.transactionHash}catch(l){throw e("SET_ERROR",l.message||"铸造NFT失败"),l}finally{e("SET_LOADING",!1)}},async loadMetadata({commit:e}){e("SET_LOADING",!0);try{const t=await ae.getMetadata();e("setMetadata",t.metadata||[])}catch(t){console.error("加载元数据列表出错:",t),e("SET_ERROR","加载元数据失败: "+t.message)}finally{e("SET_LOADING",!1)}},async createMetadata({commit:e,dispatch:t},a){e("SET_LOADING",!0);try{const s={name:a.name,description:a.description,external_url:a.externalUrl,image:a.image,policy:a.policy,ciphertext:a.ciphertext},l=await ae.createMetadata(s);return e("app/showSuccess",`元数据创建成功！IPFS哈希: ${l.ipfs_hash}`,{root:!0}),t("nft/loadMetadata"),l.ipfs_hash}catch(s){return console.error("创建元数据出错:",s),e("SET_ERROR","创建元数据失败: "+s.message),null}finally{e("SET_LOADING",!1)}},async loadRequests({commit:e,rootState:t,dispatch:a}){e("SET_LOADING",!0);try{if(!t.wallet.isConnected)throw new Error("钱包未连接");const s=Y("get_all_requests",{timestamp:Date.now()}),l=await a("wallet/signMessage",s,{root:!0});console.log("发送请求获取NFT申请列表，地址:",t.wallet.account);const i=await ae.getAllRequests(t.wallet.account,l,s);console.log("从后端获取的请求数据:",i);const n=i.requests||[];return console.log("处理后的请求数据:",n),e("setRequests",n),n}catch(s){throw console.error("加载申请列表出错:",s),e("SET_ERROR","加载申请列表失败: "+s.message),e("setRequests",[]),s}finally{e("SET_LOADING",!1)}},async processRequest({commit:e,rootState:t,dispatch:a},{requestId:s,action:l}){e("SET_LOADING",!0);try{if(!t.wallet.isConnected)throw new Error("钱包未连接");console.log("处理请求:",s,l);const i=Y("process_request",{requestId:s,decision:l,timestamp:Date.now()}),n=await a("wallet/signMessage",i,{root:!0}),o={address:t.wallet.account,signature:n,message:i,requestId:String(s),action:l};console.log("发送请求数据:",o);const r=await ae.processRequest(o),d="approve"===l?"批准":"拒绝";return e("app/showSuccess",`申请已${d}`,{root:!0}),a("loadRequests"),r.transactionHash}catch(i){return console.error("处理申请出错:",i),e("SET_ERROR","处理申请失败: "+i.message),null}finally{e("SET_LOADING",!1)}},async requestChildNFT({commit:e,rootState:t,dispatch:a},{parentTokenId:s,uri:l}){e("SET_LOADING",!0);try{if(!t.wallet.isConnected)throw new Error("钱包未连接");const i=Y("request_child_nft",{parentTokenId:s,uri:l,timestamp:Date.now()}),n=await a("wallet/signMessage",i,{root:!0}),o={address:t.wallet.account,signature:n,message:i,parentTokenId:s,applicantAddress:t.wallet.account,uri:l,description:`申请创建父NFT ${s} 的子NFT`};await ae.requestChildNFT(o);return e("app/showSuccess","子NFT申请已提交，等待审批",{root:!0}),a("loadRequests"),!0}catch(i){return console.error("提交申请出错:",i),e("SET_ERROR","提交申请失败: "+i.message),!1}finally{e("SET_LOADING",!1)}},async createChildNFT({commit:e},t){e("SET_LOADING",!0);try{const e=await ae.createChildNFT(t);return e}catch(a){throw e("SET_ERROR",a.message||"创建子NFT失败"),a}finally{e("SET_LOADING",!1)}},async updateMetadata({commit:e},t){e("SET_LOADING",!0);try{const e=await ae.updateMetadata(t);return e}catch(a){throw e("SET_ERROR",a.message||"更新元数据失败"),a}finally{e("SET_LOADING",!1)}},async approveRequest({commit:e,rootState:t,dispatch:a},s){e("SET_LOADING",!0);try{if(!t.wallet.isConnected)throw new Error("钱包未连接");return await a("processRequest",{requestId:s,action:"approve"})}catch(l){return console.error("批准请求出错:",l),e("SET_ERROR","批准请求失败: "+l.message),!1}finally{e("SET_LOADING",!1)}},async rejectRequest({commit:e,rootState:t,dispatch:a},s){e("SET_LOADING",!0);try{if(!t.wallet.isConnected)throw new Error("钱包未连接");return await a("processRequest",{requestId:s,action:"reject"})}catch(l){return console.error("拒绝请求出错:",l),e("SET_ERROR","拒绝请求失败: "+l.message),!1}finally{e("SET_LOADING",!1)}}},getters:{pendingRequests:e=>e.requests.filter(e=>"pending"===e.status),myRequests:(e,t,a)=>a.wallet.account?e.requests.filter(e=>e.applicantAddress===a.wallet.account):[],getNFTById:e=>t=>e.allNFTs.find(e=>e.tokenId===t)||e.myNFTs.find(e=>e.tokenId===t)}},le={getSystemStatus:async()=>Z.get("/abe/status"),setupSystem:async e=>Z.post("/abe/setup",e),generateKey:async e=>Z.post("/abe/keygen",e),encryptData:async e=>Z.post("/abe/encrypt",e),decryptData:async e=>Z.post("/abe/decrypt",e),getLogs:async(e=1,t=10)=>Z.get(`/abe/logs?page=${e}&limit=${t}`)},ie=le,ne={namespaced:!0,state:{systemStatus:{initialized:!1,attributeCount:0,keyCount:0,setupTime:null},logs:[],isLoading:!1,error:null},mutations:{SET_SYSTEM_STATUS(e,t){e.systemStatus=t},SET_LOGS(e,t){e.logs=t},SET_LOADING(e,t){e.isLoading=t},SET_ERROR(e,t){e.error=t}},actions:{async getSystemStatus({commit:e}){e("SET_LOADING",!0);try{const t=await ie.getSystemStatus();return e("SET_SYSTEM_STATUS",t),t}catch(t){throw e("SET_ERROR",t.message||"获取系统状态失败"),t}finally{e("SET_LOADING",!1)}},async setupSystem({commit:e},t){e("SET_LOADING",!0);try{const a=await ie.setupSystem(t);return e("SET_SYSTEM_STATUS",{initialized:!0,attributeCount:t.universe?t.universe.split("\n").filter(Boolean).length:0,keyCount:0,setupTime:(new Date).toISOString()}),a}catch(a){throw e("SET_ERROR",a.message||"初始化系统失败"),a}finally{e("SET_LOADING",!1)}},async generateKey({commit:e},t){e("SET_LOADING",!0);try{const e=await ie.generateKey(t);return e}catch(a){throw e("SET_ERROR",a.message||"生成密钥失败"),a}finally{e("SET_LOADING",!1)}},async loadLogs({commit:e},{page:t=1,limit:a=10}={}){e("SET_LOADING",!0);try{const s=await ie.getLogs(t,a);return e("SET_LOGS",s),s}catch(s){throw e("SET_ERROR",s.message||"加载日志失败"),s}finally{e("SET_LOADING",!1)}}},getters:{isSystemInitialized:e=>e.systemStatus.initialized,systemAttributes:e=>e.systemStatus.attributeCount,systemKeyCount:e=>e.systemStatus.keyCount}},oe={getDIDs:async()=>Z.get("/did/list"),createDID:async e=>Z.post("/did/create",e),getDIDDetails:async e=>Z.get(`/did/details?did=${encodeURIComponent(e)}`),deleteDID:async e=>Z.delete(`/did/delete?did=${encodeURIComponent(e)}`),issueVC:async e=>Z.post("/did/vc/issue",e),verifyVC:async e=>Z.post("/did/vc/verify",e),getDoctorDID:async()=>Z.get("/did/doctor"),verifyDoctorIdentity:async e=>Z.post("/did/doctor/verify",e)},re=oe,de={namespaced:!0,state:{dids:[],selectedDID:null,vcs:[],selectedVC:null,doctorDID:null,isLoading:!1,error:null},mutations:{SET_DIDS(e,t){e.dids=t},SET_SELECTED_DID(e,t){e.selectedDID=t},SET_VCS(e,t){e.vcs=t},SET_SELECTED_VC(e,t){e.selectedVC=t},SET_DOCTOR_DID(e,t){e.doctorDID=t},SET_LOADING(e,t){e.isLoading=t},SET_ERROR(e,t){e.error=t},ADD_DID(e,t){e.dids.push(t)},REMOVE_DID(e,t){e.dids=e.dids.filter(e=>e.id!==t)}},actions:{async getDIDs({commit:e}){e("SET_LOADING",!0);try{const t=await re.getDIDs();return e("SET_DIDS",t),t}catch(t){throw e("SET_ERROR",t.message||"获取DID列表失败"),t}finally{e("SET_LOADING",!1)}},async createDID({commit:e},t){e("SET_LOADING",!0);try{const a=await re.createDID(t);return e("ADD_DID",a),a}catch(a){throw e("SET_ERROR",a.message||"创建DID失败"),a}finally{e("SET_LOADING",!1)}},async getDIDDetails({commit:e},t){e("SET_LOADING",!0);try{const a=await re.getDIDDetails(t);return e("SET_SELECTED_DID",a),a}catch(a){throw e("SET_ERROR",a.message||"获取DID详情失败"),a}finally{e("SET_LOADING",!1)}},async deleteDID({commit:e},t){e("SET_LOADING",!0);try{return await re.deleteDID(t),e("REMOVE_DID",t.id),!0}catch(a){throw e("SET_ERROR",a.message||"删除DID失败"),a}finally{e("SET_LOADING",!1)}},async issueVC({commit:e},t){e("SET_LOADING",!0);try{const e=await re.issueVC(t);return e}catch(a){throw e("SET_ERROR",a.message||"颁发可验证凭证失败"),a}finally{e("SET_LOADING",!1)}},async verifyVC({commit:e},t){e("SET_LOADING",!0);try{const e=await re.verifyVC(t);return e}catch(a){throw e("SET_ERROR",a.message||"验证可验证凭证失败"),a}finally{e("SET_LOADING",!1)}},async getDoctorDID({commit:e}){e("SET_LOADING",!0);try{const t=await re.getDoctorDID();return e("SET_DOCTOR_DID",t),t}catch(t){throw e("SET_ERROR",t.message||"获取医生DID信息失败"),t}finally{e("SET_LOADING",!1)}},async verifyDoctorIdentity({commit:e},t){e("SET_LOADING",!0);try{const e=await re.verifyDoctorIdentity(t);return e}catch(a){throw e("SET_ERROR",a.message||"验证医生身份失败"),a}finally{e("SET_LOADING",!1)}}},getters:{getDIDById:e=>t=>e.dids.find(e=>e.id===t),getDIDByDID:e=>t=>e.dids.find(e=>e.did===t),getVCById:e=>t=>e.vcs.find(e=>e.id===t)}},ce=(0,h.y$)({modules:{app:G,wallet:J,nft:se,abe:ne,did:de}}),ue={class:"home"},me={class:"platform-switcher"},be={class:"container"},ke={class:"row justify-content-center"},pe={class:"col-md-4 mb-4"},ve={class:"col-md-4 mb-4"},he={class:"col-md-4 mb-4"},Le={key:0,class:"container mt-5"},ge={class:"alert alert-info text-center"},ye={class:"container mt-5"},fe={class:"row"},De={class:"col-md-4"},we={class:"card mb-4"},Ie={class:"card-body"},Ce={class:"col-md-4"},Te={class:"card mb-4"},Fe={class:"card-body"},Ee={class:"col-md-4"},_e={class:"card mb-4"},Ne={class:"card-body"},xe={class:"container mt-4 mb-5"},Se={class:"card"},Re={class:"card-body"},Ae={class:"row"},Me={class:"col-md-4"},We={class:"d-flex align-items-center mb-3"},Xe={class:"col-md-4"},Oe={class:"d-flex align-items-center mb-3"};function qe(e,t,a,s,i,n){const o=(0,l.g2)("router-link");return(0,l.uX)(),(0,l.CE)("div",ue,[(0,l.Lk)("div",me,[(0,l.Lk)("div",be,[t[7]||(t[7]=(0,l.Lk)("div",{class:"text-center text-white mb-4"},[(0,l.Lk)("h1",null,[(0,l.Lk)("i",{class:"bi bi-layers me-3"}),(0,l.eW)("选择管理平台")]),(0,l.Lk)("p",{class:"lead"},"请选择您要使用的管理平台")],-1)),(0,l.Lk)("div",ke,[(0,l.Lk)("div",pe,[(0,l.Lk)("div",{class:"card platform-card nft-platform h-100",onClick:t[0]||(t[0]=e=>s.navigateTo("/nft"))},t[4]||(t[4]=[(0,l.Fv)('<div class="card-body text-center" data-v-53bcccda><i class="bi bi-collection platform-icon" data-v-53bcccda></i><h3 data-v-53bcccda>NFT管理平台</h3><p class="text-muted" data-v-53bcccda>管理您的NFT资产，包括铸造、转移、元数据管理等功能</p><div class="mt-3" data-v-53bcccda><span class="badge bg-primary me-2" data-v-53bcccda>铸造NFT</span><span class="badge bg-info me-2" data-v-53bcccda>元数据管理</span><span class="badge bg-warning" data-v-53bcccda>子NFT</span></div></div>',1)]))]),(0,l.Lk)("div",ve,[(0,l.Lk)("div",{class:"card platform-card abe-platform h-100",onClick:t[1]||(t[1]=e=>s.navigateTo("/abe"))},t[5]||(t[5]=[(0,l.Fv)('<div class="card-body text-center" data-v-53bcccda><i class="bi bi-shield-lock platform-icon" data-v-53bcccda></i><h3 data-v-53bcccda>ABE加密管理</h3><p class="text-muted" data-v-53bcccda>基于属性的加密系统，提供细粒度的访问控制和数据保护</p><div class="mt-3" data-v-53bcccda><span class="badge bg-success me-2" data-v-53bcccda>属性加密</span><span class="badge bg-secondary me-2" data-v-53bcccda>密钥管理</span><span class="badge bg-danger" data-v-53bcccda>访问控制</span></div></div>',1)]))]),(0,l.Lk)("div",he,[(0,l.Lk)("div",{class:"card platform-card did-platform h-100",onClick:t[2]||(t[2]=e=>s.navigateTo("/did"))},t[6]||(t[6]=[(0,l.Fv)('<div class="card-body text-center" data-v-53bcccda><i class="bi bi-person-circle platform-icon" data-v-53bcccda></i><h3 data-v-53bcccda>DID和VC管理</h3><p class="text-muted" data-v-53bcccda>管理您的DID和VC，包括创建、验证、管理等功能</p><div class="mt-3" data-v-53bcccda><span class="badge bg-info me-2" data-v-53bcccda>DID创建</span><span class="badge bg-warning" data-v-53bcccda>VC管理</span></div></div>',1)]))])])])]),s.isConnected?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",Le,[(0,l.Lk)("div",ge,[t[9]||(t[9]=(0,l.Lk)("h4",null,"请连接MetaMask钱包",-1)),t[10]||(t[10]=(0,l.Lk)("p",null,"要使用平台的全部功能，您需要先连接MetaMask钱包",-1)),(0,l.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>s.connectWallet&&s.connectWallet(...e)),class:"btn btn-primary"},t[8]||(t[8]=[(0,l.Lk)("i",{class:"bi bi-wallet2 me-1"},null,-1),(0,l.eW)("连接钱包 ")]))])])),(0,l.Lk)("div",ye,[(0,l.Lk)("div",fe,[(0,l.Lk)("div",De,[(0,l.Lk)("div",we,[(0,l.Lk)("div",Ie,[t[12]||(t[12]=(0,l.Lk)("h5",{class:"card-title"},[(0,l.Lk)("i",{class:"bi bi-collection me-2"}),(0,l.eW)("NFT管理")],-1)),t[13]||(t[13]=(0,l.Lk)("p",{class:"card-text"},"NFT管理平台提供了铸造、转移、元数据管理等功能，支持主NFT和子NFT的创建与管理。",-1)),(0,l.bF)(o,{to:"/nft",class:"btn btn-outline-primary"},{default:(0,l.k6)(()=>t[11]||(t[11]=[(0,l.eW)("进入NFT平台")])),_:1,__:[11]})])])]),(0,l.Lk)("div",Ce,[(0,l.Lk)("div",Te,[(0,l.Lk)("div",Fe,[t[15]||(t[15]=(0,l.Lk)("h5",{class:"card-title"},[(0,l.Lk)("i",{class:"bi bi-shield-lock me-2"}),(0,l.eW)("ABE加密")],-1)),t[16]||(t[16]=(0,l.Lk)("p",{class:"card-text"},"基于属性的加密系统，提供细粒度的访问控制，可以对敏感数据进行加密保护。",-1)),(0,l.bF)(o,{to:"/abe",class:"btn btn-outline-success"},{default:(0,l.k6)(()=>t[14]||(t[14]=[(0,l.eW)("进入ABE平台")])),_:1,__:[14]})])])]),(0,l.Lk)("div",Ee,[(0,l.Lk)("div",_e,[(0,l.Lk)("div",Ne,[t[18]||(t[18]=(0,l.Lk)("h5",{class:"card-title"},[(0,l.Lk)("i",{class:"bi bi-person-circle me-2"}),(0,l.eW)("DID和VC")],-1)),t[19]||(t[19]=(0,l.Lk)("p",{class:"card-text"},"去中心化身份标识和可验证凭证系统，提供身份管理和凭证颁发、验证功能。",-1)),(0,l.bF)(o,{to:"/did",class:"btn btn-outline-warning"},{default:(0,l.k6)(()=>t[17]||(t[17]=[(0,l.eW)("进入DID平台")])),_:1,__:[17]})])])])])]),(0,l.Lk)("div",xe,[(0,l.Lk)("div",Se,[t[25]||(t[25]=(0,l.Lk)("div",{class:"card-header"},[(0,l.Lk)("h5",null,[(0,l.Lk)("i",{class:"bi bi-info-circle me-2"}),(0,l.eW)("系统状态")])],-1)),(0,l.Lk)("div",Re,[(0,l.Lk)("div",Ae,[(0,l.Lk)("div",Me,[(0,l.Lk)("div",We,[t[21]||(t[21]=(0,l.Lk)("div",{class:"me-3"},[(0,l.Lk)("i",{class:"bi bi-wallet2 fs-3"})],-1)),(0,l.Lk)("div",null,[t[20]||(t[20]=(0,l.Lk)("h6",{class:"mb-0"},"钱包状态",-1)),(0,l.Lk)("span",{class:(0,L.C4)(s.isConnected?"text-success":"text-danger")},(0,L.v_)(s.isConnected?"已连接":"未连接"),3)])])]),(0,l.Lk)("div",Xe,[(0,l.Lk)("div",Oe,[t[23]||(t[23]=(0,l.Lk)("div",{class:"me-3"},[(0,l.Lk)("i",{class:"bi bi-person-badge fs-3"})],-1)),(0,l.Lk)("div",null,[t[22]||(t[22]=(0,l.Lk)("h6",{class:"mb-0"},"DID状态",-1)),(0,l.Lk)("span",{class:(0,L.C4)(s.did?"text-success":"text-danger")},(0,L.v_)(s.did?"已创建":"未创建"),3)])])]),t[24]||(t[24]=(0,l.Fv)('<div class="col-md-4" data-v-53bcccda><div class="d-flex align-items-center mb-3" data-v-53bcccda><div class="me-3" data-v-53bcccda><i class="bi bi-hdd-network fs-3" data-v-53bcccda></i></div><div data-v-53bcccda><h6 class="mb-0" data-v-53bcccda>网络状态</h6><span class="text-success" data-v-53bcccda>已连接</span></div></div></div>',1))])])])])])}const $e={name:"Home",setup(){const e=(0,h.Pj)(),t=(0,x.rd)(),a=(0,l.EW)(()=>e.state.wallet.isConnected),s=(0,l.EW)(()=>e.state.wallet.account),i=(0,l.EW)(()=>e.state.wallet.did),n=e=>{t.push(e)},o=async()=>{await e.dispatch("wallet/connectWallet")};return{isConnected:a,account:s,did:i,navigateTo:n,connectWallet:o}}},Pe=(0,A.A)($e,[["render",qe],["__scopeId","data-v-53bcccda"]]),Ke=Pe,Ue={class:"nft-dashboard"},Ve={class:"navbar navbar-expand-lg navbar-light bg-light mb-4"},Qe={class:"container"},je={class:"collapse navbar-collapse",id:"nftNavbarNav"},Be={class:"navbar-nav"},Ge={class:"container"};function Je(e,t,a,s,i,n){const o=(0,l.g2)("router-link"),r=(0,l.g2)("router-view");return(0,l.uX)(),(0,l.CE)("div",Ue,[(0,l.Lk)("nav",Ve,[(0,l.Lk)("div",Qe,[t[5]||(t[5]=(0,l.Lk)("span",{class:"navbar-brand"},[(0,l.Lk)("i",{class:"bi bi-collection me-2"}),(0,l.eW)("NFT管理 ")],-1)),t[6]||(t[6]=(0,l.Lk)("button",{class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#nftNavbarNav","aria-controls":"nftNavbarNav","aria-expanded":"false","aria-label":"Toggle navigation"},[(0,l.Lk)("span",{class:"navbar-toggler-icon"})],-1)),(0,l.Lk)("div",je,[(0,l.Lk)("div",Be,[(0,l.bF)(o,{class:"nav-link",to:{name:"AllNFTs"}},{default:(0,l.k6)(()=>t[0]||(t[0]=[(0,l.Lk)("i",{class:"bi bi-grid me-1"},null,-1),(0,l.eW)("所有NFT ")])),_:1,__:[0]}),(0,l.bF)(o,{class:"nav-link",to:{name:"MintNFT"}},{default:(0,l.k6)(()=>t[1]||(t[1]=[(0,l.Lk)("i",{class:"bi bi-plus-circle me-1"},null,-1),(0,l.eW)("铸造NFT ")])),_:1,__:[1]}),(0,l.bF)(o,{class:"nav-link",to:{name:"MetadataManager"}},{default:(0,l.k6)(()=>t[2]||(t[2]=[(0,l.Lk)("i",{class:"bi bi-file-text me-1"},null,-1),(0,l.eW)("创建元数据 ")])),_:1,__:[2]}),(0,l.bF)(o,{class:"nav-link",to:{name:"MyNFTs"}},{default:(0,l.k6)(()=>t[3]||(t[3]=[(0,l.Lk)("i",{class:"bi bi-wallet me-1"},null,-1),(0,l.eW)("我的NFT ")])),_:1,__:[3]}),(0,l.bF)(o,{class:"nav-link",to:{name:"RequestManager"}},{default:(0,l.k6)(()=>t[4]||(t[4]=[(0,l.Lk)("i",{class:"bi bi-list-check me-1"},null,-1),(0,l.eW)("申请管理 ")])),_:1,__:[4]})])])])]),(0,l.Lk)("div",Ge,[(0,l.bF)(r)]),t[7]||(t[7]=(0,l.Fv)('<div class="modal fade" id="result-modal" tabindex="-1" data-v-8fcbfb20><div class="modal-dialog" data-v-8fcbfb20><div class="modal-content" data-v-8fcbfb20><div class="modal-header" data-v-8fcbfb20><h5 class="modal-title" id="result-title" data-v-8fcbfb20>操作结果</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" data-v-8fcbfb20></button></div><div class="modal-body" data-v-8fcbfb20><p id="result-message" data-v-8fcbfb20></p><div id="tx-hash-container" class="d-none" data-v-8fcbfb20><p data-v-8fcbfb20>交易哈希:</p><code id="tx-hash" class="d-block p-2 bg-light" data-v-8fcbfb20></code></div></div><div class="modal-footer" data-v-8fcbfb20><button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-v-8fcbfb20>关闭</button></div></div></div></div>',1))])}const ze={name:"NFTDashboard"},He=(0,A.A)(ze,[["render",Je],["__scopeId","data-v-8fcbfb20"]]),Ze=He,Ye={class:"abe-dashboard"},et={class:"navbar navbar-expand-lg navbar-light bg-light mb-4"},tt={class:"container"},at={class:"collapse navbar-collapse",id:"abeNavbarNav"},st={class:"navbar-nav"},lt={class:"container"};function it(e,t,a,s,i,n){const o=(0,l.g2)("router-link"),r=(0,l.g2)("router-view");return(0,l.uX)(),(0,l.CE)("div",Ye,[(0,l.Lk)("nav",et,[(0,l.Lk)("div",tt,[t[3]||(t[3]=(0,l.Lk)("span",{class:"navbar-brand"},[(0,l.Lk)("i",{class:"bi bi-shield-lock me-2"}),(0,l.eW)("ABE管理 ")],-1)),t[4]||(t[4]=(0,l.Lk)("button",{class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#abeNavbarNav","aria-controls":"abeNavbarNav","aria-expanded":"false","aria-label":"Toggle navigation"},[(0,l.Lk)("span",{class:"navbar-toggler-icon"})],-1)),(0,l.Lk)("div",at,[(0,l.Lk)("div",st,[(0,l.bF)(o,{class:"nav-link",to:{name:"ABESetup"}},{default:(0,l.k6)(()=>t[0]||(t[0]=[(0,l.Lk)("i",{class:"bi bi-gear me-1"},null,-1),(0,l.eW)("系统初始化 ")])),_:1,__:[0]}),(0,l.bF)(o,{class:"nav-link",to:{name:"ABEKeyGen"}},{default:(0,l.k6)(()=>t[1]||(t[1]=[(0,l.Lk)("i",{class:"bi bi-key me-1"},null,-1),(0,l.eW)("密钥生成 ")])),_:1,__:[1]}),t[2]||(t[2]=(0,l.Fv)('<a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true" data-v-82e22a00><i class="bi bi-lock me-1" data-v-82e22a00></i>加密 </a><a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true" data-v-82e22a00><i class="bi bi-unlock me-1" data-v-82e22a00></i>解密 </a><a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true" data-v-82e22a00><i class="bi bi-journal-text me-1" data-v-82e22a00></i>操作日志 </a>',3))])])])]),(0,l.Lk)("div",lt,[(0,l.bF)(r)])])}const nt={name:"ABEDashboard"},ot=(0,A.A)(nt,[["render",it],["__scopeId","data-v-82e22a00"]]),rt=ot,dt={class:"did-dashboard"},ct={class:"navbar navbar-expand-lg navbar-light bg-light mb-4"},ut={class:"container"},mt={class:"collapse navbar-collapse",id:"didNavbarNav"},bt={class:"navbar-nav"},kt={class:"container"};function pt(e,t,a,s,i,n){const o=(0,l.g2)("router-link"),r=(0,l.g2)("router-view");return(0,l.uX)(),(0,l.CE)("div",dt,[(0,l.Lk)("nav",ct,[(0,l.Lk)("div",ut,[t[5]||(t[5]=(0,l.Lk)("span",{class:"navbar-brand"},[(0,l.Lk)("i",{class:"bi bi-person-badge me-2"}),(0,l.eW)("DID管理 ")],-1)),t[6]||(t[6]=(0,l.Lk)("button",{class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#didNavbarNav","aria-controls":"didNavbarNav","aria-expanded":"false","aria-label":"Toggle navigation"},[(0,l.Lk)("span",{class:"navbar-toggler-icon"})],-1)),(0,l.Lk)("div",mt,[(0,l.Lk)("div",bt,[(0,l.bF)(o,{class:"nav-link",to:{name:"DIDList"}},{default:(0,l.k6)(()=>t[0]||(t[0]=[(0,l.Lk)("i",{class:"bi bi-list-ul me-1"},null,-1),(0,l.eW)("DID列表 ")])),_:1,__:[0]}),(0,l.bF)(o,{class:"nav-link",to:{name:"DIDCreate"}},{default:(0,l.k6)(()=>t[1]||(t[1]=[(0,l.Lk)("i",{class:"bi bi-person-plus me-1"},null,-1),(0,l.eW)("创建DID ")])),_:1,__:[1]}),(0,l.bF)(o,{class:"nav-link",to:{name:"DoctorDID"}},{default:(0,l.k6)(()=>t[2]||(t[2]=[(0,l.Lk)("i",{class:"bi bi-hospital me-1"},null,-1),(0,l.eW)("医生DID ")])),_:1,__:[2]}),t[3]||(t[3]=(0,l.Lk)("a",{class:"nav-link disabled",href:"#",tabindex:"-1","aria-disabled":"true"},[(0,l.Lk)("i",{class:"bi bi-file-earmark-check me-1"}),(0,l.eW)("凭证颁发 ")],-1)),t[4]||(t[4]=(0,l.Lk)("a",{class:"nav-link disabled",href:"#",tabindex:"-1","aria-disabled":"true"},[(0,l.Lk)("i",{class:"bi bi-card-checklist me-1"}),(0,l.eW)("凭证管理 ")],-1))])])])]),(0,l.Lk)("div",kt,[(0,l.bF)(r)])])}const vt={name:"DIDDashboard"},ht=(0,A.A)(vt,[["render",pt],["__scopeId","data-v-5d57c711"]]),Lt=ht,gt={class:"not-found"},yt={class:"container text-center py-5"},ft={class:"mt-4"};function Dt(e,t,a,s,i,n){const o=(0,l.g2)("router-link");return(0,l.uX)(),(0,l.CE)("div",gt,[(0,l.Lk)("div",yt,[t[1]||(t[1]=(0,l.Lk)("div",{class:"error-code"},"404",-1)),t[2]||(t[2]=(0,l.Lk)("h1",{class:"mt-4"},"页面未找到",-1)),t[3]||(t[3]=(0,l.Lk)("p",{class:"lead"},"您访问的页面不存在或已被移除",-1)),(0,l.Lk)("div",ft,[(0,l.bF)(o,{to:"/",class:"btn btn-primary"},{default:(0,l.k6)(()=>t[0]||(t[0]=[(0,l.Lk)("i",{class:"bi bi-house-door me-2"},null,-1),(0,l.eW)("返回首页 ")])),_:1,__:[0]})])])])}const wt={name:"NotFound"},It=(0,A.A)(wt,[["render",Dt],["__scopeId","data-v-4c6a86b4"]]),Ct=It,Tt={class:"all-nfts"},Ft={key:0,class:"text-center my-5"},Et={key:1,class:"text-center my-5"},_t={key:2,class:"row"},Nt={class:"card nft-card h-100"},xt=["src","alt"],St={class:"card-body"},Rt={key:0,class:"text-center mb-2"},At={class:"card-title"},Mt={class:"card-text"},Wt={key:1,class:"mt-3"},Xt={class:"row g-2 mt-2"},Ot={class:"attribute-box p-2 border rounded"},qt={class:"text-muted small"},$t={class:"fw-bold"},Pt={key:2,class:"mt-3"},Kt={key:0,class:"mt-2 mb-2"},Ut={class:"attribute-box p-2 border rounded bg-light"},Vt={class:"fw-bold"},Qt={key:1,class:"mt-2"},jt={class:"attribute-box p-2 border rounded bg-light"},Bt=["title"],Gt={class:"mt-3"},Jt={class:"card-text"},zt={class:"text-muted"},Ht={class:"card-text"},Zt={class:"text-muted"},Yt={class:"d-flex gap-2 mt-3"},ea=["onClick"],ta=["onClick"],aa={class:"modal fade",ref:"nftDetailsModal",tabindex:"-1"},sa={class:"modal-dialog modal-lg"},la={class:"modal-content"},ia={key:0,class:"modal-body"},na={class:"row"},oa={class:"col-md-5"},ra=["src","alt"],da={class:"col-md-7"},ca={class:"mt-3"},ua={class:"table table-sm"},ma={class:"text-break"},ba={key:0},ka={key:0,class:"mt-3"},pa={class:"row g-2"},va={class:"attribute-box p-2 border rounded"},ha={class:"text-muted small"},La={class:"fw-bold"},ga={key:1,class:"mt-3"},ya={key:0,class:"mt-2"},fa={class:"attribute-box p-2 border rounded bg-light"},Da={class:"fw-bold"},wa={key:1,class:"mt-2"},Ia={class:"attribute-box p-2 border rounded bg-light"},Ca={class:"fw-bold text-break"},Ta={class:"modal fade",ref:"requestChildModal",tabindex:"-1"},Fa={class:"modal-dialog"},Ea={class:"modal-content"},_a={class:"modal-body"},Na={class:"mb-3"},xa={class:"mb-3"},Sa={class:"modal-footer"},Ra=["disabled"],Aa={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"};function Ma(e,t,a,i,n,o){const r=(0,l.g2)("router-link");return(0,l.uX)(),(0,l.CE)("div",Tt,[t[33]||(t[33]=(0,l.Lk)("h2",null,[(0,l.Lk)("i",{class:"bi bi-grid me-2"}),(0,l.eW)("所有NFT")],-1)),i.isLoading?((0,l.uX)(),(0,l.CE)("div",Ft,t[5]||(t[5]=[(0,l.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,l.Lk)("span",{class:"visually-hidden"},"加载中...")],-1),(0,l.Lk)("p",{class:"mt-2"},"加载NFT列表...",-1)]))):i.nfts.length?((0,l.uX)(),(0,l.CE)("div",_t,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.nfts,e=>((0,l.uX)(),(0,l.CE)("div",{key:e.tokenId,class:"col-md-4 mb-4"},[(0,l.Lk)("div",Nt,[(0,l.Lk)("img",{src:i.getNFTImage(e),class:"card-img-top",alt:i.getNFTName(e),onError:t[0]||(t[0]=(...e)=>i.handleImageError&&i.handleImageError(...e))},null,40,xt),(0,l.Lk)("div",St,[!e.metadata&&e.uri?((0,l.uX)(),(0,l.CE)("div",Rt,t[9]||(t[9]=[(0,l.Lk)("div",{class:"spinner-border spinner-border-sm text-primary",role:"status"},[(0,l.Lk)("span",{class:"visually-hidden"},"加载中...")],-1),(0,l.Lk)("small",{class:"text-muted ms-1"},"加载元数据中...",-1)]))):(0,l.Q3)("",!0),(0,l.Lk)("h5",At,(0,L.v_)(i.getNFTName(e)),1),(0,l.Lk)("p",Mt,(0,L.v_)(i.getNFTDescription(e)),1),i.hasAttributes(e)?((0,l.uX)(),(0,l.CE)("div",Wt,[t[10]||(t[10]=(0,l.Lk)("h6",{class:"border-bottom pb-2"},"属性",-1)),(0,l.Lk)("div",Xt,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.getAttributes(e),(e,t)=>((0,l.uX)(),(0,l.CE)("div",{key:t,class:"col-6"},[(0,l.Lk)("div",Ot,[(0,l.Lk)("div",qt,(0,L.v_)(e.trait_type),1),(0,l.Lk)("div",$t,(0,L.v_)(e.value),1)])]))),128))])])):(0,l.Q3)("",!0),i.hasAccessControl(e)?((0,l.uX)(),(0,l.CE)("div",Pt,[t[13]||(t[13]=(0,l.Lk)("h6",{class:"border-bottom pb-2"},"访问控制",-1)),i.getPolicy(e)?((0,l.uX)(),(0,l.CE)("div",Kt,[(0,l.Lk)("div",Ut,[t[11]||(t[11]=(0,l.Lk)("div",{class:"text-muted small"},"访问策略",-1)),(0,l.Lk)("div",Vt,(0,L.v_)(i.getPolicy(e)),1)])])):(0,l.Q3)("",!0),i.getCiphertext(e)?((0,l.uX)(),(0,l.CE)("div",Qt,[(0,l.Lk)("div",jt,[t[12]||(t[12]=(0,l.Lk)("div",{class:"text-muted small"},"密文",-1)),(0,l.Lk)("div",{class:"fw-bold text-truncate",title:i.getCiphertext(e)},(0,L.v_)(i.truncateText(i.getCiphertext(e),20)),9,Bt)])])):(0,l.Q3)("",!0)])):(0,l.Q3)("",!0),(0,l.Lk)("div",Gt,[(0,l.Lk)("p",Jt,[(0,l.Lk)("small",zt,"Token ID: "+(0,L.v_)(e.tokenId),1)]),(0,l.Lk)("p",Ht,[(0,l.Lk)("small",Zt,"Owner: "+(0,L.v_)(i.formatAddress(e.owner)),1)])]),(0,l.Lk)("div",Yt,[(0,l.Lk)("button",{class:"btn btn-outline-primary btn-sm",onClick:t=>i.viewNFTDetails(e)},t[14]||(t[14]=[(0,l.Lk)("i",{class:"bi bi-info-circle me-1"},null,-1),(0,l.eW)("详情 ")]),8,ea),i.isConnected?((0,l.uX)(),(0,l.CE)("button",{key:0,class:"btn btn-outline-primary btn-sm",onClick:t=>i.requestChildNFT(e.tokenId)},t[15]||(t[15]=[(0,l.Lk)("i",{class:"bi bi-plus-circle me-1"},null,-1),(0,l.eW)("申请子NFT ")]),8,ta)):(0,l.Q3)("",!0)])])])]))),128))])):((0,l.uX)(),(0,l.CE)("div",Et,[t[7]||(t[7]=(0,l.Lk)("i",{class:"bi bi-collection fs-1 text-muted"},null,-1)),t[8]||(t[8]=(0,l.Lk)("p",{class:"lead mt-3"},"暂无NFT",-1)),(0,l.bF)(r,{to:{name:"MintNFT"},class:"btn btn-primary mt-2"},{default:(0,l.k6)(()=>t[6]||(t[6]=[(0,l.Lk)("i",{class:"bi bi-plus-circle me-1"},null,-1),(0,l.eW)("铸造NFT ")])),_:1,__:[6]})])),(0,l.Lk)("div",aa,[(0,l.Lk)("div",sa,[(0,l.Lk)("div",la,[t[25]||(t[25]=(0,l.Lk)("div",{class:"modal-header"},[(0,l.Lk)("h5",{class:"modal-title"},"NFT详情"),(0,l.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),i.selectedNFT?((0,l.uX)(),(0,l.CE)("div",ia,[(0,l.Lk)("div",na,[(0,l.Lk)("div",oa,[(0,l.Lk)("img",{src:i.getNFTImage(i.selectedNFT),class:"img-fluid rounded",alt:i.getNFTName(i.selectedNFT),onError:t[1]||(t[1]=(...e)=>i.handleImageError&&i.handleImageError(...e))},null,40,ra)]),(0,l.Lk)("div",da,[(0,l.Lk)("h4",null,(0,L.v_)(i.getNFTName(i.selectedNFT)),1),(0,l.Lk)("p",null,(0,L.v_)(i.getNFTDescription(i.selectedNFT)),1),(0,l.Lk)("div",ca,[t[20]||(t[20]=(0,l.Lk)("h6",null,"基本信息",-1)),(0,l.Lk)("table",ua,[(0,l.Lk)("tbody",null,[(0,l.Lk)("tr",null,[t[16]||(t[16]=(0,l.Lk)("th",null,"Token ID",-1)),(0,l.Lk)("td",null,(0,L.v_)(i.selectedNFT.tokenId),1)]),(0,l.Lk)("tr",null,[t[17]||(t[17]=(0,l.Lk)("th",null,"所有者",-1)),(0,l.Lk)("td",null,(0,L.v_)(i.selectedNFT.owner),1)]),(0,l.Lk)("tr",null,[t[18]||(t[18]=(0,l.Lk)("th",null,"URI",-1)),(0,l.Lk)("td",ma,(0,L.v_)(i.selectedNFT.uri),1)]),i.selectedNFT.isChildNft?((0,l.uX)(),(0,l.CE)("tr",ba,[t[19]||(t[19]=(0,l.Lk)("th",null,"父NFT ID",-1)),(0,l.Lk)("td",null,(0,L.v_)(i.selectedNFT.parentTokenId),1)])):(0,l.Q3)("",!0)])])]),i.hasAttributes(i.selectedNFT)?((0,l.uX)(),(0,l.CE)("div",ka,[t[21]||(t[21]=(0,l.Lk)("h6",null,"属性",-1)),(0,l.Lk)("div",pa,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.getAttributes(i.selectedNFT),(e,t)=>((0,l.uX)(),(0,l.CE)("div",{key:t,class:"col-6"},[(0,l.Lk)("div",va,[(0,l.Lk)("div",ha,(0,L.v_)(e.trait_type),1),(0,l.Lk)("div",La,(0,L.v_)(e.value),1)])]))),128))])])):(0,l.Q3)("",!0),i.hasAccessControl(i.selectedNFT)?((0,l.uX)(),(0,l.CE)("div",ga,[t[24]||(t[24]=(0,l.Lk)("h6",null,"访问控制",-1)),i.getPolicy(i.selectedNFT)?((0,l.uX)(),(0,l.CE)("div",ya,[(0,l.Lk)("div",fa,[t[22]||(t[22]=(0,l.Lk)("div",{class:"text-muted small"},"访问策略",-1)),(0,l.Lk)("div",Da,(0,L.v_)(i.getPolicy(i.selectedNFT)),1)])])):(0,l.Q3)("",!0),i.getCiphertext(i.selectedNFT)?((0,l.uX)(),(0,l.CE)("div",wa,[(0,l.Lk)("div",Ia,[t[23]||(t[23]=(0,l.Lk)("div",{class:"text-muted small"},"密文",-1)),(0,l.Lk)("div",Ca,(0,L.v_)(i.getCiphertext(i.selectedNFT)),1)])])):(0,l.Q3)("",!0)])):(0,l.Q3)("",!0)])])])):(0,l.Q3)("",!0),t[26]||(t[26]=(0,l.Lk)("div",{class:"modal-footer"},[(0,l.Lk)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"关闭")],-1))])])],512),(0,l.Lk)("div",Ta,[(0,l.Lk)("div",Fa,[(0,l.Lk)("div",Ea,[t[32]||(t[32]=(0,l.Lk)("div",{class:"modal-header"},[(0,l.Lk)("h5",{class:"modal-title"},"申请子NFT"),(0,l.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),(0,l.Lk)("form",{onSubmit:t[4]||(t[4]=(0,s.D$)((...e)=>i.submitChildNFTRequest&&i.submitChildNFTRequest(...e),["prevent"]))},[(0,l.Lk)("div",_a,[(0,l.Lk)("div",Na,[t[27]||(t[27]=(0,l.Lk)("label",{for:"request-parent-token-id",class:"form-label"},"父NFT ID",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control",id:"request-parent-token-id","onUpdate:modelValue":t[2]||(t[2]=e=>i.requestForm.parentTokenId=e),readonly:""},null,512),[[s.Jo,i.requestForm.parentTokenId]])]),(0,l.Lk)("div",xa,[t[28]||(t[28]=(0,l.Lk)("label",{for:"request-child-uri",class:"form-label"},"子NFT URI",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control",id:"request-child-uri","onUpdate:modelValue":t[3]||(t[3]=e=>i.requestForm.uri=e),placeholder:"ipfs://...",required:""},null,512),[[s.Jo,i.requestForm.uri]]),t[29]||(t[29]=(0,l.Lk)("div",{class:"form-text"},"指向子NFT元数据的URI",-1))])]),(0,l.Lk)("div",Sa,[t[31]||(t[31]=(0,l.Lk)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1)),(0,l.Lk)("button",{type:"submit",class:"btn btn-primary",disabled:i.isSubmitting},[i.isSubmitting?((0,l.uX)(),(0,l.CE)("span",Aa)):(0,l.Q3)("",!0),t[30]||(t[30]=(0,l.eW)(" 提交申请 "))],8,Ra)])],32)])])],512)])}const Wa={name:"AllNFTs",setup(){const e=(0,h.Pj)(),t=(0,N.KR)(null),a=(0,N.KR)(null);let s=null,i=null;const n=(0,l.EW)(()=>e.state.nft.allNFTs),o=(0,l.EW)(()=>e.state.app.isLoading),r=(0,l.EW)(()=>e.state.wallet.isConnected),d=(0,N.KR)(null),c=(0,N.KR)({parentTokenId:"",uri:""}),u=(0,N.KR)(!1),m=async()=>{await e.dispatch("nft/loadAllNFTs")},b=e=>{e.target.src="data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%22200%22%20height%3D%22200%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Crect%20width%3D%22100%25%22%20height%3D%22100%25%22%20fill%3D%22%23f0f0f0%22%2F%3E%3Ctext%20x%3D%2250%25%22%20y%3D%2250%25%22%20font-family%3D%22Arial%22%20font-size%3D%2224%22%20text-anchor%3D%22middle%22%20dominant-baseline%3D%22middle%22%20fill%3D%22%23999%22%3ENFT%20%E5%8D%A0%E4%BD%8D%E5%9B%BE%3C%2Ftext%3E%3C%2Fsvg%3E"},k=e=>{d.value=e,i&&i.show()},p=t=>{if(!r.value)return e.dispatch("app/showWarning","请先连接钱包"),void e.commit("wallet/setShowConnectPrompt",!0);c.value.parentTokenId=t,c.value.uri="",s&&s.show()},v=async()=>{if(c.value.parentTokenId&&c.value.uri)try{u.value=!0;const t=await e.dispatch("nft/requestChildNFT",{parentTokenId:c.value.parentTokenId,uri:c.value.uri});t&&(s&&s.hide(),c.value.parentTokenId="",c.value.uri="")}finally{u.value=!1}else e.dispatch("app/showError","请填写所有必填字段")},L=e=>!(!e||!e.metadata)&&(!(!e.metadata.attributes||!Array.isArray(e.metadata.attributes))&&e.metadata.attributes.some(e=>"Policy"===e.trait_type||"Encrypted_ciphertext"===e.trait_type)),g=e=>{if(!e||!e.metadata||!e.metadata.attributes)return null;const t=e.metadata.attributes.find(e=>"Policy"===e.trait_type);return t?t.value:null},y=e=>{if(!e||!e.metadata||!e.metadata.attributes)return null;const t=e.metadata.attributes.find(e=>"Encrypted_ciphertext"===e.trait_type);return t?t.value:null},f=(e,t)=>e?e.length>t?e.substring(0,t)+"...":e:"",D=e=>{if(console.log("获取NFT图像:",e.tokenId,e.uri,e.metadata),e.metadata&&e.metadata.image){if(console.log("使用元数据中的图像:",e.metadata.image),e.metadata.image.startsWith("ipfs://")){const t=e.metadata.image.replace("ipfs://","https://ipfs.io/ipfs/");return console.log("转换IPFS链接为HTTP:",t),t}return e.metadata.image}if(e.uri&&e.uri.startsWith("ipfs://")){const t=e.uri.replace("ipfs://","https://ipfs.io/ipfs/");return console.log("使用转换后的URI作为图像:",t),t}if(e.uri&&e.uri.trim().startsWith("{")&&e.uri.trim().endsWith("}"))try{const t=JSON.parse(e.uri);if(t.image){if(console.log("从URI JSON中提取图像:",t.image),t.image.startsWith("ipfs://")){const e=t.image.replace("ipfs://","https://ipfs.io/ipfs/");return console.log("转换IPFS链接为HTTP:",e),e}return t.image}}catch(t){console.error("解析URI JSON失败:",t)}return console.log("使用原始URI作为图像:",e.uri),e.uri||"data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%22200%22%20height%3D%22200%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Crect%20width%3D%22100%25%22%20height%3D%22100%25%22%20fill%3D%22%23f0f0f0%22%2F%3E%3Ctext%20x%3D%2250%25%22%20y%3D%2250%25%22%20font-family%3D%22Arial%22%20font-size%3D%2224%22%20text-anchor%3D%22middle%22%20dominant-baseline%3D%22middle%22%20fill%3D%22%23999%22%3ENFT%20%E5%8D%A0%E4%BD%8D%E5%9B%BE%3C%2Ftext%3E%3C%2Fsvg%3E"},w=e=>{if(console.log("获取NFT名称:",e.tokenId,e.uri),e.metadata&&e.metadata.name)return console.log("使用元数据中的名称:",e.metadata.name),e.metadata.name;if(e.uri&&e.uri.trim().startsWith("{")&&e.uri.trim().endsWith("}"))try{const t=JSON.parse(e.uri);if(t.name)return console.log("从URI JSON中提取名称:",t.name),t.name}catch(t){console.error("解析URI JSON失败:",t)}if(e.uri&&e.uri.startsWith("ipfs://")){const t=e.uri.replace("ipfs://","");return console.log("使用IPFS哈希作为名称的一部分:",t),`NFT #${e.tokenId} (${t.substring(0,8)}...)`}return"NFT #"+e.tokenId},I=e=>{if(console.log("获取NFT描述:",e.tokenId,e.uri),e.metadata&&e.metadata.description)return console.log("使用元数据中的描述:",e.metadata.description),e.metadata.description;if(e.uri&&e.uri.trim().startsWith("{")&&e.uri.trim().endsWith("}"))try{const t=JSON.parse(e.uri);if(t.description)return console.log("从URI JSON中提取描述:",t.description),t.description}catch(t){console.error("解析URI JSON失败:",t)}return"This is an NFT created on our platform"},C=e=>{if(console.log("获取NFT属性:",e.tokenId,e.uri),e.metadata&&e.metadata.attributes&&Array.isArray(e.metadata.attributes))return console.log("使用元数据中的属性:",e.metadata.attributes),e.metadata.attributes;if(e.uri&&e.uri.trim().startsWith("{")&&e.uri.trim().endsWith("}"))try{const t=JSON.parse(e.uri);if(t.attributes&&Array.isArray(t.attributes))return console.log("从URI JSON中提取属性:",t.attributes),t.attributes}catch(t){console.error("解析URI JSON失败:",t)}return[{trait_type:"Type",value:"child"===e.contractType?"Child NFT":"Main NFT"},{trait_type:"Rarity",value:"Common"}]},T=e=>{const t=C(e);return t&&t.length>0};return(0,l.sV)(()=>{m(),t.value&&(s=new S.aF(t.value)),a.value&&(i=new S.aF(a.value))}),{nfts:n,isLoading:o,isConnected:r,selectedNFT:d,requestForm:c,isSubmitting:u,requestChildModal:t,nftDetailsModal:a,handleImageError:b,viewNFTDetails:k,requestChildNFT:p,submitChildNFTRequest:v,hasAccessControl:L,getPolicy:g,getCiphertext:y,truncateText:f,formatAddress:ee,getNFTImage:D,getNFTName:w,getNFTDescription:I,getAttributes:C,hasAttributes:T}}},Xa=(0,A.A)(Wa,[["render",Ma],["__scopeId","data-v-30593c83"]]),Oa=Xa,qa={class:"mint-nft"},$a={class:"row"},Pa={class:"col-md-6"},Ka={class:"card"},Ua={class:"card-body"},Va={class:"mb-3"},Qa={class:"input-group"},ja=["disabled"],Ba={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},Ga={key:1,class:"bi bi-plus-circle me-1"},Ja={key:0,class:"card mt-4"},za={class:"card-header d-flex justify-content-between align-items-center"},Ha={class:"card-body"},Za={class:"table-responsive"},Ya={class:"table"},es=["title"],ts={class:"small"},as=["onClick"],ss={class:"text-center mt-2"},ls={class:"col-md-6"},is={class:"card"},ns={class:"card-body"},os={key:0,class:"text-center my-4"},rs={key:1,class:"text-center my-4"},ds={key:2,class:"metadata-preview"},cs=["src"],us={key:1,src:"data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%22200%22%20height%3D%22200%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Crect%20width%3D%22100%25%22%20height%3D%22100%25%22%20fill%3D%22%23f0f0f0%22%2F%3E%3Ctext%20x%3D%2250%25%22%20y%3D%2250%25%22%20font-family%3D%22Arial%22%20font-size%3D%2224%22%20text-anchor%3D%22middle%22%20dominant-baseline%3D%22middle%22%20fill%3D%22%23999%22%3ENFT%20%E5%8D%A0%E4%BD%8D%E5%9B%BE%3C%2Ftext%3E%3C%2Fsvg%3E",class:"img-fluid mb-3 rounded",alt:"NFT Preview"},ms={key:2,class:"mt-3"},bs={class:"row g-2 mt-2"},ks={class:"attribute-box p-2 border rounded"},ps={class:"text-muted small"},vs={class:"fw-bold"},hs={key:3,class:"mt-3"},Ls={key:0,class:"mt-2 mb-2"},gs={class:"attribute-box p-2 border rounded bg-light"},ys={class:"fw-bold"},fs={key:1,class:"mt-2"},Ds={class:"attribute-box p-2 border rounded bg-light"},ws=["title"],Is={class:"modal fade",ref:"metadataModal",tabindex:"-1"},Cs={class:"modal-dialog modal-lg"},Ts={class:"modal-content"},Fs={class:"modal-body"},Es={key:0,class:"text-center my-4"},_s={key:1,class:"text-center my-4"},Ns={key:2,class:"table-responsive"},xs={class:"table table-hover"},Ss=["onClick"],Rs=["title"],As={class:"small"},Ms=["onClick"],Ws={class:"modal fade",ref:"resultModal",tabindex:"-1"},Xs={class:"modal-dialog"},Os={class:"modal-content"},qs={class:"modal-body"},$s={class:"alert alert-success"},Ps={class:"d-block mt-2 p-2 bg-light"},Ks={class:"modal-footer"};function Us(e,t,a,i,n,o){const r=(0,l.g2)("router-link");return(0,l.uX)(),(0,l.CE)("div",qa,[t[36]||(t[36]=(0,l.Lk)("h2",null,[(0,l.Lk)("i",{class:"bi bi-plus-circle me-2"}),(0,l.eW)("铸造新NFT")],-1)),(0,l.Lk)("div",$a,[(0,l.Lk)("div",Pa,[(0,l.Lk)("div",Ka,[(0,l.Lk)("div",Ua,[(0,l.Lk)("form",{onSubmit:t[3]||(t[3]=(0,s.D$)((...e)=>i.mintNFT&&i.mintNFT(...e),["prevent"]))},[(0,l.Lk)("div",Va,[t[7]||(t[7]=(0,l.Lk)("label",{for:"nft-uri",class:"form-label"},"NFT URI (IPFS或HTTP)",-1)),(0,l.Lk)("div",Qa,[(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control",id:"nft-uri","onUpdate:modelValue":t[0]||(t[0]=e=>i.uri=e),placeholder:"ipfs://...",required:"",onInput:t[1]||(t[1]=(...e)=>i.debouncedFetchMetadata&&i.debouncedFetchMetadata(...e))},null,544),[[s.Jo,i.uri]]),(0,l.Lk)("button",{class:"btn btn-outline-secondary",type:"button",onClick:t[2]||(t[2]=(...e)=>i.openMetadataSelector&&i.openMetadataSelector(...e))},t[6]||(t[6]=[(0,l.Lk)("i",{class:"bi bi-search me-1"},null,-1),(0,l.eW)("选择元数据 ")]))]),t[8]||(t[8]=(0,l.Lk)("div",{class:"form-text"},"指向NFT元数据的URI",-1))]),(0,l.Lk)("button",{type:"submit",class:"btn btn-primary",disabled:i.isSubmitting},[i.isSubmitting?((0,l.uX)(),(0,l.CE)("span",Ba)):((0,l.uX)(),(0,l.CE)("i",Ga)),t[9]||(t[9]=(0,l.eW)("铸造NFT "))],8,ja)],32)])]),i.metadata.length?((0,l.uX)(),(0,l.CE)("div",Ja,[(0,l.Lk)("div",za,[t[11]||(t[11]=(0,l.Lk)("h5",{class:"mb-0"},[(0,l.Lk)("i",{class:"bi bi-list me-2"}),(0,l.eW)("最近创建的元数据")],-1)),(0,l.Lk)("button",{class:"btn btn-sm btn-outline-primary",onClick:t[4]||(t[4]=(...e)=>i.loadMetadata&&i.loadMetadata(...e))},t[10]||(t[10]=[(0,l.Lk)("i",{class:"bi bi-arrow-clockwise me-1"},null,-1),(0,l.eW)("刷新 ")]))]),(0,l.Lk)("div",Ha,[(0,l.Lk)("div",Za,[(0,l.Lk)("table",Ya,[t[13]||(t[13]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"名称"),(0,l.Lk)("th",null,"描述"),(0,l.Lk)("th",null,"IPFS哈希"),(0,l.Lk)("th",null,"操作")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.metadata.slice(0,5),e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.id},[(0,l.Lk)("td",null,(0,L.v_)(e.name),1),(0,l.Lk)("td",{title:e.description},(0,L.v_)(i.truncateText(e.description,30)),9,es),(0,l.Lk)("td",null,[(0,l.Lk)("code",ts,(0,L.v_)(e.ipfs_hash),1)]),(0,l.Lk)("td",null,[(0,l.Lk)("button",{class:"btn btn-sm btn-success",onClick:t=>i.useAsURI(e.ipfs_hash)},t[12]||(t[12]=[(0,l.Lk)("i",{class:"bi bi-check-circle me-1"},null,-1),(0,l.eW)("用作URI ")]),8,as)])]))),128))])])]),(0,l.Lk)("div",ss,[(0,l.bF)(r,{to:{name:"MetadataManager"},class:"btn btn-outline-primary btn-sm"},{default:(0,l.k6)(()=>t[14]||(t[14]=[(0,l.Lk)("i",{class:"bi bi-arrow-right me-1"},null,-1),(0,l.eW)("查看全部元数据 ")])),_:1,__:[14]})])])])):(0,l.Q3)("",!0)]),(0,l.Lk)("div",ls,[(0,l.Lk)("div",is,[t[21]||(t[21]=(0,l.Lk)("div",{class:"card-header"},[(0,l.Lk)("h5",{class:"mb-0"},"元数据预览")],-1)),(0,l.Lk)("div",ns,[i.isLoadingPreview?((0,l.uX)(),(0,l.CE)("div",os,t[15]||(t[15]=[(0,l.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,l.Lk)("span",{class:"visually-hidden"},"加载中...")],-1),(0,l.Lk)("p",{class:"mt-2"},"解析元数据中...",-1)]))):i.previewMetadata?((0,l.uX)(),(0,l.CE)("div",ds,[i.previewMetadata.image?((0,l.uX)(),(0,l.CE)("img",{key:0,src:i.previewMetadata.image,class:"img-fluid mb-3 rounded",alt:"NFT Preview",onError:t[5]||(t[5]=(...e)=>i.handleImageError&&i.handleImageError(...e))},null,40,cs)):((0,l.uX)(),(0,l.CE)("img",us)),(0,l.Lk)("h4",null,(0,L.v_)(i.previewMetadata.name||"NFT名称"),1),(0,l.Lk)("p",null,(0,L.v_)(i.previewMetadata.description||"暂无描述"),1),i.previewMetadata.attributes&&i.previewMetadata.attributes.length>0?((0,l.uX)(),(0,l.CE)("div",ms,[t[17]||(t[17]=(0,l.Lk)("h6",{class:"border-bottom pb-2"},"属性",-1)),(0,l.Lk)("div",bs,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.previewMetadata.attributes,(e,t)=>((0,l.uX)(),(0,l.CE)("div",{key:t,class:"col-6"},[(0,l.Lk)("div",ks,[(0,l.Lk)("div",ps,(0,L.v_)(e.trait_type),1),(0,l.Lk)("div",vs,(0,L.v_)(e.value),1)])]))),128))])])):(0,l.Q3)("",!0),i.hasAccessControl(i.previewMetadata)?((0,l.uX)(),(0,l.CE)("div",hs,[t[20]||(t[20]=(0,l.Lk)("h6",{class:"border-bottom pb-2"},"访问控制",-1)),i.getPolicy(i.previewMetadata)?((0,l.uX)(),(0,l.CE)("div",Ls,[(0,l.Lk)("div",gs,[t[18]||(t[18]=(0,l.Lk)("div",{class:"text-muted small"},"访问策略",-1)),(0,l.Lk)("div",ys,(0,L.v_)(i.getPolicy(i.previewMetadata)),1)])])):(0,l.Q3)("",!0),i.getCiphertext(i.previewMetadata)?((0,l.uX)(),(0,l.CE)("div",fs,[(0,l.Lk)("div",Ds,[t[19]||(t[19]=(0,l.Lk)("div",{class:"text-muted small"},"密文",-1)),(0,l.Lk)("div",{class:"fw-bold text-truncate",title:i.getCiphertext(i.previewMetadata)},(0,L.v_)(i.truncateText(i.getCiphertext(i.previewMetadata),20)),9,ws)])])):(0,l.Q3)("",!0)])):(0,l.Q3)("",!0)])):((0,l.uX)(),(0,l.CE)("div",rs,t[16]||(t[16]=[(0,l.Lk)("i",{class:"bi bi-card-image fs-1 text-muted"},null,-1),(0,l.Lk)("p",{class:"mt-3"},"输入有效的URI以查看元数据预览",-1)])))])])])]),(0,l.Lk)("div",Is,[(0,l.Lk)("div",Cs,[(0,l.Lk)("div",Ts,[t[27]||(t[27]=(0,l.Lk)("div",{class:"modal-header"},[(0,l.Lk)("h5",{class:"modal-title"},"选择元数据"),(0,l.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),(0,l.Lk)("div",Fs,[i.isLoadingMetadata?((0,l.uX)(),(0,l.CE)("div",Es,t[22]||(t[22]=[(0,l.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,l.Lk)("span",{class:"visually-hidden"},"加载中...")],-1),(0,l.Lk)("p",{class:"mt-2"},"加载元数据列表...",-1)]))):i.metadata.length?((0,l.uX)(),(0,l.CE)("div",Ns,[(0,l.Lk)("table",xs,[t[26]||(t[26]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"名称"),(0,l.Lk)("th",null,"描述"),(0,l.Lk)("th",null,"IPFS哈希"),(0,l.Lk)("th",null,"操作")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.metadata,e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.id,onClick:t=>i.selectMetadata(e)},[(0,l.Lk)("td",null,(0,L.v_)(e.name),1),(0,l.Lk)("td",{title:e.description},(0,L.v_)(i.truncateText(e.description,30)),9,Rs),(0,l.Lk)("td",null,[(0,l.Lk)("code",As,(0,L.v_)(e.ipfs_hash),1)]),(0,l.Lk)("td",null,[(0,l.Lk)("button",{class:"btn btn-sm btn-primary",onClick:(0,s.D$)(t=>i.selectMetadata(e),["stop"])},t[25]||(t[25]=[(0,l.Lk)("i",{class:"bi bi-check-circle me-1"},null,-1),(0,l.eW)("选择 ")]),8,Ms)])],8,Ss))),128))])])])):((0,l.uX)(),(0,l.CE)("div",_s,[t[24]||(t[24]=(0,l.Lk)("p",{class:"lead"},"暂无元数据",-1)),(0,l.bF)(r,{to:{name:"MetadataManager"},class:"btn btn-primary"},{default:(0,l.k6)(()=>t[23]||(t[23]=[(0,l.Lk)("i",{class:"bi bi-plus-circle me-1"},null,-1),(0,l.eW)("创建元数据 ")])),_:1,__:[23]})]))]),t[28]||(t[28]=(0,l.Lk)("div",{class:"modal-footer"},[(0,l.Lk)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消")],-1))])])],512),(0,l.Lk)("div",Ws,[(0,l.Lk)("div",Xs,[(0,l.Lk)("div",Os,[t[35]||(t[35]=(0,l.Lk)("div",{class:"modal-header"},[(0,l.Lk)("h5",{class:"modal-title"},"铸造结果"),(0,l.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),(0,l.Lk)("div",qs,[(0,l.Lk)("div",$s,[t[29]||(t[29]=(0,l.Lk)("h5",{class:"alert-heading"},"NFT铸造交易已提交!",-1)),t[30]||(t[30]=(0,l.Lk)("p",null,"您的NFT铸造交易已成功提交到区块链，请等待确认。",-1)),t[31]||(t[31]=(0,l.Lk)("hr",null,null,-1)),t[32]||(t[32]=(0,l.Lk)("p",{class:"mb-0"},"交易哈希:",-1)),(0,l.Lk)("code",Ps,(0,L.v_)(i.transactionHash),1)])]),(0,l.Lk)("div",Ks,[t[34]||(t[34]=(0,l.Lk)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"关闭",-1)),(0,l.bF)(r,{to:{name:"MyNFTs"},class:"btn btn-primary"},{default:(0,l.k6)(()=>t[33]||(t[33]=[(0,l.Lk)("i",{class:"bi bi-wallet me-1"},null,-1),(0,l.eW)("查看我的NFT ")])),_:1,__:[33]})])])])],512)])}const Vs={name:"MintNFT",setup(){const e=(0,h.Pj)(),t=(0,N.KR)(null),a=(0,N.KR)(null);let s=null,i=null;const n=(0,N.KR)(""),o=(0,N.KR)(!1),r=(0,N.KR)(""),d=(0,N.KR)(null),c=(0,N.KR)(!1);let u=null;const m=(0,l.EW)(()=>e.state.nft.metadata),b=(0,l.EW)(()=>e.state.app.isLoading),k=(0,N.KR)(!1),p=async()=>{k.value=!0;try{await e.dispatch("nft/loadMetadata")}finally{k.value=!1}},v=()=>{s&&s.show()},L=e=>{n.value=`ipfs://${e.ipfs_hash}`,s&&s.hide(),y(n.value)},g=e=>{n.value=`ipfs://${e}`,y(n.value)},y=async t=>{if(t){c.value=!0;try{const e=await ae.fetchMetadataFromURI(t);d.value=e}catch(a){console.error("获取元数据失败:",a),e.dispatch("app/showError","获取元数据失败: "+a.message),d.value=null}finally{c.value=!1}}else d.value=null},f=()=>{u&&clearTimeout(u),u=setTimeout(()=>{y(n.value)},500)},D=async()=>{if(n.value){o.value=!0;try{if(!e.state.wallet.isConnected)return void e.dispatch("app/showError","请先连接钱包");const t=await e.dispatch("nft/mintNFT",n.value);t&&(r.value=t,i&&i.show(),n.value="",d.value=null)}catch(t){console.error("铸造NFT失败:",t),e.dispatch("app/showError","铸造NFT失败: "+(t.message||"未知错误"))}finally{o.value=!1}}else e.dispatch("app/showError","请输入NFT URI")},w=e=>{e.target.src="data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%22200%22%20height%3D%22200%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Crect%20width%3D%22100%25%22%20height%3D%22100%25%22%20fill%3D%22%23f0f0f0%22%2F%3E%3Ctext%20x%3D%2250%25%22%20y%3D%2250%25%22%20font-family%3D%22Arial%22%20font-size%3D%2224%22%20text-anchor%3D%22middle%22%20dominant-baseline%3D%22middle%22%20fill%3D%22%23999%22%3ENFT%20%E5%8D%A0%E4%BD%8D%E5%9B%BE%3C%2Ftext%3E%3C%2Fsvg%3E",e.target.onerror=null},I=e=>!(!e||!e.attributes)&&(!(!e.attributes||!Array.isArray(e.attributes))&&e.attributes.some(e=>"Policy"===e.trait_type||"Encrypted_ciphertext"===e.trait_type)),C=e=>{if(!e||!e.attributes)return null;const t=e.attributes.find(e=>"Policy"===e.trait_type);return t?t.value:null},T=e=>{if(!e||!e.attributes)return null;const t=e.attributes.find(e=>"Encrypted_ciphertext"===e.trait_type);return t?t.value:null},F=e=>{if(!e)return"";const t=new Date(e);return t.toLocaleString()},E=(e,t)=>e?e.length>t?e.substring(0,t)+"...":e:"";return(0,l.wB)(n,e=>{e||(d.value=null)}),(0,l.sV)(()=>{p(),t.value&&(s=new S.aF(t.value)),a.value&&(i=new S.aF(a.value))}),{uri:n,metadata:m,isLoading:b,isSubmitting:o,isLoadingMetadata:k,isLoadingPreview:c,previewMetadata:d,transactionHash:r,metadataModal:t,resultModal:a,mintNFT:D,loadMetadata:p,openMetadataSelector:v,selectMetadata:L,useAsURI:g,debouncedFetchMetadata:f,handleImageError:w,hasAccessControl:I,getPolicy:C,getCiphertext:T,formatDate:F,truncateText:E}}},Qs=(0,A.A)(Vs,[["render",Us],["__scopeId","data-v-45afb606"]]),js=Qs,Bs={class:"my-nfts"},Gs={key:0,class:"alert alert-info"},Js={key:1,class:"text-center my-5"},zs={key:2,class:"text-center my-5"},Hs={key:3,class:"row"},Zs={class:"card nft-card h-100"},Ys=["src","alt"],el={class:"card-body"},tl={key:0,class:"text-center mb-2"},al={class:"card-title"},sl={class:"card-text"},ll={key:1,class:"mt-3"},il={class:"row g-2 mt-2"},nl={class:"attribute-box p-2 border rounded"},ol={class:"text-muted small"},rl={class:"fw-bold"},dl={key:2,class:"mt-3"},cl={key:0,class:"mt-2 mb-2"},ul={class:"attribute-box p-2 border rounded bg-light"},ml={class:"fw-bold"},bl={key:1,class:"mt-2"},kl={class:"attribute-box p-2 border rounded bg-light"},pl=["title"],vl={class:"mt-3"},hl={class:"card-text"},Ll={class:"text-muted"},gl={class:"d-flex gap-2 mt-3"},yl=["onClick"],fl=["onClick"],Dl={class:"modal fade",ref:"nftDetailsModal",tabindex:"-1"},wl={class:"modal-dialog modal-lg"},Il={class:"modal-content"},Cl={key:0,class:"modal-body"},Tl={class:"row"},Fl={class:"col-md-5"},El=["src","alt"],_l={class:"col-md-7"},Nl={class:"mt-3"},xl={class:"table table-sm"},Sl={class:"text-break"},Rl={key:0},Al={key:0,class:"mt-3"},Ml={class:"row g-2"},Wl={class:"attribute-box p-2 border rounded"},Xl={class:"text-muted small"},Ol={class:"fw-bold"},ql={key:1,class:"mt-3"},$l={key:0,class:"mt-2"},Pl={class:"attribute-box p-2 border rounded bg-light"},Kl={class:"fw-bold"},Ul={key:1,class:"mt-2"},Vl={class:"attribute-box p-2 border rounded bg-light"},Ql={class:"fw-bold text-break"},jl={class:"modal-footer"};function Bl(e,t,a,s,i,n){const o=(0,l.g2)("router-link");return(0,l.uX)(),(0,l.CE)("div",Bs,[t[27]||(t[27]=(0,l.Lk)("h2",null,[(0,l.Lk)("i",{class:"bi bi-wallet me-2"}),(0,l.eW)("我的NFT")],-1)),s.isConnected?s.isLoading?((0,l.uX)(),(0,l.CE)("div",Js,t[4]||(t[4]=[(0,l.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,l.Lk)("span",{class:"visually-hidden"},"加载中...")],-1),(0,l.Lk)("p",{class:"mt-2"},"加载NFT中...",-1)]))):s.nfts.length?((0,l.uX)(),(0,l.CE)("div",Hs,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.nfts,e=>((0,l.uX)(),(0,l.CE)("div",{key:e.tokenId,class:"col-md-4 mb-4"},[(0,l.Lk)("div",Zs,[(0,l.Lk)("img",{src:s.getNFTImage(e),class:"card-img-top",alt:s.getNFTName(e),onError:t[0]||(t[0]=(...e)=>s.handleImageError&&s.handleImageError(...e))},null,40,Ys),(0,l.Lk)("div",el,[!e.metadata&&e.uri?((0,l.uX)(),(0,l.CE)("div",tl,t[8]||(t[8]=[(0,l.Lk)("div",{class:"spinner-border spinner-border-sm text-primary",role:"status"},[(0,l.Lk)("span",{class:"visually-hidden"},"加载中...")],-1),(0,l.Lk)("small",{class:"text-muted ms-1"},"加载元数据中...",-1)]))):(0,l.Q3)("",!0),(0,l.Lk)("h5",al,(0,L.v_)(s.getNFTName(e)),1),(0,l.Lk)("p",sl,(0,L.v_)(s.getNFTDescription(e)),1),s.hasAttributes(e)?((0,l.uX)(),(0,l.CE)("div",ll,[t[9]||(t[9]=(0,l.Lk)("h6",{class:"border-bottom pb-2"},"属性",-1)),(0,l.Lk)("div",il,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.getAttributes(e),(e,t)=>((0,l.uX)(),(0,l.CE)("div",{key:t,class:"col-6"},[(0,l.Lk)("div",nl,[(0,l.Lk)("div",ol,(0,L.v_)(e.trait_type),1),(0,l.Lk)("div",rl,(0,L.v_)(e.value),1)])]))),128))])])):(0,l.Q3)("",!0),s.hasAccessControl(e)?((0,l.uX)(),(0,l.CE)("div",dl,[t[12]||(t[12]=(0,l.Lk)("h6",{class:"border-bottom pb-2"},"访问控制",-1)),s.getPolicy(e)?((0,l.uX)(),(0,l.CE)("div",cl,[(0,l.Lk)("div",ul,[t[10]||(t[10]=(0,l.Lk)("div",{class:"text-muted small"},"访问策略",-1)),(0,l.Lk)("div",ml,(0,L.v_)(s.getPolicy(e)),1)])])):(0,l.Q3)("",!0),s.getCiphertext(e)?((0,l.uX)(),(0,l.CE)("div",bl,[(0,l.Lk)("div",kl,[t[11]||(t[11]=(0,l.Lk)("div",{class:"text-muted small"},"密文",-1)),(0,l.Lk)("div",{class:"fw-bold text-truncate",title:s.getCiphertext(e)},(0,L.v_)(s.truncateText(s.getCiphertext(e),20)),9,pl)])])):(0,l.Q3)("",!0)])):(0,l.Q3)("",!0),(0,l.Lk)("div",vl,[(0,l.Lk)("p",hl,[(0,l.Lk)("small",Ll,"Token ID: "+(0,L.v_)(e.tokenId),1)])]),(0,l.Lk)("div",gl,[(0,l.Lk)("button",{class:"btn btn-outline-primary btn-sm",onClick:t=>s.viewNFTDetails(e)},t[13]||(t[13]=[(0,l.Lk)("i",{class:"bi bi-info-circle me-1"},null,-1),(0,l.eW)("详情 ")]),8,yl),(0,l.Lk)("button",{class:"btn btn-outline-secondary btn-sm",onClick:t=>s.transferNFT(e)},t[14]||(t[14]=[(0,l.Lk)("i",{class:"bi bi-arrow-right me-1"},null,-1),(0,l.eW)("转移 ")]),8,fl)])])])]))),128))])):((0,l.uX)(),(0,l.CE)("div",zs,[t[6]||(t[6]=(0,l.Lk)("i",{class:"bi bi-collection fs-1 text-muted"},null,-1)),t[7]||(t[7]=(0,l.Lk)("p",{class:"lead mt-3"},"您还没有NFT",-1)),(0,l.bF)(o,{to:{name:"MintNFT"},class:"btn btn-primary mt-2"},{default:(0,l.k6)(()=>t[5]||(t[5]=[(0,l.Lk)("i",{class:"bi bi-plus-circle me-1"},null,-1),(0,l.eW)("铸造NFT ")])),_:1,__:[5]})])):((0,l.uX)(),(0,l.CE)("div",Gs,t[3]||(t[3]=[(0,l.Lk)("i",{class:"bi bi-info-circle me-2"},null,-1),(0,l.eW)("请先连接钱包以查看您的NFT ")]))),(0,l.Lk)("div",Dl,[(0,l.Lk)("div",wl,[(0,l.Lk)("div",Il,[t[26]||(t[26]=(0,l.Lk)("div",{class:"modal-header"},[(0,l.Lk)("h5",{class:"modal-title"},"NFT详情"),(0,l.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),s.selectedNFT?((0,l.uX)(),(0,l.CE)("div",Cl,[(0,l.Lk)("div",Tl,[(0,l.Lk)("div",Fl,[(0,l.Lk)("img",{src:s.getNFTImage(s.selectedNFT),class:"img-fluid rounded",alt:s.getNFTName(s.selectedNFT),onError:t[1]||(t[1]=(...e)=>s.handleImageError&&s.handleImageError(...e))},null,40,El)]),(0,l.Lk)("div",_l,[(0,l.Lk)("h4",null,(0,L.v_)(s.getNFTName(s.selectedNFT)),1),(0,l.Lk)("p",null,(0,L.v_)(s.getNFTDescription(s.selectedNFT)),1),(0,l.Lk)("div",Nl,[t[19]||(t[19]=(0,l.Lk)("h6",null,"基本信息",-1)),(0,l.Lk)("table",xl,[(0,l.Lk)("tbody",null,[(0,l.Lk)("tr",null,[t[15]||(t[15]=(0,l.Lk)("th",null,"Token ID",-1)),(0,l.Lk)("td",null,(0,L.v_)(s.selectedNFT.tokenId),1)]),(0,l.Lk)("tr",null,[t[16]||(t[16]=(0,l.Lk)("th",null,"所有者",-1)),(0,l.Lk)("td",null,(0,L.v_)(s.selectedNFT.owner),1)]),(0,l.Lk)("tr",null,[t[17]||(t[17]=(0,l.Lk)("th",null,"URI",-1)),(0,l.Lk)("td",Sl,(0,L.v_)(s.selectedNFT.uri),1)]),s.selectedNFT.isChildNft?((0,l.uX)(),(0,l.CE)("tr",Rl,[t[18]||(t[18]=(0,l.Lk)("th",null,"父NFT ID",-1)),(0,l.Lk)("td",null,(0,L.v_)(s.selectedNFT.parentTokenId),1)])):(0,l.Q3)("",!0)])])]),s.getAttributes(s.selectedNFT)&&s.getAttributes(s.selectedNFT).length>0?((0,l.uX)(),(0,l.CE)("div",Al,[t[20]||(t[20]=(0,l.Lk)("h6",null,"属性",-1)),(0,l.Lk)("div",Ml,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.getAttributes(s.selectedNFT),(e,t)=>((0,l.uX)(),(0,l.CE)("div",{key:t,class:"col-6"},[(0,l.Lk)("div",Wl,[(0,l.Lk)("div",Xl,(0,L.v_)(e.trait_type),1),(0,l.Lk)("div",Ol,(0,L.v_)(e.value),1)])]))),128))])])):(0,l.Q3)("",!0),s.hasAccessControl(s.selectedNFT)?((0,l.uX)(),(0,l.CE)("div",ql,[t[23]||(t[23]=(0,l.Lk)("h6",null,"访问控制",-1)),s.getPolicy(s.selectedNFT)?((0,l.uX)(),(0,l.CE)("div",$l,[(0,l.Lk)("div",Pl,[t[21]||(t[21]=(0,l.Lk)("div",{class:"text-muted small"},"访问策略",-1)),(0,l.Lk)("div",Kl,(0,L.v_)(s.getPolicy(s.selectedNFT)),1)])])):(0,l.Q3)("",!0),s.getCiphertext(s.selectedNFT)?((0,l.uX)(),(0,l.CE)("div",Ul,[(0,l.Lk)("div",Vl,[t[22]||(t[22]=(0,l.Lk)("div",{class:"text-muted small"},"密文",-1)),(0,l.Lk)("div",Ql,(0,L.v_)(s.getCiphertext(s.selectedNFT)),1)])])):(0,l.Q3)("",!0)])):(0,l.Q3)("",!0)])])])):(0,l.Q3)("",!0),(0,l.Lk)("div",jl,[t[25]||(t[25]=(0,l.Lk)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"关闭",-1)),s.selectedNFT?((0,l.uX)(),(0,l.CE)("button",{key:0,type:"button",class:"btn btn-primary",onClick:t[2]||(t[2]=e=>s.transferNFT(s.selectedNFT))},t[24]||(t[24]=[(0,l.Lk)("i",{class:"bi bi-arrow-right me-1"},null,-1),(0,l.eW)("转移NFT ")]))):(0,l.Q3)("",!0)])])])],512)])}const Gl={name:"MyNFTs",setup(){const e=(0,h.Pj)(),t=(0,x.rd)(),a=(0,N.KR)(null);let s=null;const i=(0,l.EW)(()=>e.state.nft.myNFTs),n=(0,l.EW)(()=>e.state.nft.isLoading),o=(0,l.EW)(()=>e.state.wallet.isConnected),r=(0,N.KR)(null),d=async()=>{o.value&&await e.dispatch("nft/loadMyNFTs")},c=e=>{e.target.src="data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%22200%22%20height%3D%22200%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Crect%20width%3D%22100%25%22%20height%3D%22100%25%22%20fill%3D%22%23f0f0f0%22%2F%3E%3Ctext%20x%3D%2250%25%22%20y%3D%2250%25%22%20font-family%3D%22Arial%22%20font-size%3D%2224%22%20text-anchor%3D%22middle%22%20dominant-baseline%3D%22middle%22%20fill%3D%22%23999%22%3ENFT%20%E5%8D%A0%E4%BD%8D%E5%9B%BE%3C%2Ftext%3E%3C%2Fsvg%3E",e.target.onerror=null},u=e=>e.metadata?.image||e.uri,m=e=>e.metadata?.name||"NFT #"+e.tokenId,b=e=>e.metadata?.description||"No description",k=e=>e.metadata?.attributes||[],p=e=>e.metadata?.attributes&&e.metadata.attributes.length>0,v=e=>{r.value=e,s&&s.show()},L=a=>{a&&(e.commit("nft/setSelectedNFT",a),t.push({name:"TransferNFT",params:{tokenId:a.tokenId}}))},g=e=>!(!e||!e.metadata)&&(!(!e.metadata.attributes||!Array.isArray(e.metadata.attributes))&&e.metadata.attributes.some(e=>"Policy"===e.trait_type||"Encrypted_ciphertext"===e.trait_type)),y=e=>{if(!e||!e.metadata||!e.metadata.attributes)return null;const t=e.metadata.attributes.find(e=>"Policy"===e.trait_type);return t?t.value:null},f=e=>{if(!e||!e.metadata||!e.metadata.attributes)return null;const t=e.metadata.attributes.find(e=>"Encrypted_ciphertext"===e.trait_type);return t?t.value:null},D=(e,t)=>e?e.length>t?e.substring(0,t)+"...":e:"";return(0,l.sV)(()=>{d(),a.value&&(s=new S.aF(a.value))}),{nfts:i,isLoading:n,isConnected:o,selectedNFT:r,nftDetailsModal:a,handleImageError:c,viewNFTDetails:v,transferNFT:L,hasAccessControl:g,getPolicy:y,getCiphertext:f,truncateText:D,formatAddress:ee,getNFTImage:u,getNFTName:m,getNFTDescription:b,getAttributes:k,hasAttributes:p}}},Jl=(0,A.A)(Gl,[["render",Bl],["__scopeId","data-v-ca419006"]]),zl=Jl,Hl={class:"container mt-4"},Zl={class:"row"},Yl={class:"col-md-6"},ei={class:"card"},ti={class:"card-body"},ai={class:"mb-3"},si={class:"mb-3"},li={class:"mb-3"},ii={class:"mb-3"},ni={class:"mb-3"},oi={class:"d-grid"},ri=["disabled"],di={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},ci={class:"col-md-6"},ui={class:"card"},mi={class:"card-body"},bi={key:0,class:"metadata-preview"},ki=["src"],pi={key:1,src:"data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%22200%22%20height%3D%22200%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Crect%20width%3D%22100%25%22%20height%3D%22100%25%22%20fill%3D%22%23f0f0f0%22%2F%3E%3Ctext%20x%3D%2250%25%22%20y%3D%2250%25%22%20font-family%3D%22Arial%22%20font-size%3D%2224%22%20text-anchor%3D%22middle%22%20dominant-baseline%3D%22middle%22%20fill%3D%22%23999%22%3ENFT%20%E5%8D%A0%E4%BD%8D%E5%9B%BE%3C%2Ftext%3E%3C%2Fsvg%3E",class:"img-fluid mb-3",alt:"NFT Preview"},vi={class:"row g-2"},hi={key:0,class:"col-12"},Li={class:"attribute-box p-2 border rounded bg-light"},gi={class:"fw-bold"},yi={key:1,class:"col-12 mt-2"},fi={class:"attribute-box p-2 border rounded bg-light"},Di={class:"fw-bold"},wi={key:1,class:"text-center p-5 text-muted"},Ii={key:0,class:"card mt-3"},Ci={class:"card-body"},Ti={class:"input-group"},Fi=["value"],Ei={class:"mt-3"},_i=["href"];function Ni(e,t,a,i,n,o){return(0,l.uX)(),(0,l.CE)("div",Hl,[t[26]||(t[26]=(0,l.Lk)("h2",null,"NFT 元数据管理",-1)),(0,l.Lk)("div",Zl,[(0,l.Lk)("div",Yl,[(0,l.Lk)("div",ei,[t[17]||(t[17]=(0,l.Lk)("div",{class:"card-header"}," 创建新元数据 ",-1)),(0,l.Lk)("div",ti,[(0,l.Lk)("form",{onSubmit:t[5]||(t[5]=(0,s.D$)((...e)=>o.createMetadata&&o.createMetadata(...e),["prevent"]))},[(0,l.Lk)("div",ai,[t[8]||(t[8]=(0,l.Lk)("label",{for:"name",class:"form-label"},"名称",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control",id:"name","onUpdate:modelValue":t[0]||(t[0]=e=>n.newMetadata.name=e),required:""},null,512),[[s.Jo,n.newMetadata.name]])]),(0,l.Lk)("div",si,[t[9]||(t[9]=(0,l.Lk)("label",{for:"description",class:"form-label"},"描述",-1)),(0,l.bo)((0,l.Lk)("textarea",{class:"form-control",id:"description","onUpdate:modelValue":t[1]||(t[1]=e=>n.newMetadata.description=e),rows:"3",required:""},null,512),[[s.Jo,n.newMetadata.description]])]),(0,l.Lk)("div",li,[t[10]||(t[10]=(0,l.Lk)("label",{for:"image",class:"form-label"},"图片 URL",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control",id:"image","onUpdate:modelValue":t[2]||(t[2]=e=>n.newMetadata.image=e),required:""},null,512),[[s.Jo,n.newMetadata.image]]),t[11]||(t[11]=(0,l.Lk)("div",{class:"form-text"},"IPFS 或 HTTP URL",-1))]),(0,l.Lk)("div",ii,[t[12]||(t[12]=(0,l.Lk)("label",{for:"policy",class:"form-label"},"访问策略",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control",id:"policy","onUpdate:modelValue":t[3]||(t[3]=e=>n.newMetadata.policy=e),required:""},null,512),[[s.Jo,n.newMetadata.policy]]),t[13]||(t[13]=(0,l.Lk)("div",{class:"form-text"},'ABE访问策略，例如: "department:CS AND year:2023"',-1))]),(0,l.Lk)("div",ni,[t[14]||(t[14]=(0,l.Lk)("label",{for:"ciphertext",class:"form-label"},"密文",-1)),(0,l.bo)((0,l.Lk)("textarea",{class:"form-control",id:"ciphertext","onUpdate:modelValue":t[4]||(t[4]=e=>n.newMetadata.ciphertext=e),rows:"3",required:""},null,512),[[s.Jo,n.newMetadata.ciphertext]]),t[15]||(t[15]=(0,l.Lk)("div",{class:"form-text"},'加密后的内容（如果没有，请输入"none"）',-1))]),(0,l.Lk)("div",oi,[(0,l.Lk)("button",{type:"submit",class:"btn btn-primary",disabled:n.isSubmitting},[n.isSubmitting?((0,l.uX)(),(0,l.CE)("span",di)):(0,l.Q3)("",!0),t[16]||(t[16]=(0,l.eW)(" 创建元数据 "))],8,ri)])],32)])])]),(0,l.Lk)("div",ci,[(0,l.Lk)("div",ui,[t[22]||(t[22]=(0,l.Lk)("div",{class:"card-header"}," 预览 ",-1)),(0,l.Lk)("div",mi,[n.newMetadata.name||n.newMetadata.description||n.newMetadata.image?((0,l.uX)(),(0,l.CE)("div",bi,[n.newMetadata.image?((0,l.uX)(),(0,l.CE)("img",{key:0,src:n.newMetadata.image,class:"img-fluid mb-3",alt:"NFT Preview",onError:t[6]||(t[6]=(...e)=>o.handleImageError&&o.handleImageError(...e))},null,40,ki)):((0,l.uX)(),(0,l.CE)("img",pi)),(0,l.Lk)("h4",null,(0,L.v_)(n.newMetadata.name||"NFT 名称"),1),(0,l.Lk)("p",null,(0,L.v_)(n.newMetadata.description||"暂无描述"),1),(0,l.Lk)("div",null,[t[20]||(t[20]=(0,l.Lk)("h5",{class:"mt-3"},"访问控制",-1)),(0,l.Lk)("div",vi,[n.newMetadata.policy?((0,l.uX)(),(0,l.CE)("div",hi,[(0,l.Lk)("div",Li,[t[18]||(t[18]=(0,l.Lk)("div",{class:"text-muted small"},"访问策略",-1)),(0,l.Lk)("div",gi,(0,L.v_)(n.newMetadata.policy),1)])])):(0,l.Q3)("",!0),n.newMetadata.ciphertext?((0,l.uX)(),(0,l.CE)("div",yi,[(0,l.Lk)("div",fi,[t[19]||(t[19]=(0,l.Lk)("div",{class:"text-muted small"},"密文",-1)),(0,l.Lk)("div",Di,(0,L.v_)(n.newMetadata.ciphertext.length>20?n.newMetadata.ciphertext.substring(0,20)+"...":n.newMetadata.ciphertext),1)])])):(0,l.Q3)("",!0)])])])):((0,l.uX)(),(0,l.CE)("div",wi,t[21]||(t[21]=[(0,l.Lk)("i",{class:"bi bi-card-image fs-1"},null,-1),(0,l.Lk)("p",{class:"mt-3"},"填写表单以查看预览",-1)])))])]),n.metadataUrl?((0,l.uX)(),(0,l.CE)("div",Ii,[t[25]||(t[25]=(0,l.Lk)("div",{class:"card-header"}," 元数据 URL ",-1)),(0,l.Lk)("div",Ci,[(0,l.Lk)("div",Ti,[(0,l.Lk)("input",{type:"text",class:"form-control",value:n.metadataUrl,readonly:""},null,8,Fi),(0,l.Lk)("button",{class:"btn btn-outline-secondary",type:"button",onClick:t[7]||(t[7]=e=>o.copyToClipboard(n.metadataUrl))},t[23]||(t[23]=[(0,l.Lk)("i",{class:"bi bi-clipboard"},null,-1)]))]),(0,l.Lk)("div",Ei,[(0,l.Lk)("a",{href:n.metadataUrl,target:"_blank",class:"btn btn-sm btn-outline-primary"},t[24]||(t[24]=[(0,l.Lk)("i",{class:"bi bi-box-arrow-up-right me-1"},null,-1),(0,l.eW)("打开链接 ")]),8,_i)])])])):(0,l.Q3)("",!0)])])])}const xi={name:"MetadataManager",data(){return{newMetadata:{name:"",description:"",image:"",policy:"",ciphertext:"none"},isSubmitting:!1,metadataUrl:""}},methods:{handleImageError(e){e.target.src.includes("placeholder")||(e.target.src="data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%22200%22%20height%3D%22200%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Crect%20width%3D%22100%25%22%20height%3D%22100%25%22%20fill%3D%22%23f0f0f0%22%2F%3E%3Ctext%20x%3D%2250%25%22%20y%3D%2250%25%22%20font-family%3D%22Arial%22%20font-size%3D%2224%22%20text-anchor%3D%22middle%22%20dominant-baseline%3D%22middle%22%20fill%3D%22%23999%22%3ENFT%20%E5%8D%A0%E4%BD%8D%E5%9B%BE%3C%2Ftext%3E%3C%2Fsvg%3E",e.target.onerror=null)},async createMetadata(){if(this.newMetadata.name&&this.newMetadata.description&&this.newMetadata.image&&this.newMetadata.policy&&this.newMetadata.ciphertext){this.isSubmitting=!0;try{const e={name:this.newMetadata.name,description:this.newMetadata.description,image:this.newMetadata.image,external_url:"",policy:this.newMetadata.policy,ciphertext:this.newMetadata.ciphertext};console.log("提交的元数据:",e);const t=await fetch(`${this.$apiBaseUrl}/metadata`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){const e=await t.json();throw new Error(e.error||"上传元数据失败")}const a=await t.json();this.metadataUrl=`ipfs://${a.ipfs_hash}`,this.$store.commit("notifications/add",{type:"success",message:"元数据创建成功! IPFS哈希: "+a.ipfs_hash})}catch(e){console.error("创建元数据失败:",e),this.$store.commit("notifications/add",{type:"danger",message:"创建元数据失败: "+e.message})}finally{this.isSubmitting=!1}}else this.$store.commit("notifications/add",{type:"danger",message:"请填写所有必填字段"})},copyToClipboard(e){navigator.clipboard.writeText(e).then(()=>{this.$store.commit("notifications/add",{type:"success",message:"URL已复制到剪贴板"})},()=>{this.$store.commit("notifications/add",{type:"danger",message:"复制到剪贴板失败"})})}}},Si=(0,A.A)(xi,[["render",Ni],["__scopeId","data-v-ea5af046"]]),Ri=Si,Ai={class:"request-manager"},Mi={class:"card"},Wi={class:"card-header d-flex justify-content-between align-items-center"},Xi={class:"btn-group me-2",role:"group"},Oi={class:"card-body"},qi={key:0,class:"text-center my-3"},$i={key:1,class:"text-center my-3"},Pi={key:2,class:"table-responsive"},Ki={class:"table"},Ui={class:"btn-group"},Vi=["onClick"],Qi=["onClick"],ji=["onClick"],Bi={class:"modal fade",ref:"requestDetailModal",tabindex:"-1"},Gi={class:"modal-dialog modal-lg"},Ji={class:"modal-content"},zi={key:0,class:"modal-body"},Hi={class:"row"},Zi={class:"col-md-6"},Yi={class:"col-md-6"},en={key:0},tn={key:0,class:"mt-3"},an={class:"d-block p-2 bg-light"},sn={class:"modal-footer"},ln={key:0,class:"btn-group"};function nn(e,t,a,s,i,n){return(0,l.uX)(),(0,l.CE)("div",Ai,[t[28]||(t[28]=(0,l.Lk)("h2",null,[(0,l.Lk)("i",{class:"bi bi-file-earmark-text me-2"}),(0,l.eW)("NFT请求管理")],-1)),(0,l.Lk)("div",Mi,[(0,l.Lk)("div",Wi,[t[8]||(t[8]=(0,l.Lk)("h5",{class:"mb-0"},[(0,l.Lk)("i",{class:"bi bi-list-ul me-2"}),(0,l.eW)("请求列表")],-1)),(0,l.Lk)("div",null,[(0,l.Lk)("div",Xi,[(0,l.Lk)("button",{class:(0,L.C4)(["btn btn-sm",{"btn-primary":"all"===s.filter,"btn-outline-primary":"all"!==s.filter}]),onClick:t[0]||(t[0]=e=>s.setFilter("all"))}," 全部 ",2),(0,l.Lk)("button",{class:(0,L.C4)(["btn btn-sm",{"btn-primary":"pending"===s.filter,"btn-outline-primary":"pending"!==s.filter}]),onClick:t[1]||(t[1]=e=>s.setFilter("pending"))}," 待处理 ",2),(0,l.Lk)("button",{class:(0,L.C4)(["btn btn-sm",{"btn-primary":"approved"===s.filter,"btn-outline-primary":"approved"!==s.filter}]),onClick:t[2]||(t[2]=e=>s.setFilter("approved"))}," 已批准 ",2),(0,l.Lk)("button",{class:(0,L.C4)(["btn btn-sm",{"btn-primary":"rejected"===s.filter,"btn-outline-primary":"rejected"!==s.filter}]),onClick:t[3]||(t[3]=e=>s.setFilter("rejected"))}," 已拒绝 ",2)]),(0,l.Lk)("button",{class:"btn btn-sm btn-outline-primary",onClick:t[4]||(t[4]=(...e)=>s.loadRequests&&s.loadRequests(...e))},t[7]||(t[7]=[(0,l.Lk)("i",{class:"bi bi-arrow-clockwise me-1"},null,-1),(0,l.eW)("刷新 ")]))])]),(0,l.Lk)("div",Oi,[s.isLoading?((0,l.uX)(),(0,l.CE)("div",qi,t[9]||(t[9]=[(0,l.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,l.Lk)("span",{class:"visually-hidden"},"加载中...")],-1),(0,l.Lk)("p",{class:"mt-2"},"加载请求列表...",-1)]))):s.filteredRequests.length?((0,l.uX)(),(0,l.CE)("div",Pi,[(0,l.Lk)("table",Ki,[t[14]||(t[14]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Token ID"),(0,l.Lk)("th",null,"请求者"),(0,l.Lk)("th",null,"状态"),(0,l.Lk)("th",null,"创建时间"),(0,l.Lk)("th",null,"操作")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.filteredRequests,e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.id},[(0,l.Lk)("td",null,[(0,l.Lk)("strong",null,(0,L.v_)(e.token_id||e.tokenId||e.parentTokenId||"新铸造"),1)]),(0,l.Lk)("td",null,[(0,l.Lk)("code",null,(0,L.v_)(s.truncateAddress(e.requester||e.applicantAddress)),1)]),(0,l.Lk)("td",null,[(0,l.Lk)("span",{class:(0,L.C4)(["badge","pending"===e.status?"bg-warning":"approved"===e.status?"bg-success":"bg-danger"])},(0,L.v_)(s.getStatusText(e.status)),3)]),(0,l.Lk)("td",null,(0,L.v_)(s.formatDate(e.created_at||e.createdAt)),1),(0,l.Lk)("td",null,[(0,l.Lk)("div",Ui,[(0,l.Lk)("button",{class:"btn btn-sm btn-outline-primary me-1",onClick:t=>s.viewRequest(e),title:"查看详情"},t[11]||(t[11]=[(0,l.Lk)("i",{class:"bi bi-eye"},null,-1)]),8,Vi),"pending"===e.status?((0,l.uX)(),(0,l.CE)("button",{key:0,class:"btn btn-sm btn-success me-1",onClick:t=>s.handleApproveRequest(e.id||e.requestId),title:"批准"},t[12]||(t[12]=[(0,l.Lk)("i",{class:"bi bi-check-lg"},null,-1)]),8,Qi)):(0,l.Q3)("",!0),"pending"===e.status?((0,l.uX)(),(0,l.CE)("button",{key:1,class:"btn btn-sm btn-danger",onClick:t=>s.handleRejectRequest(e.id||e.requestId),title:"拒绝"},t[13]||(t[13]=[(0,l.Lk)("i",{class:"bi bi-x-lg"},null,-1)]),8,ji)):(0,l.Q3)("",!0)])])]))),128))])])])):((0,l.uX)(),(0,l.CE)("div",$i,t[10]||(t[10]=[(0,l.Lk)("p",{class:"lead"},"暂无符合条件的请求",-1)])))])]),(0,l.Lk)("div",Bi,[(0,l.Lk)("div",Gi,[(0,l.Lk)("div",Ji,[t[27]||(t[27]=(0,l.Lk)("div",{class:"modal-header"},[(0,l.Lk)("h5",{class:"modal-title"},"请求详情"),(0,l.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),s.selectedRequest?((0,l.uX)(),(0,l.CE)("div",zi,[(0,l.Lk)("div",Hi,[(0,l.Lk)("div",Zi,[(0,l.Lk)("p",null,[t[15]||(t[15]=(0,l.Lk)("strong",null,"请求ID:",-1)),(0,l.eW)(" "+(0,L.v_)(s.selectedRequest.id||s.selectedRequest.requestId||"未知"),1)]),(0,l.Lk)("p",null,[t[16]||(t[16]=(0,l.Lk)("strong",null,"请求者:",-1)),(0,l.eW)(" "+(0,L.v_)(s.selectedRequest.requester||s.selectedRequest.applicantAddress||"未知"),1)]),(0,l.Lk)("p",null,[t[17]||(t[17]=(0,l.Lk)("strong",null,"状态:",-1)),(0,l.Lk)("span",{class:(0,L.C4)(["badge","pending"===s.selectedRequest.status?"bg-warning":"approved"===s.selectedRequest.status?"bg-success":"bg-danger"])},(0,L.v_)(s.getStatusText(s.selectedRequest.status)),3)])]),(0,l.Lk)("div",Yi,[(0,l.Lk)("p",null,[t[18]||(t[18]=(0,l.Lk)("strong",null,"Token ID:",-1)),(0,l.eW)(" "+(0,L.v_)(s.selectedRequest.token_id||s.selectedRequest.tokenId||s.selectedRequest.parentTokenId||"新铸造"),1)]),(0,l.Lk)("p",null,[t[19]||(t[19]=(0,l.Lk)("strong",null,"接收者:",-1)),(0,l.eW)(" "+(0,L.v_)(s.selectedRequest.recipient||s.selectedRequest.receiverAddress||"不适用"),1)]),(0,l.Lk)("p",null,[t[20]||(t[20]=(0,l.Lk)("strong",null,"URI:",-1)),(0,l.eW)(" "+(0,L.v_)(s.selectedRequest.uri||"不适用"),1)]),(0,l.Lk)("p",null,[t[21]||(t[21]=(0,l.Lk)("strong",null,"创建时间:",-1)),(0,l.eW)(" "+(0,L.v_)(s.formatDate(s.selectedRequest.created_at||s.selectedRequest.createdAt)),1)]),s.selectedRequest.processed_at||s.selectedRequest.processedAt?((0,l.uX)(),(0,l.CE)("p",en,[t[22]||(t[22]=(0,l.Lk)("strong",null,"处理时间:",-1)),(0,l.eW)(" "+(0,L.v_)(s.formatDate(s.selectedRequest.processed_at||s.selectedRequest.processedAt)),1)])):(0,l.Q3)("",!0)])]),s.selectedRequest.transaction_hash||s.selectedRequest.transactionHash?((0,l.uX)(),(0,l.CE)("div",tn,[t[23]||(t[23]=(0,l.Lk)("h6",null,"交易哈希:",-1)),(0,l.Lk)("code",an,(0,L.v_)(s.selectedRequest.transaction_hash||s.selectedRequest.transactionHash),1)])):(0,l.Q3)("",!0)])):(0,l.Q3)("",!0),(0,l.Lk)("div",sn,[t[26]||(t[26]=(0,l.Lk)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"关闭",-1)),s.selectedRequest&&"pending"===s.selectedRequest.status?((0,l.uX)(),(0,l.CE)("div",ln,[(0,l.Lk)("button",{type:"button",class:"btn btn-success",onClick:t[5]||(t[5]=e=>s.handleApproveRequest(s.selectedRequest.id||s.selectedRequest.requestId))},t[24]||(t[24]=[(0,l.Lk)("i",{class:"bi bi-check me-1"},null,-1),(0,l.eW)("批准 ")])),(0,l.Lk)("button",{type:"button",class:"btn btn-danger",onClick:t[6]||(t[6]=e=>s.handleRejectRequest(s.selectedRequest.id||s.selectedRequest.requestId))},t[25]||(t[25]=[(0,l.Lk)("i",{class:"bi bi-x me-1"},null,-1),(0,l.eW)("拒绝 ")]))])):(0,l.Q3)("",!0)])])])],512)])}const on={name:"RequestManager",setup(){const e=(0,h.Pj)(),t=(0,N.KR)(null);let a=null;const s=(0,l.EW)(()=>e.state.nft.requests),i=(0,l.EW)(()=>e.state.nft.isLoading||e.state.app.isLoading),n=(0,l.EW)(()=>e.state.wallet.isAdmin),o=(0,N.KR)("all"),r=(0,l.EW)(()=>"all"===o.value?s.value:s.value.filter(e=>e.status===o.value)),d=(0,N.KR)(null),c=(0,N.KR)(!1),u=async()=>{try{await e.dispatch("nft/loadRequests"),console.log("请求列表数据:",e.state.nft.requests),e.state.nft.requests&&0!==e.state.nft.requests.length||console.log("请求列表为空")}catch(t){console.error("加载请求列表失败:",t),e.dispatch("app/showError","加载请求列表失败: "+t.message)}},m=e=>{o.value=e},b=e=>{console.log("查看请求详情:",e),d.value=e,a&&a.show()},k=async t=>{if(t){c.value=!0,console.log("批准请求:",t);try{const s=await e.dispatch("nft/approveRequest",t);s&&(e.dispatch("app/showSuccess","请求已批准"),a&&a.hide(),await u())}catch(s){console.error("批准请求失败:",s),e.dispatch("app/showError","批准请求失败: "+s.message)}finally{c.value=!1}}else e.dispatch("app/showError","请求ID不能为空")},p=async t=>{if(t){c.value=!0,console.log("拒绝请求:",t);try{const s=await e.dispatch("nft/rejectRequest",t);s&&(e.dispatch("app/showSuccess","请求已拒绝"),a&&a.hide(),await u())}catch(s){console.error("拒绝请求失败:",s),e.dispatch("app/showError","拒绝请求失败: "+s.message)}finally{c.value=!1}}else e.dispatch("app/showError","请求ID不能为空")},v=e=>{switch(e){case"mint":return"铸造NFT";case"update":return"更新元数据";case"transfer":return"转移NFT";case"child":return"创建子NFT";default:return"未知类型"}},L=e=>{switch(e){case"pending":return"待处理";case"approved":return"已批准";case"rejected":return"已拒绝";default:return"未知状态"}},g=e=>{if(!e)return"";const t=new Date(e);return t.toLocaleString()},y=(e,t)=>e?e.length>t?e.substring(0,t)+"...":e:"",f=e=>e?e.substring(0,6)+"..."+e.substring(e.length-4):"";return(0,l.sV)(()=>{u(),t.value&&(a=new S.aF(t.value))}),{requests:s,filteredRequests:r,isLoading:i,isAdmin:n,filter:o,selectedRequest:d,isSubmitting:c,requestDetailModal:t,loadRequests:u,setFilter:m,viewRequest:b,handleApproveRequest:k,handleRejectRequest:p,getRequestTypeText:v,getStatusText:L,formatDate:g,truncateText:y,truncateAddress:f}}},rn=(0,A.A)(on,[["render",nn],["__scopeId","data-v-8be826de"]]),dn=rn,cn={class:"abe-setup"},un={class:"card mt-4"},mn={class:"card-body"},bn={key:0,class:"text-center py-3"},kn={key:1},pn={key:0},vn={key:1},hn={key:0,class:"row mt-3"},Ln={class:"col-md-6"},gn={class:"list-group"},yn={class:"list-group-item d-flex justify-content-between align-items-center"},fn={class:"list-group-item d-flex justify-content-between align-items-center"},Dn={class:"badge bg-primary rounded-pill"},wn={class:"list-group-item d-flex justify-content-between align-items-center"},In={class:"badge bg-success rounded-pill"},Cn={class:"list-group-item d-flex justify-content-between align-items-center"},Tn={class:"badge bg-info rounded-pill"},Fn={class:"col-md-6"},En={class:"list-group"},_n={key:0,class:"text-center py-3 text-muted"},Nn={class:"d-flex w-100 justify-content-between"},xn={class:"mb-1"},Sn={class:"mb-1"},Rn={class:"card mt-4"},An={class:"card-body"},Mn=["disabled"],Wn={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},Xn={key:1,class:"bi bi-gear-fill me-1"};function On(e,t,a,i,n,o){return(0,l.uX)(),(0,l.CE)("div",cn,[t[11]||(t[11]=(0,l.Lk)("h2",null,"ABE系统初始化",-1)),(0,l.Lk)("div",un,[t[8]||(t[8]=(0,l.Lk)("div",{class:"card-header"},[(0,l.Lk)("h5",{class:"mb-0"},"系统状态")],-1)),(0,l.Lk)("div",mn,[n.loading?((0,l.uX)(),(0,l.CE)("div",bn,t[1]||(t[1]=[(0,l.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,l.Lk)("span",{class:"visually-hidden"},"加载中...")],-1),(0,l.Lk)("p",{class:"mt-2"},"加载系统状态...",-1)]))):((0,l.uX)(),(0,l.CE)("div",kn,[(0,l.Lk)("div",{class:(0,L.C4)(["alert",n.systemInitialized?"alert-success":"alert-warning"])},[(0,l.Lk)("i",{class:(0,L.C4)([n.systemInitialized?"bi bi-check-circle-fill":"bi bi-exclamation-triangle-fill","me-2"])},null,2),n.systemInitialized?((0,l.uX)(),(0,l.CE)("span",pn,"ABE 系统已初始化")):((0,l.uX)(),(0,l.CE)("span",vn,"ABE 系统尚未初始化，请先完成系统初始化"))],2),n.systemInitialized?((0,l.uX)(),(0,l.CE)("div",hn,[(0,l.Lk)("div",Ln,[t[6]||(t[6]=(0,l.Lk)("h5",null,"系统信息",-1)),(0,l.Lk)("ul",gn,[(0,l.Lk)("li",yn,[t[2]||(t[2]=(0,l.eW)(" 初始化时间 ")),(0,l.Lk)("span",null,(0,L.v_)(o.formatDate(n.systemInfo.setupTime)),1)]),(0,l.Lk)("li",fn,[t[3]||(t[3]=(0,l.eW)(" 密钥数量 ")),(0,l.Lk)("span",Dn,(0,L.v_)(n.systemInfo.keyCount||0),1)]),(0,l.Lk)("li",wn,[t[4]||(t[4]=(0,l.eW)(" 加密操作次数 ")),(0,l.Lk)("span",In,(0,L.v_)(n.systemInfo.encryptCount||0),1)]),(0,l.Lk)("li",Cn,[t[5]||(t[5]=(0,l.eW)(" 解密操作次数 ")),(0,l.Lk)("span",Tn,(0,L.v_)(n.systemInfo.decryptCount||0),1)])])]),(0,l.Lk)("div",Fn,[t[7]||(t[7]=(0,l.Lk)("h5",null,"最近操作",-1)),(0,l.Lk)("div",En,[0===n.recentOperations.length?((0,l.uX)(),(0,l.CE)("div",_n," 暂无操作记录 ")):(0,l.Q3)("",!0),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.recentOperations,(e,t)=>((0,l.uX)(),(0,l.CE)("a",{href:"#",class:"list-group-item list-group-item-action",key:t},[(0,l.Lk)("div",Nn,[(0,l.Lk)("h6",xn,(0,L.v_)(e.type),1),(0,l.Lk)("small",null,(0,L.v_)(o.formatDate(e.time)),1)]),(0,l.Lk)("p",Sn,(0,L.v_)(e.description),1),(0,l.Lk)("small",null,"操作者: "+(0,L.v_)(e.user),1)]))),128))])])])):(0,l.Q3)("",!0)]))])]),(0,l.Lk)("div",Rn,[t[10]||(t[10]=(0,l.Lk)("div",{class:"card-header"},[(0,l.Lk)("h5",{class:"mb-0"},"初始化系统")],-1)),(0,l.Lk)("div",An,[(0,l.Lk)("form",{onSubmit:t[0]||(t[0]=(0,s.D$)((...e)=>o.setupSystem&&o.setupSystem(...e),["prevent"]))},[(0,l.Lk)("button",{type:"submit",class:"btn btn-primary",disabled:n.isSubmitting||n.systemInitialized},[n.isSubmitting?((0,l.uX)(),(0,l.CE)("span",Wn)):((0,l.uX)(),(0,l.CE)("i",Xn)),t[9]||(t[9]=(0,l.eW)(" 初始化ABE系统 "))],8,Mn)],32)])])])}const qn={name:"ABESetup",data(){return{loading:!0,isSubmitting:!1,systemInitialized:!1,systemInfo:{setupTime:null,keyCount:0,encryptCount:0,decryptCount:0},recentOperations:[]}},mounted(){this.fetchSystemStatus()},methods:{async fetchSystemStatus(){this.loading=!0;try{await new Promise(e=>setTimeout(e,800)),this.systemInitialized=!0,this.systemInfo={setupTime:(new Date).toISOString(),keyCount:5,encryptCount:12,decryptCount:8},this.recentOperations=[{type:"密钥生成",time:new Date(Date.now()-36e5).toISOString(),description:'为用户生成了属性为 "department:HR AND role:manager" 的密钥',user:"0x1234...5678"},{type:"加密",time:new Date(Date.now()-72e5).toISOString(),description:'使用策略 "(department:HR OR department:IT) AND role:manager" 加密数据',user:"0x8765...4321"}]}catch(e){console.error("获取系统状态失败:",e),this.$store.commit("notifications/add",{type:"danger",message:"获取系统状态失败: "+e.message})}finally{this.loading=!1}},async setupSystem(){this.isSubmitting=!0;try{await new Promise(e=>setTimeout(e,1500)),this.systemInitialized=!0,this.systemInfo.setupTime=(new Date).toISOString(),this.$store.commit("notifications/add",{type:"success",message:"ABE系统初始化成功！"}),this.fetchSystemStatus()}catch(e){console.error("系统初始化失败:",e),this.$store.commit("notifications/add",{type:"danger",message:"系统初始化失败: "+e.message})}finally{this.isSubmitting=!1}},formatDate(e){if(!e)return"未知";const t=new Date(e);return t.toLocaleString()}}},$n=(0,A.A)(qn,[["render",On],["__scopeId","data-v-fd34432e"]]),Pn=$n,Kn={class:"abe-keygen"},Un={class:"card mt-4"},Vn={class:"card-body"},Qn={class:"mb-3"},jn={class:"mb-3"},Bn={class:"mb-3 form-check"},Gn=["disabled"],Jn={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},zn={key:1,class:"bi bi-key-fill me-1"},Hn={class:"card mt-4"},Zn={class:"card-body"},Yn={key:0,class:"text-center py-3"},eo={key:1,class:"text-center py-3"},to={key:2},ao={class:"table-responsive"},so={class:"table table-hover"},lo=["onClick"],io=["onClick"];function no(e,t,a,i,n,o){return(0,l.uX)(),(0,l.CE)("div",Kn,[t[18]||(t[18]=(0,l.Lk)("h2",null,"ABE密钥生成",-1)),(0,l.Lk)("div",Un,[t[11]||(t[11]=(0,l.Lk)("div",{class:"card-header"},[(0,l.Lk)("h5",{class:"mb-0"},"生成密钥")],-1)),(0,l.Lk)("div",Vn,[(0,l.Lk)("form",{onSubmit:t[3]||(t[3]=(0,s.D$)((...e)=>o.generateKey&&o.generateKey(...e),["prevent"]))},[(0,l.Lk)("div",Qn,[t[4]||(t[4]=(0,l.Lk)("label",{for:"attributes",class:"form-label"},"用户属性",-1)),(0,l.bo)((0,l.Lk)("textarea",{class:"form-control",id:"attributes","onUpdate:modelValue":t[0]||(t[0]=e=>n.keygenForm.attributes=e),rows:"5",placeholder:"输入用户属性，每行一个属性，例如：\ndepartment:HR\nrole:manager",required:""},null,512),[[s.Jo,n.keygenForm.attributes]]),t[5]||(t[5]=(0,l.Lk)("div",{class:"form-text"},"定义用户的属性，每行一个属性",-1))]),(0,l.Lk)("div",jn,[t[6]||(t[6]=(0,l.Lk)("label",{for:"userId",class:"form-label"},"用户ID/钱包地址",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control",id:"userId","onUpdate:modelValue":t[1]||(t[1]=e=>n.keygenForm.userId=e),placeholder:"0x...",required:""},null,512),[[s.Jo,n.keygenForm.userId]]),t[7]||(t[7]=(0,l.Lk)("div",{class:"form-text"},"用户的唯一标识符或钱包地址",-1))]),(0,l.Lk)("div",Bn,[(0,l.bo)((0,l.Lk)("input",{type:"checkbox",class:"form-check-input",id:"storeKey","onUpdate:modelValue":t[2]||(t[2]=e=>n.keygenForm.storeKey=e)},null,512),[[s.lH,n.keygenForm.storeKey]]),t[8]||(t[8]=(0,l.Lk)("label",{class:"form-check-label",for:"storeKey"},"在服务器上存储密钥",-1)),t[9]||(t[9]=(0,l.Lk)("div",{class:"form-text"},"是否在服务器上保存用户密钥的副本",-1))]),(0,l.Lk)("button",{type:"submit",class:"btn btn-primary",disabled:n.isSubmitting||!n.systemInitialized},[n.isSubmitting?((0,l.uX)(),(0,l.CE)("span",Jn)):((0,l.uX)(),(0,l.CE)("i",zn)),t[10]||(t[10]=(0,l.eW)(" 生成密钥 "))],8,Gn)],32)])]),(0,l.Lk)("div",Hn,[t[17]||(t[17]=(0,l.Lk)("div",{class:"card-header"},[(0,l.Lk)("h5",{class:"mb-0"},"已生成的密钥")],-1)),(0,l.Lk)("div",Zn,[n.loading?((0,l.uX)(),(0,l.CE)("div",Yn,t[12]||(t[12]=[(0,l.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,l.Lk)("span",{class:"visually-hidden"},"加载中...")],-1),(0,l.Lk)("p",{class:"mt-2"},"加载密钥列表...",-1)]))):0===n.keys.length?((0,l.uX)(),(0,l.CE)("div",eo,t[13]||(t[13]=[(0,l.Lk)("p",{class:"text-muted"},"暂无密钥记录",-1)]))):((0,l.uX)(),(0,l.CE)("div",to,[(0,l.Lk)("div",ao,[(0,l.Lk)("table",so,[t[16]||(t[16]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"用户ID"),(0,l.Lk)("th",null,"属性"),(0,l.Lk)("th",null,"创建时间"),(0,l.Lk)("th",null,"操作")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.keys,(e,a)=>((0,l.uX)(),(0,l.CE)("tr",{key:a},[(0,l.Lk)("td",null,(0,L.v_)(o.formatAddress(e.userId)),1),(0,l.Lk)("td",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.attributes.split(","),(e,t)=>((0,l.uX)(),(0,l.CE)("span",{key:t,class:"badge bg-primary me-1 mb-1"},(0,L.v_)(e),1))),128))]),(0,l.Lk)("td",null,(0,L.v_)(o.formatDate(e.createdAt)),1),(0,l.Lk)("td",null,[(0,l.Lk)("button",{class:"btn btn-sm btn-outline-primary me-1",onClick:t=>o.viewKey(e)},t[14]||(t[14]=[(0,l.Lk)("i",{class:"bi bi-eye"},null,-1)]),8,lo),(0,l.Lk)("button",{class:"btn btn-sm btn-outline-danger",onClick:t=>o.revokeKey(e)},t[15]||(t[15]=[(0,l.Lk)("i",{class:"bi bi-trash"},null,-1)]),8,io)])]))),128))])])])]))])])])}const oo={name:"ABEKeyGen",data(){return{loading:!0,isSubmitting:!1,systemInitialized:!1,keygenForm:{attributes:"",userId:"",storeKey:!0},keys:[]}},mounted(){this.fetchSystemStatus(),this.fetchKeys()},methods:{async fetchSystemStatus(){try{await new Promise(e=>setTimeout(e,500)),this.systemInitialized=!0}catch(e){console.error("获取系统状态失败:",e),this.$store.commit("notifications/add",{type:"danger",message:"获取系统状态失败: "+e.message})}},async fetchKeys(){this.loading=!0;try{await new Promise(e=>setTimeout(e,800)),this.keys=[{id:"1",userId:"0x1234567890abcdef1234567890abcdef12345678",attributes:"department:HR,role:manager",createdAt:new Date(Date.now()-864e5).toISOString()},{id:"2",userId:"0xabcdef1234567890abcdef1234567890abcdef12",attributes:"department:IT,role:developer,level:senior",createdAt:new Date(Date.now()-1728e5).toISOString()}]}catch(e){console.error("获取密钥列表失败:",e),this.$store.commit("notifications/add",{type:"danger",message:"获取密钥列表失败: "+e.message})}finally{this.loading=!1}},async generateKey(){if(this.keygenForm.attributes&&this.keygenForm.userId){this.isSubmitting=!0;try{const e=this.keygenForm.attributes.split("\n").map(e=>e.trim()).filter(e=>e);if(0===e.length)throw new Error("属性不能为空");await new Promise(e=>setTimeout(e,1500)),this.keys.unshift({id:String(this.keys.length+1),userId:this.keygenForm.userId,attributes:e.join(","),createdAt:(new Date).toISOString()}),this.keygenForm.attributes="",this.$store.commit("notifications/add",{type:"success",message:"密钥生成成功！"})}catch(e){console.error("密钥生成失败:",e),this.$store.commit("notifications/add",{type:"danger",message:"密钥生成失败: "+e.message})}finally{this.isSubmitting=!1}}else this.$store.commit("notifications/add",{type:"danger",message:"请填写所有必填字段"})},viewKey(e){this.$store.commit("notifications/add",{type:"info",message:"查看密钥功能即将推出！"})},revokeKey(e){confirm(`确定要撤销用户 ${this.formatAddress(e.userId)} 的密钥吗？`)&&(this.keys=this.keys.filter(t=>t.id!==e.id),this.$store.commit("notifications/add",{type:"success",message:"密钥已成功撤销"}))},formatDate(e){if(!e)return"未知";const t=new Date(e);return t.toLocaleString()},formatAddress(e){return e?`${e.substring(0,6)}...${e.substring(e.length-4)}`:""}}},ro=(0,A.A)(oo,[["render",no],["__scopeId","data-v-501f37fe"]]),co=ro,uo={class:"container mt-4"},mo={class:"d-flex justify-content-between align-items-center mb-4"},bo={class:"card mb-4"},ko={class:"card-body"},po={class:"row"},vo={class:"col-md-8"},ho={class:"input-group"},Lo={class:"col-md-4"},go={key:0,class:"text-center my-5"},yo={key:1,class:"text-center my-5"},fo={key:2},Do={class:"row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4"},wo={class:"card h-100"},Io={class:"card-header d-flex justify-content-between align-items-center"},Co={class:"mb-0"},To={class:"card-body"},Fo={class:"mb-3"},Eo={class:"input-group"},_o=["value"],No=["onClick"],xo={class:"mb-3"},So={class:"mb-0"},Ro={class:"mb-3"},Ao={class:"mb-0"},Mo={class:"mb-3"},Wo={class:"mb-0"},Xo={class:"card-footer"},Oo={class:"d-flex justify-content-between"},qo=["onClick"],$o={class:"btn-group"},Po=["onClick"],Ko=["onClick"],Uo={class:"modal fade",ref:"detailsModal",tabindex:"-1"},Vo={class:"modal-dialog modal-lg"},Qo={class:"modal-content"},jo={key:0,class:"modal-body"},Bo={class:"mb-3"},Go={class:"mb-3"},Jo={class:"input-group"},zo=["value"],Ho={class:"mb-3"},Zo={class:"bg-light p-3 rounded"},Yo={class:"mb-3"},er={key:0},tr={class:"list-group"},ar={class:"d-flex w-100 justify-content-between"},sr={class:"mb-1"},lr={class:"mb-1"},ir={key:1,class:"text-muted"},nr={class:"modal-footer"},or={class:"modal fade",ref:"deleteModal",tabindex:"-1"},rr={class:"modal-dialog"},dr={class:"modal-content"},cr={key:0,class:"modal-body"},ur={class:"modal-footer"},mr=["disabled"],br={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},kr={key:1,class:"bi bi-trash me-1"};function pr(e,t,a,i,n,o){const r=(0,l.g2)("router-link");return(0,l.uX)(),(0,l.CE)("div",uo,[(0,l.Lk)("div",mo,[t[8]||(t[8]=(0,l.Lk)("h2",null,"DID 列表",-1)),(0,l.bF)(r,{to:"/did/create",class:"btn btn-primary"},{default:(0,l.k6)(()=>t[7]||(t[7]=[(0,l.Lk)("i",{class:"bi bi-plus-circle me-1"},null,-1),(0,l.eW)("创建新 DID ")])),_:1,__:[7]})]),(0,l.Lk)("div",bo,[(0,l.Lk)("div",ko,[(0,l.Lk)("div",po,[(0,l.Lk)("div",vo,[(0,l.Lk)("div",ho,[t[9]||(t[9]=(0,l.Lk)("span",{class:"input-group-text"},[(0,l.Lk)("i",{class:"bi bi-search"})],-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control",placeholder:"搜索 DID 或名称","onUpdate:modelValue":t[0]||(t[0]=e=>n.searchQuery=e),onInput:t[1]||(t[1]=(...e)=>o.filterDIDs&&o.filterDIDs(...e))},null,544),[[s.Jo,n.searchQuery]])])]),(0,l.Lk)("div",Lo,[(0,l.bo)((0,l.Lk)("select",{class:"form-select","onUpdate:modelValue":t[2]||(t[2]=e=>n.filterType=e),onChange:t[3]||(t[3]=(...e)=>o.filterDIDs&&o.filterDIDs(...e))},t[10]||(t[10]=[(0,l.Lk)("option",{value:"all"},"所有 DID",-1),(0,l.Lk)("option",{value:"owned"},"我创建的",-1),(0,l.Lk)("option",{value:"shared"},"与我共享的",-1)]),544),[[s.u1,n.filterType]])])])])]),n.loading?((0,l.uX)(),(0,l.CE)("div",go,t[11]||(t[11]=[(0,l.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,l.Lk)("span",{class:"visually-hidden"},"加载中...")],-1),(0,l.Lk)("p",{class:"mt-2"},"加载 DID 列表...",-1)]))):0===n.filteredDIDs.length?((0,l.uX)(),(0,l.CE)("div",yo,[t[13]||(t[13]=(0,l.Lk)("i",{class:"bi bi-person-badge fs-1 text-muted"},null,-1)),t[14]||(t[14]=(0,l.Lk)("p",{class:"lead mt-3"},"没有找到 DID",-1)),t[15]||(t[15]=(0,l.Lk)("p",{class:"text-muted"},"创建一个新的 DID 或调整搜索条件",-1)),(0,l.bF)(r,{to:"/did/create",class:"btn btn-primary mt-2"},{default:(0,l.k6)(()=>t[12]||(t[12]=[(0,l.Lk)("i",{class:"bi bi-plus-circle me-1"},null,-1),(0,l.eW)("创建新 DID ")])),_:1,__:[12]})])):((0,l.uX)(),(0,l.CE)("div",fo,[(0,l.Lk)("div",Do,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.filteredDIDs,e=>((0,l.uX)(),(0,l.CE)("div",{class:"col",key:e.id},[(0,l.Lk)("div",wo,[(0,l.Lk)("div",Io,[(0,l.Lk)("h5",Co,(0,L.v_)(e.name),1),(0,l.Lk)("span",{class:(0,L.C4)(["badge",o.getStatusBadgeClass(e.status)])},(0,L.v_)(o.getStatusText(e.status)),3)]),(0,l.Lk)("div",To,[(0,l.Lk)("div",Fo,[t[17]||(t[17]=(0,l.Lk)("label",{class:"form-label fw-bold"},"DID",-1)),(0,l.Lk)("div",Eo,[(0,l.Lk)("input",{type:"text",class:"form-control",value:e.did,readonly:""},null,8,_o),(0,l.Lk)("button",{class:"btn btn-outline-secondary",onClick:t=>o.copyToClipboard(e.did)},t[16]||(t[16]=[(0,l.Lk)("i",{class:"bi bi-clipboard"},null,-1)]),8,No)])]),(0,l.Lk)("div",xo,[t[18]||(t[18]=(0,l.Lk)("label",{class:"form-label fw-bold"},"创建时间",-1)),(0,l.Lk)("p",So,(0,L.v_)(o.formatDate(e.createdAt)),1)]),(0,l.Lk)("div",Ro,[t[19]||(t[19]=(0,l.Lk)("label",{class:"form-label fw-bold"},"类型",-1)),(0,l.Lk)("p",Ao,(0,L.v_)(e.type),1)]),(0,l.Lk)("div",Mo,[t[20]||(t[20]=(0,l.Lk)("label",{class:"form-label fw-bold"},"关联凭证",-1)),(0,l.Lk)("p",Wo,(0,L.v_)(e.vcCount||0)+" 个凭证",1)])]),(0,l.Lk)("div",Xo,[(0,l.Lk)("div",Oo,[(0,l.Lk)("button",{class:"btn btn-sm btn-outline-primary",onClick:t=>o.viewDetails(e)},t[21]||(t[21]=[(0,l.Lk)("i",{class:"bi bi-eye me-1"},null,-1),(0,l.eW)("详情 ")]),8,qo),(0,l.Lk)("div",$o,[(0,l.Lk)("button",{class:"btn btn-sm btn-outline-success",onClick:t=>o.issueVC(e)},t[22]||(t[22]=[(0,l.Lk)("i",{class:"bi bi-file-earmark-plus me-1"},null,-1),(0,l.eW)("颁发凭证 ")]),8,Po),(0,l.Lk)("button",{class:"btn btn-sm btn-outline-danger",onClick:t=>o.confirmDelete(e)},t[23]||(t[23]=[(0,l.Lk)("i",{class:"bi bi-trash me-1"},null,-1),(0,l.eW)("删除 ")]),8,Ko)])])])])]))),128))])])),(0,l.Lk)("div",Uo,[(0,l.Lk)("div",Vo,[(0,l.Lk)("div",Qo,[t[31]||(t[31]=(0,l.Lk)("div",{class:"modal-header"},[(0,l.Lk)("h5",{class:"modal-title"},"DID 详情"),(0,l.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),n.selectedDID?((0,l.uX)(),(0,l.CE)("div",jo,[(0,l.Lk)("div",Bo,[t[24]||(t[24]=(0,l.Lk)("label",{class:"form-label fw-bold"},"名称",-1)),(0,l.Lk)("p",null,(0,L.v_)(n.selectedDID.name),1)]),(0,l.Lk)("div",Go,[t[26]||(t[26]=(0,l.Lk)("label",{class:"form-label fw-bold"},"DID",-1)),(0,l.Lk)("div",Jo,[(0,l.Lk)("input",{type:"text",class:"form-control",value:n.selectedDID.did,readonly:""},null,8,zo),(0,l.Lk)("button",{class:"btn btn-outline-secondary",onClick:t[4]||(t[4]=e=>o.copyToClipboard(n.selectedDID.did))},t[25]||(t[25]=[(0,l.Lk)("i",{class:"bi bi-clipboard"},null,-1)]))])]),(0,l.Lk)("div",Ho,[t[27]||(t[27]=(0,l.Lk)("label",{class:"form-label fw-bold"},"DID 文档",-1)),(0,l.Lk)("pre",Zo,[(0,l.Lk)("code",null,(0,L.v_)(JSON.stringify(n.selectedDID.document,null,2)),1)])]),(0,l.Lk)("div",Yo,[t[28]||(t[28]=(0,l.Lk)("label",{class:"form-label fw-bold"},"关联凭证",-1)),n.selectedDID.vcs&&n.selectedDID.vcs.length>0?((0,l.uX)(),(0,l.CE)("div",er,[(0,l.Lk)("div",tr,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.selectedDID.vcs,(e,t)=>((0,l.uX)(),(0,l.CE)("a",{href:"#",class:"list-group-item list-group-item-action",key:t},[(0,l.Lk)("div",ar,[(0,l.Lk)("h6",sr,(0,L.v_)(e.type),1),(0,l.Lk)("small",null,(0,L.v_)(o.formatDate(e.issuanceDate)),1)]),(0,l.Lk)("p",lr,(0,L.v_)(e.issuer),1),(0,l.Lk)("small",null,"ID: "+(0,L.v_)(e.id),1)]))),128))])])):((0,l.uX)(),(0,l.CE)("p",ir,"暂无关联凭证"))])])):(0,l.Q3)("",!0),(0,l.Lk)("div",nr,[t[30]||(t[30]=(0,l.Lk)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"关闭",-1)),(0,l.Lk)("button",{type:"button",class:"btn btn-primary",onClick:t[5]||(t[5]=(...e)=>o.exportDID&&o.exportDID(...e))},t[29]||(t[29]=[(0,l.Lk)("i",{class:"bi bi-download me-1"},null,-1),(0,l.eW)("导出 DID 文档 ")]))])])])],512),(0,l.Lk)("div",or,[(0,l.Lk)("div",rr,[(0,l.Lk)("div",dr,[t[38]||(t[38]=(0,l.Lk)("div",{class:"modal-header"},[(0,l.Lk)("h5",{class:"modal-title"},"确认删除"),(0,l.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),n.selectedDID?((0,l.uX)(),(0,l.CE)("div",cr,[t[34]||(t[34]=(0,l.Lk)("div",{class:"alert alert-danger"},[(0,l.Lk)("i",{class:"bi bi-exclamation-triangle-fill me-2"}),(0,l.Lk)("strong",null,"警告："),(0,l.eW)(" 删除操作不可逆，将永久删除此 DID 及其相关数据。 ")],-1)),t[35]||(t[35]=(0,l.Lk)("p",null,"您确定要删除以下 DID 吗？",-1)),(0,l.Lk)("p",null,[t[32]||(t[32]=(0,l.Lk)("strong",null,"名称：",-1)),(0,l.eW)(" "+(0,L.v_)(n.selectedDID.name),1)]),(0,l.Lk)("p",null,[t[33]||(t[33]=(0,l.Lk)("strong",null,"DID：",-1)),(0,l.eW)(" "+(0,L.v_)(n.selectedDID.did),1)])])):(0,l.Q3)("",!0),(0,l.Lk)("div",ur,[t[37]||(t[37]=(0,l.Lk)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1)),(0,l.Lk)("button",{type:"button",class:"btn btn-danger",onClick:t[6]||(t[6]=(...e)=>o.deleteDID&&o.deleteDID(...e)),disabled:n.isDeleting},[n.isDeleting?((0,l.uX)(),(0,l.CE)("span",br)):((0,l.uX)(),(0,l.CE)("i",kr)),t[36]||(t[36]=(0,l.eW)("确认删除 "))],8,mr)])])])],512)])}const vr={name:"DIDList",data(){return{loading:!0,isDeleting:!1,dids:[],filteredDIDs:[],searchQuery:"",filterType:"all",selectedDID:null,detailsModal:null,deleteModal:null}},mounted(){this.fetchDIDs(),this.detailsModal=new this.$bootstrap.Modal(this.$refs.detailsModal),this.deleteModal=new this.$bootstrap.Modal(this.$refs.deleteModal)},methods:{async fetchDIDs(){this.loading=!0;try{await new Promise(e=>setTimeout(e,800)),this.dids=[{id:"1",name:"个人身份",did:"did:example:123456789abcdefghi",type:"个人",status:"active",createdAt:new Date(Date.now()-36e5).toISOString(),vcCount:3,document:{"@context":"https://www.w3.org/ns/did/v1",id:"did:example:123456789abcdefghi",verificationMethod:[{id:"did:example:123456789abcdefghi#keys-1",type:"Ed25519VerificationKey2020",controller:"did:example:123456789abcdefghi",publicKeyMultibase:"zH3C2AVvLMv6gmMNam3uVAjZpfkcJCwDwnZn6z3wXmqPV"}],authentication:["did:example:123456789abcdefghi#keys-1"]},vcs:[{id:"vc:example:123",type:"身份证明",issuer:"did:example:issuer123",issuanceDate:new Date(Date.now()-864e5).toISOString()},{id:"vc:example:456",type:"医疗记录访问权限",issuer:"did:example:hospital123",issuanceDate:new Date(Date.now()-1728e5).toISOString()}]},{id:"2",name:"医疗身份",did:"did:example:abcdefghi123456789",type:"医疗",status:"active",createdAt:new Date(Date.now()-864e5).toISOString(),vcCount:1,document:{"@context":"https://www.w3.org/ns/did/v1",id:"did:example:abcdefghi123456789",verificationMethod:[{id:"did:example:abcdefghi123456789#keys-1",type:"Ed25519VerificationKey2020",controller:"did:example:abcdefghi123456789",publicKeyMultibase:"zH3C2AVvLMv6gmMNam3uVAjZpfkcJCwDwnZn6z3wXmqPV"}],authentication:["did:example:abcdefghi123456789#keys-1"]},vcs:[{id:"vc:example:789",type:"医生资格证明",issuer:"did:example:medboard123",issuanceDate:new Date(Date.now()-2592e5).toISOString()}]},{id:"3",name:"工作身份",did:"did:example:9876543210abcdefghi",type:"专业",status:"inactive",createdAt:new Date(Date.now()-1728e5).toISOString(),vcCount:0,document:{"@context":"https://www.w3.org/ns/did/v1",id:"did:example:9876543210abcdefghi",verificationMethod:[{id:"did:example:9876543210abcdefghi#keys-1",type:"Ed25519VerificationKey2020",controller:"did:example:9876543210abcdefghi",publicKeyMultibase:"zH3C2AVvLMv6gmMNam3uVAjZpfkcJCwDwnZn6z3wXmqPV"}],authentication:["did:example:9876543210abcdefghi#keys-1"]},vcs:[]}],this.filterDIDs()}catch(e){console.error("获取DID列表失败:",e),this.$store.commit("notifications/add",{type:"danger",message:"获取DID列表失败: "+e.message})}finally{this.loading=!1}},filterDIDs(){if(!this.searchQuery&&"all"===this.filterType)return void(this.filteredDIDs=[...this.dids]);let e=[...this.dids];if("all"!==this.filterType&&("owned"===this.filterType?e=e.filter(e=>"个人"===e.type||"专业"===e.type):"shared"===this.filterType&&(e=e.filter(e=>"医疗"===e.type))),this.searchQuery){const t=this.searchQuery.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(t)||e.did.toLowerCase().includes(t)||e.type.toLowerCase().includes(t))}this.filteredDIDs=e},formatDate(e){if(!e)return"未知";const t=new Date(e);return t.toLocaleString()},getStatusBadgeClass(e){switch(e){case"active":return"bg-success";case"inactive":return"bg-secondary";case"revoked":return"bg-danger";case"pending":return"bg-warning";default:return"bg-primary"}},getStatusText(e){switch(e){case"active":return"活跃";case"inactive":return"未激活";case"revoked":return"已撤销";case"pending":return"待处理";default:return"未知"}},viewDetails(e){this.selectedDID=e,this.detailsModal.show()},issueVC(e){this.$router.push({path:"/did/vc/issue",query:{did:e.did}})},confirmDelete(e){this.selectedDID=e,this.deleteModal.show()},async deleteDID(){if(this.selectedDID){this.isDeleting=!0;try{await new Promise(e=>setTimeout(e,800)),this.dids=this.dids.filter(e=>e.id!==this.selectedDID.id),this.filterDIDs(),this.deleteModal.hide(),this.$store.commit("notifications/add",{type:"success",message:"DID 已成功删除"})}catch(e){console.error("删除DID失败:",e),this.$store.commit("notifications/add",{type:"danger",message:"删除DID失败: "+e.message})}finally{this.isDeleting=!1}}},copyToClipboard(e){navigator.clipboard.writeText(e).then(()=>{this.$store.commit("notifications/add",{type:"success",message:"已复制到剪贴板"})},()=>{this.$store.commit("notifications/add",{type:"danger",message:"复制到剪贴板失败"})})},exportDID(){if(!this.selectedDID)return;const e=JSON.stringify(this.selectedDID.document,null,2),t=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(t),s=document.createElement("a");s.href=a,s.download=`${this.selectedDID.did.replace(/:/g,"-")}.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a),this.$store.commit("notifications/add",{type:"success",message:"DID 文档已导出"})}}},hr=(0,A.A)(vr,[["render",pr],["__scopeId","data-v-97a86df4"]]),Lr=hr,gr={class:"container mt-4"},yr={class:"d-flex justify-content-between align-items-center mb-4"},fr={class:"row"},Dr={class:"col-lg-8"},wr={class:"card"},Ir={class:"card-body"},Cr={class:"mb-3"},Tr={class:"mb-3"},Fr={class:"mb-3"},Er={key:0,class:"mb-3"},_r={class:"input-group"},Nr={key:1,class:"mb-3"},xr={class:"input-group"},Sr={class:"mb-3"},Rr={class:"form-check mb-2"},Ar={class:"form-check mb-2"},Mr={class:"form-check"},Wr={class:"d-grid gap-2"},Xr=["disabled"],Or={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},qr={key:1,class:"bi bi-plus-circle me-1"},$r={class:"col-lg-4"},Pr={class:"card mb-4"},Kr={class:"card-body"},Ur={key:0},Vr={key:1},Qr={key:2},jr={class:"card"},Br={class:"card-body"},Gr={key:0},Jr={class:"bg-light p-2 rounded mb-3"},zr={class:"bg-light p-2 rounded"},Hr={key:1,class:"text-center py-3 text-muted"},Zr={class:"modal fade",ref:"successModal",tabindex:"-1"},Yr={class:"modal-dialog modal-lg"},ed={class:"modal-content"},td={key:0,class:"modal-body"},ad={class:"mb-3"},sd={class:"input-group"},ld=["value"],id={class:"mb-3"},nd={class:"input-group"},od=["type","value"],rd={class:"mb-3"},dd={class:"bg-light p-3 rounded"},cd={class:"modal-footer"};function ud(e,t,a,i,n,o){const r=(0,l.g2)("router-link");return(0,l.uX)(),(0,l.CE)("div",gr,[(0,l.Lk)("div",yr,[t[16]||(t[16]=(0,l.Lk)("h2",null,"创建 DID",-1)),(0,l.bF)(r,{to:"/did/list",class:"btn btn-outline-primary"},{default:(0,l.k6)(()=>t[15]||(t[15]=[(0,l.Lk)("i",{class:"bi bi-arrow-left me-1"},null,-1),(0,l.eW)("返回列表 ")])),_:1,__:[15]})]),(0,l.Lk)("div",fr,[(0,l.Lk)("div",Dr,[(0,l.Lk)("div",wr,[t[37]||(t[37]=(0,l.Lk)("div",{class:"card-header"}," 创建新的分布式身份标识符 ",-1)),(0,l.Lk)("div",Ir,[(0,l.Lk)("form",{onSubmit:t[9]||(t[9]=(0,s.D$)((...e)=>o.createDID&&o.createDID(...e),["prevent"]))},[(0,l.Lk)("div",Cr,[t[17]||(t[17]=(0,l.Lk)("label",{for:"didName",class:"form-label"},"DID 名称",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control",id:"didName","onUpdate:modelValue":t[0]||(t[0]=e=>n.didForm.name=e),placeholder:"为您的 DID 提供一个易于识别的名称",required:""},null,512),[[s.Jo,n.didForm.name]]),t[18]||(t[18]=(0,l.Lk)("div",{class:"form-text"},"此名称仅用于显示，不会包含在 DID 文档中",-1))]),(0,l.Lk)("div",Tr,[t[20]||(t[20]=(0,l.Lk)("label",{for:"didType",class:"form-label"},"DID 类型",-1)),(0,l.bo)((0,l.Lk)("select",{class:"form-select",id:"didType","onUpdate:modelValue":t[1]||(t[1]=e=>n.didForm.type=e),required:""},t[19]||(t[19]=[(0,l.Lk)("option",{value:"personal"},"个人身份",-1),(0,l.Lk)("option",{value:"professional"},"专业身份",-1),(0,l.Lk)("option",{value:"medical"},"医疗身份",-1),(0,l.Lk)("option",{value:"organization"},"组织身份",-1)]),512),[[s.u1,n.didForm.type]]),t[21]||(t[21]=(0,l.Lk)("div",{class:"form-text"},"选择 DID 的用途类型",-1))]),(0,l.Lk)("div",Fr,[t[23]||(t[23]=(0,l.Lk)("label",{for:"didMethod",class:"form-label"},"DID 方法",-1)),(0,l.bo)((0,l.Lk)("select",{class:"form-select",id:"didMethod","onUpdate:modelValue":t[2]||(t[2]=e=>n.didForm.method=e),required:""},t[22]||(t[22]=[(0,l.Lk)("option",{value:"key"},"did:key (本地密钥)",-1),(0,l.Lk)("option",{value:"web"},"did:web (网站关联)",-1),(0,l.Lk)("option",{value:"ethr"},"did:ethr (以太坊)",-1)]),512),[[s.u1,n.didForm.method]]),t[24]||(t[24]=(0,l.Lk)("div",{class:"form-text"},"选择 DID 的底层实现方法",-1))]),"ethr"===n.didForm.method?((0,l.uX)(),(0,l.CE)("div",Er,[t[26]||(t[26]=(0,l.Lk)("label",{for:"ethereumAddress",class:"form-label"},"以太坊地址",-1)),(0,l.Lk)("div",_r,[t[25]||(t[25]=(0,l.Lk)("span",{class:"input-group-text"},[(0,l.Lk)("i",{class:"bi bi-wallet2"})],-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control",id:"ethereumAddress","onUpdate:modelValue":t[3]||(t[3]=e=>n.didForm.ethereumAddress=e),placeholder:"0x...",required:""},null,512),[[s.Jo,n.didForm.ethereumAddress]]),o.isWalletConnected?((0,l.uX)(),(0,l.CE)("button",{key:0,type:"button",class:"btn btn-outline-secondary",onClick:t[4]||(t[4]=(...e)=>o.useCurrentWallet&&o.useCurrentWallet(...e))}," 使用当前钱包 ")):(0,l.Q3)("",!0)]),t[27]||(t[27]=(0,l.Lk)("div",{class:"form-text"},"用于创建和控制 DID 的以太坊地址",-1))])):(0,l.Q3)("",!0),"web"===n.didForm.method?((0,l.uX)(),(0,l.CE)("div",Nr,[t[29]||(t[29]=(0,l.Lk)("label",{for:"domain",class:"form-label"},"域名",-1)),(0,l.Lk)("div",xr,[t[28]||(t[28]=(0,l.Lk)("span",{class:"input-group-text"},"https://",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control",id:"domain","onUpdate:modelValue":t[5]||(t[5]=e=>n.didForm.domain=e),placeholder:"example.com",required:""},null,512),[[s.Jo,n.didForm.domain]])]),t[30]||(t[30]=(0,l.Lk)("div",{class:"form-text"},"与 DID 关联的域名",-1))])):(0,l.Q3)("",!0),(0,l.Lk)("div",Sr,[t[34]||(t[34]=(0,l.Lk)("label",{class:"form-label"},"高级选项",-1)),(0,l.Lk)("div",Rr,[(0,l.bo)((0,l.Lk)("input",{class:"form-check-input",type:"checkbox",id:"useKeyAgreement","onUpdate:modelValue":t[6]||(t[6]=e=>n.didForm.useKeyAgreement=e)},null,512),[[s.lH,n.didForm.useKeyAgreement]]),t[31]||(t[31]=(0,l.Lk)("label",{class:"form-check-label",for:"useKeyAgreement"}," 添加密钥协商密钥 ",-1))]),(0,l.Lk)("div",Ar,[(0,l.bo)((0,l.Lk)("input",{class:"form-check-input",type:"checkbox",id:"useAssertionMethod","onUpdate:modelValue":t[7]||(t[7]=e=>n.didForm.useAssertionMethod=e)},null,512),[[s.lH,n.didForm.useAssertionMethod]]),t[32]||(t[32]=(0,l.Lk)("label",{class:"form-check-label",for:"useAssertionMethod"}," 添加断言方法 ",-1))]),(0,l.Lk)("div",Mr,[(0,l.bo)((0,l.Lk)("input",{class:"form-check-input",type:"checkbox",id:"useCapabilityInvocation","onUpdate:modelValue":t[8]||(t[8]=e=>n.didForm.useCapabilityInvocation=e)},null,512),[[s.lH,n.didForm.useCapabilityInvocation]]),t[33]||(t[33]=(0,l.Lk)("label",{class:"form-check-label",for:"useCapabilityInvocation"}," 添加能力调用 ",-1))]),t[35]||(t[35]=(0,l.Lk)("div",{class:"form-text"},"添加额外的密钥用途",-1))]),(0,l.Lk)("div",Wr,[(0,l.Lk)("button",{type:"submit",class:"btn btn-primary",disabled:n.isSubmitting},[n.isSubmitting?((0,l.uX)(),(0,l.CE)("span",Or)):((0,l.uX)(),(0,l.CE)("i",qr)),t[36]||(t[36]=(0,l.eW)("创建 DID "))],8,Xr)])],32)])])]),(0,l.Lk)("div",$r,[(0,l.Lk)("div",Pr,[t[41]||(t[41]=(0,l.Lk)("div",{class:"card-header"}," DID 方法说明 ",-1)),(0,l.Lk)("div",Kr,["key"===n.didForm.method?((0,l.uX)(),(0,l.CE)("div",Ur,t[38]||(t[38]=[(0,l.Lk)("h5",null,"did:key",-1),(0,l.Lk)("p",null,"基于密码学密钥的 DID 方法，不依赖任何特定的分布式账本或网络。适用于：",-1),(0,l.Lk)("ul",null,[(0,l.Lk)("li",null,"需要快速创建 DID"),(0,l.Lk)("li",null,"不需要更新 DID 文档"),(0,l.Lk)("li",null,"需要离线工作的场景")],-1),(0,l.Lk)("div",{class:"alert alert-info"},[(0,l.Lk)("i",{class:"bi bi-info-circle-fill me-2"}),(0,l.eW)(" 将自动生成一个新的 Ed25519 密钥对 ")],-1)]))):(0,l.Q3)("",!0),"web"===n.didForm.method?((0,l.uX)(),(0,l.CE)("div",Vr,t[39]||(t[39]=[(0,l.Lk)("h5",null,"did:web",-1),(0,l.Lk)("p",null,"基于网站域名的 DID 方法，利用现有的 DNS 和 HTTPS 基础设施。适用于：",-1),(0,l.Lk)("ul",null,[(0,l.Lk)("li",null,"组织和企业"),(0,l.Lk)("li",null,"已拥有域名的实体"),(0,l.Lk)("li",null,"需要简单解析机制的场景")],-1),(0,l.Lk)("div",{class:"alert alert-warning"},[(0,l.Lk)("i",{class:"bi bi-exclamation-triangle-fill me-2"}),(0,l.eW)(" 您需要在域名的 .well-known 目录下托管 DID 文档 ")],-1)]))):(0,l.Q3)("",!0),"ethr"===n.didForm.method?((0,l.uX)(),(0,l.CE)("div",Qr,t[40]||(t[40]=[(0,l.Lk)("h5",null,"did:ethr",-1),(0,l.Lk)("p",null,"基于以太坊区块链的 DID 方法，利用智能合约实现 DID 文档管理。适用于：",-1),(0,l.Lk)("ul",null,[(0,l.Lk)("li",null,"需要在区块链上管理身份"),(0,l.Lk)("li",null,"需要可更新的 DID 文档"),(0,l.Lk)("li",null,"与以太坊生态系统集成")],-1),(0,l.Lk)("div",{class:"alert alert-info"},[(0,l.Lk)("i",{class:"bi bi-info-circle-fill me-2"}),(0,l.eW)(" 需要连接以太坊钱包并支付少量 gas 费用 ")],-1)]))):(0,l.Q3)("",!0)])]),(0,l.Lk)("div",jr,[t[45]||(t[45]=(0,l.Lk)("div",{class:"card-header"}," DID 预览 ",-1)),(0,l.Lk)("div",Br,[o.didPreview?((0,l.uX)(),(0,l.CE)("div",Gr,[t[42]||(t[42]=(0,l.Lk)("p",null,[(0,l.Lk)("strong",null,"DID:")],-1)),(0,l.Lk)("div",Jr,[(0,l.Lk)("code",null,(0,L.v_)(o.didPreview),1)]),t[43]||(t[43]=(0,l.Lk)("p",null,[(0,l.Lk)("strong",null,"DID 文档 (预览):")],-1)),(0,l.Lk)("pre",zr,[(0,l.Lk)("code",null,(0,L.v_)(o.didDocumentPreview),1)])])):((0,l.uX)(),(0,l.CE)("div",Hr,t[44]||(t[44]=[(0,l.Lk)("i",{class:"bi bi-person-badge fs-1"},null,-1),(0,l.Lk)("p",{class:"mt-2"},"填写表单以查看 DID 预览",-1)])))])])])]),(0,l.Lk)("div",Zr,[(0,l.Lk)("div",Yr,[(0,l.Lk)("div",ed,[t[56]||(t[56]=(0,l.Lk)("div",{class:"modal-header"},[(0,l.Lk)("h5",{class:"modal-title"},"DID 创建成功"),(0,l.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),n.createdDID?((0,l.uX)(),(0,l.CE)("div",td,[t[52]||(t[52]=(0,l.Lk)("div",{class:"alert alert-success"},[(0,l.Lk)("h5",{class:"alert-heading"},[(0,l.Lk)("i",{class:"bi bi-check-circle-fill me-2"}),(0,l.eW)("您的 DID 已成功创建！")]),(0,l.Lk)("p",null,"您现在可以使用此 DID 进行身份验证和凭证管理。")],-1)),(0,l.Lk)("div",ad,[t[47]||(t[47]=(0,l.Lk)("label",{class:"form-label fw-bold"},"DID",-1)),(0,l.Lk)("div",sd,[(0,l.Lk)("input",{type:"text",class:"form-control",value:n.createdDID.did,readonly:""},null,8,ld),(0,l.Lk)("button",{class:"btn btn-outline-secondary",onClick:t[10]||(t[10]=e=>o.copyToClipboard(n.createdDID.did))},t[46]||(t[46]=[(0,l.Lk)("i",{class:"bi bi-clipboard"},null,-1)]))])]),(0,l.Lk)("div",id,[t[49]||(t[49]=(0,l.Lk)("label",{class:"form-label fw-bold"},"私钥",-1)),t[50]||(t[50]=(0,l.Lk)("div",{class:"alert alert-danger"},[(0,l.Lk)("i",{class:"bi bi-exclamation-triangle-fill me-2"}),(0,l.Lk)("strong",null,"重要提示："),(0,l.eW)(" 请安全保存此私钥，它不会再次显示！ ")],-1)),(0,l.Lk)("div",nd,[(0,l.Lk)("input",{type:n.showPrivateKey?"text":"password",class:"form-control",value:n.createdDID.privateKey,readonly:""},null,8,od),(0,l.Lk)("button",{class:"btn btn-outline-secondary",onClick:t[11]||(t[11]=(...e)=>o.togglePrivateKeyVisibility&&o.togglePrivateKeyVisibility(...e))},[(0,l.Lk)("i",{class:(0,L.C4)(n.showPrivateKey?"bi bi-eye-slash":"bi bi-eye")},null,2)]),(0,l.Lk)("button",{class:"btn btn-outline-secondary",onClick:t[12]||(t[12]=e=>o.copyToClipboard(n.createdDID.privateKey))},t[48]||(t[48]=[(0,l.Lk)("i",{class:"bi bi-clipboard"},null,-1)]))])]),(0,l.Lk)("div",rd,[t[51]||(t[51]=(0,l.Lk)("label",{class:"form-label fw-bold"},"DID 文档",-1)),(0,l.Lk)("pre",dd,[(0,l.Lk)("code",null,(0,L.v_)(JSON.stringify(n.createdDID.document,null,2)),1)])])])):(0,l.Q3)("",!0),(0,l.Lk)("div",cd,[t[55]||(t[55]=(0,l.Lk)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"关闭",-1)),(0,l.Lk)("button",{type:"button",class:"btn btn-primary",onClick:t[13]||(t[13]=(...e)=>o.exportDIDDocument&&o.exportDIDDocument(...e))},t[53]||(t[53]=[(0,l.Lk)("i",{class:"bi bi-download me-1"},null,-1),(0,l.eW)("导出 DID 文档 ")])),(0,l.Lk)("button",{type:"button",class:"btn btn-success",onClick:t[14]||(t[14]=(...e)=>o.goToDIDList&&o.goToDIDList(...e))},t[54]||(t[54]=[(0,l.Lk)("i",{class:"bi bi-list-check me-1"},null,-1),(0,l.eW)("查看 DID 列表 ")]))])])])],512)])}const md={name:"DIDCreate",data(){return{isSubmitting:!1,didForm:{name:"",type:"personal",method:"key",ethereumAddress:"",domain:"",useKeyAgreement:!1,useAssertionMethod:!1,useCapabilityInvocation:!1},createdDID:null,showPrivateKey:!1,successModal:null}},computed:{...(0,h.aH)("wallet",["isConnected","address"]),isWalletConnected(){return this.isConnected},didPreview(){if(!this.didForm.name)return"";switch(this.didForm.method){case"key":return"did:key:z6MkhaXgBZDvotDkL5257faiztiGiC2QtKLGpbnnEGta2doK";case"web":return this.didForm.domain?`did:web:${this.didForm.domain}`:"";case"ethr":{if(!this.didForm.ethereumAddress)return"";const e=this.didForm.ethereumAddress.startsWith("0x")?this.didForm.ethereumAddress.substring(2):this.didForm.ethereumAddress;return`did:ethr:${e}`}default:return""}},didDocumentPreview(){if(!this.didPreview)return"";const e={"@context":"https://www.w3.org/ns/did/v1",id:this.didPreview,verificationMethod:[{id:`${this.didPreview}#keys-1`,type:"Ed25519VerificationKey2020",controller:this.didPreview,publicKeyMultibase:"z6MkhaXgBZDvotDkL5257faiztiGiC2QtKLGpbnnEGta2doK"}],authentication:[`${this.didPreview}#keys-1`]};return this.didForm.useKeyAgreement&&(e.keyAgreement=[`${this.didPreview}#keys-2`],e.verificationMethod.push({id:`${this.didPreview}#keys-2`,type:"X25519KeyAgreementKey2020",controller:this.didPreview,publicKeyMultibase:"z6LSbysY2xFMRpGMhb7tFTLMpeuPRaqaWM1yECx2AtzE3KCc"})),this.didForm.useAssertionMethod&&(e.assertionMethod=[`${this.didPreview}#keys-1`]),this.didForm.useCapabilityInvocation&&(e.capabilityInvocation=[`${this.didPreview}#keys-1`]),JSON.stringify(e,null,2)}},mounted(){this.successModal=new this.$bootstrap.Modal(this.$refs.successModal)},methods:{useCurrentWallet(){this.isWalletConnected&&(this.didForm.ethereumAddress=this.address)},async createDID(){this.isSubmitting=!0;try{if("ethr"===this.didForm.method&&!this.didForm.ethereumAddress)throw new Error("请输入以太坊地址");if("web"===this.didForm.method&&!this.didForm.domain)throw new Error("请输入域名");await new Promise(e=>setTimeout(e,1500)),this.createdDID={did:this.didPreview,privateKey:"z6MkhaXgBZDvotDkL5257faiztiGiC2QtKLGpbnnEGta2doK_private_key_example",document:JSON.parse(this.didDocumentPreview),name:this.didForm.name,type:this.didForm.type,method:this.didForm.method,createdAt:(new Date).toISOString()},this.successModal.show(),this.$store.commit("notifications/add",{type:"success",message:"DID 创建成功！"})}catch(e){console.error("创建DID失败:",e),this.$store.commit("notifications/add",{type:"danger",message:"创建DID失败: "+e.message})}finally{this.isSubmitting=!1}},togglePrivateKeyVisibility(){this.showPrivateKey=!this.showPrivateKey},copyToClipboard(e){navigator.clipboard.writeText(e).then(()=>{this.$store.commit("notifications/add",{type:"success",message:"已复制到剪贴板"})},()=>{this.$store.commit("notifications/add",{type:"danger",message:"复制到剪贴板失败"})})},exportDIDDocument(){if(!this.createdDID)return;const e=JSON.stringify(this.createdDID.document,null,2),t=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(t),s=document.createElement("a");s.href=a,s.download=`${this.createdDID.did.replace(/:/g,"-")}.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a),this.$store.commit("notifications/add",{type:"success",message:"DID 文档已导出"})},goToDIDList(){this.successModal.hide(),this.$router.push("/did/list")}}},bd=(0,A.A)(md,[["render",ud],["__scopeId","data-v-1cc82f28"]]),kd=bd,pd={class:"doctor-did"},vd={class:"row"},hd={class:"col-md-6"},Ld={class:"card mb-4"},gd={class:"card-body"},yd={class:"mb-3"},fd={class:"mb-3"},Dd={class:"mb-3"},wd={class:"mb-3"},Id={class:"mb-3"},Cd={class:"mb-3"},Td={class:"mb-3"},Fd=["disabled"],Ed={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},_d={key:1,class:"bi bi-person-plus me-1"},Nd={class:"col-md-6"},xd={key:0,class:"card mb-4"},Sd={class:"card-body"},Rd={class:"mb-3"},Ad={class:"input-group"},Md=["value"],Wd={class:"mb-3"},Xd={class:"table-responsive"},Od={class:"table table-bordered"},qd={class:"d-grid gap-2"},$d=["disabled"],Pd={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},Kd={key:1,class:"bi bi-card-checklist me-1"},Ud={key:1,class:"card mb-4"},Vd={class:"card-body"},Qd={class:"mb-3"},jd={class:"input-group"},Bd=["value"],Gd={class:"mb-3"},Jd={class:"bg-light p-3 rounded"},zd={class:"d-grid gap-2"},Hd={key:2,class:"card"},Zd={class:"row"},Yd={class:"col-md-12"},ec={class:"card"},tc={class:"card-header d-flex justify-content-between align-items-center"},ac={class:"card-body"},sc={key:0,class:"text-center my-3"},lc={key:1,class:"text-center my-3"},ic={key:2,class:"table-responsive"},nc={class:"table"},oc=["title"],rc=["onClick"],dc=["onClick"],cc=["onClick"],uc={class:"modal fade",ref:"doctorDetailModal",tabindex:"-1"},mc={class:"modal-dialog modal-lg"},bc={class:"modal-content"},kc={key:0,class:"modal-body"},pc={class:"row"},vc={class:"col-md-6"},hc={class:"table-responsive"},Lc={class:"table table-bordered"},gc={class:"col-md-6"},yc={key:0},fc={key:0,class:"mb-3"},Dc={key:1,class:"mb-3"},wc={class:"bg-light p-3 rounded"},Ic={class:"modal-footer"};function Cc(e,t,a,i,n,o){const r=(0,l.g2)("router-link");return(0,l.uX)(),(0,l.CE)("div",pd,[t[68]||(t[68]=(0,l.Lk)("h2",null,[(0,l.Lk)("i",{class:"bi bi-hospital me-2"}),(0,l.eW)("医生DID集成")],-1)),t[69]||(t[69]=(0,l.Lk)("div",{class:"alert alert-info"},[(0,l.Lk)("i",{class:"bi bi-info-circle me-2"}),(0,l.Lk)("strong",null,"医生DID集成"),(0,l.eW)("允许医疗机构为医生创建分布式身份标识符(DID)和可验证凭证(VC)，以证明其专业资格和执业权限。 ")],-1)),(0,l.Lk)("div",vd,[(0,l.Lk)("div",hd,[(0,l.Lk)("div",Ld,[t[24]||(t[24]=(0,l.Lk)("div",{class:"card-header"},[(0,l.Lk)("h5",{class:"mb-0"},[(0,l.Lk)("i",{class:"bi bi-person-badge me-2"}),(0,l.eW)("医生DID创建")])],-1)),(0,l.Lk)("div",gd,[(0,l.Lk)("form",{onSubmit:t[7]||(t[7]=(0,s.D$)((...e)=>i.createDoctorDID&&i.createDoctorDID(...e),["prevent"]))},[(0,l.Lk)("div",yd,[t[14]||(t[14]=(0,l.Lk)("label",{for:"doctor-name",class:"form-label"},"医生姓名",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control",id:"doctor-name","onUpdate:modelValue":t[0]||(t[0]=e=>i.doctorForm.name=e),placeholder:"输入医生姓名",required:""},null,512),[[s.Jo,i.doctorForm.name]])]),(0,l.Lk)("div",fd,[t[15]||(t[15]=(0,l.Lk)("label",{for:"doctor-id",class:"form-label"},"医生ID",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control",id:"doctor-id","onUpdate:modelValue":t[1]||(t[1]=e=>i.doctorForm.id=e),placeholder:"输入医生ID",required:""},null,512),[[s.Jo,i.doctorForm.id]]),t[16]||(t[16]=(0,l.Lk)("div",{class:"form-text"}," 医生的唯一标识符，如医师执业证号。 ",-1))]),(0,l.Lk)("div",Dd,[t[17]||(t[17]=(0,l.Lk)("label",{for:"doctor-department",class:"form-label"},"科室",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control",id:"doctor-department","onUpdate:modelValue":t[2]||(t[2]=e=>i.doctorForm.department=e),placeholder:"输入科室",required:""},null,512),[[s.Jo,i.doctorForm.department]])]),(0,l.Lk)("div",wd,[t[18]||(t[18]=(0,l.Lk)("label",{for:"doctor-hospital",class:"form-label"},"医院",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control",id:"doctor-hospital","onUpdate:modelValue":t[3]||(t[3]=e=>i.doctorForm.hospital=e),placeholder:"输入医院名称",required:""},null,512),[[s.Jo,i.doctorForm.hospital]])]),(0,l.Lk)("div",Id,[t[20]||(t[20]=(0,l.Lk)("label",{for:"doctor-title",class:"form-label"},"职称",-1)),(0,l.bo)((0,l.Lk)("select",{class:"form-select",id:"doctor-title","onUpdate:modelValue":t[4]||(t[4]=e=>i.doctorForm.title=e),required:""},t[19]||(t[19]=[(0,l.Fv)('<option value="" disabled selected data-v-62bd98d1>选择职称</option><option value="住院医师" data-v-62bd98d1>住院医师</option><option value="主治医师" data-v-62bd98d1>主治医师</option><option value="副主任医师" data-v-62bd98d1>副主任医师</option><option value="主任医师" data-v-62bd98d1>主任医师</option>',5)]),512),[[s.u1,i.doctorForm.title]])]),(0,l.Lk)("div",Cd,[t[21]||(t[21]=(0,l.Lk)("label",{for:"doctor-license",class:"form-label"},"执业证书编号",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control",id:"doctor-license","onUpdate:modelValue":t[5]||(t[5]=e=>i.doctorForm.license=e),placeholder:"输入执业证书编号",required:""},null,512),[[s.Jo,i.doctorForm.license]])]),(0,l.Lk)("div",Td,[t[22]||(t[22]=(0,l.Lk)("label",{for:"doctor-specialties",class:"form-label"},"专长",-1)),(0,l.bo)((0,l.Lk)("textarea",{class:"form-control",id:"doctor-specialties","onUpdate:modelValue":t[6]||(t[6]=e=>i.doctorForm.specialties=e),rows:"3",placeholder:"输入医生专长，多个专长请用逗号分隔"},null,512),[[s.Jo,i.doctorForm.specialties]])]),(0,l.Lk)("button",{type:"submit",class:"btn btn-primary",disabled:i.isSubmitting},[i.isSubmitting?((0,l.uX)(),(0,l.CE)("span",Ed)):((0,l.uX)(),(0,l.CE)("i",_d)),t[23]||(t[23]=(0,l.eW)("创建医生DID "))],8,Fd)],32)])])]),(0,l.Lk)("div",Nd,[i.createdDoctorDID?((0,l.uX)(),(0,l.CE)("div",xd,[t[35]||(t[35]=(0,l.Lk)("div",{class:"card-header bg-success text-white"},[(0,l.Lk)("h5",{class:"mb-0"},[(0,l.Lk)("i",{class:"bi bi-check-circle me-2"}),(0,l.eW)("医生DID创建成功")])],-1)),(0,l.Lk)("div",Sd,[(0,l.Lk)("div",Rd,[t[26]||(t[26]=(0,l.Lk)("label",{class:"form-label"},"医生DID",-1)),(0,l.Lk)("div",Ad,[(0,l.Lk)("input",{type:"text",class:"form-control",readonly:"",value:i.createdDoctorDID.did},null,8,Md),(0,l.Lk)("button",{class:"btn btn-outline-primary",type:"button",onClick:t[8]||(t[8]=e=>i.copyToClipboard(i.createdDoctorDID.did))},t[25]||(t[25]=[(0,l.Lk)("i",{class:"bi bi-clipboard"},null,-1)]))])]),(0,l.Lk)("div",Wd,[t[33]||(t[33]=(0,l.Lk)("h6",null,"医生信息",-1)),(0,l.Lk)("div",Xd,[(0,l.Lk)("table",Od,[(0,l.Lk)("tbody",null,[(0,l.Lk)("tr",null,[t[27]||(t[27]=(0,l.Lk)("th",null,"姓名",-1)),(0,l.Lk)("td",null,(0,L.v_)(i.doctorForm.name),1)]),(0,l.Lk)("tr",null,[t[28]||(t[28]=(0,l.Lk)("th",null,"医生ID",-1)),(0,l.Lk)("td",null,(0,L.v_)(i.doctorForm.id),1)]),(0,l.Lk)("tr",null,[t[29]||(t[29]=(0,l.Lk)("th",null,"科室",-1)),(0,l.Lk)("td",null,(0,L.v_)(i.doctorForm.department),1)]),(0,l.Lk)("tr",null,[t[30]||(t[30]=(0,l.Lk)("th",null,"医院",-1)),(0,l.Lk)("td",null,(0,L.v_)(i.doctorForm.hospital),1)]),(0,l.Lk)("tr",null,[t[31]||(t[31]=(0,l.Lk)("th",null,"职称",-1)),(0,l.Lk)("td",null,(0,L.v_)(i.doctorForm.title),1)]),(0,l.Lk)("tr",null,[t[32]||(t[32]=(0,l.Lk)("th",null,"执业证书编号",-1)),(0,l.Lk)("td",null,(0,L.v_)(i.doctorForm.license),1)])])])])]),(0,l.Lk)("div",qd,[(0,l.Lk)("button",{class:"btn btn-primary",onClick:t[9]||(t[9]=(...e)=>i.issueCredential&&i.issueCredential(...e)),disabled:i.isIssuingVC},[i.isIssuingVC?((0,l.uX)(),(0,l.CE)("span",Pd)):((0,l.uX)(),(0,l.CE)("i",Kd)),t[34]||(t[34]=(0,l.eW)("颁发医生凭证 "))],8,$d)])])])):(0,l.Q3)("",!0),i.createdVC?((0,l.uX)(),(0,l.CE)("div",Ud,[t[41]||(t[41]=(0,l.Lk)("div",{class:"card-header bg-success text-white"},[(0,l.Lk)("h5",{class:"mb-0"},[(0,l.Lk)("i",{class:"bi bi-check-circle me-2"}),(0,l.eW)("医生凭证颁发成功")])],-1)),(0,l.Lk)("div",Vd,[(0,l.Lk)("div",Qd,[t[37]||(t[37]=(0,l.Lk)("label",{class:"form-label"},"凭证ID",-1)),(0,l.Lk)("div",jd,[(0,l.Lk)("input",{type:"text",class:"form-control",readonly:"",value:i.createdVC.id},null,8,Bd),(0,l.Lk)("button",{class:"btn btn-outline-primary",type:"button",onClick:t[10]||(t[10]=e=>i.copyToClipboard(i.createdVC.id))},t[36]||(t[36]=[(0,l.Lk)("i",{class:"bi bi-clipboard"},null,-1)]))])]),(0,l.Lk)("div",Gd,[t[38]||(t[38]=(0,l.Lk)("label",{class:"form-label"},"凭证内容",-1)),(0,l.Lk)("pre",Jd,(0,L.v_)(i.formattedVC),1)]),(0,l.Lk)("div",zd,[(0,l.Lk)("button",{class:"btn btn-primary",onClick:t[11]||(t[11]=(...e)=>i.downloadVC&&i.downloadVC(...e))},t[39]||(t[39]=[(0,l.Lk)("i",{class:"bi bi-download me-1"},null,-1),(0,l.eW)("下载凭证 ")])),(0,l.bF)(r,{to:{name:"VCManage"},class:"btn btn-outline-primary"},{default:(0,l.k6)(()=>t[40]||(t[40]=[(0,l.Lk)("i",{class:"bi bi-card-checklist me-1"},null,-1),(0,l.eW)("管理凭证 ")])),_:1,__:[40]})])])])):(0,l.Q3)("",!0),i.createdDoctorDID?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",Hd,t[42]||(t[42]=[(0,l.Fv)('<div class="card-header" data-v-62bd98d1><h5 class="mb-0" data-v-62bd98d1><i class="bi bi-info-circle me-2" data-v-62bd98d1></i>医生DID集成说明</h5></div><div class="card-body" data-v-62bd98d1><h6 data-v-62bd98d1>什么是医生DID?</h6><p data-v-62bd98d1> 医生DID是为医疗专业人员创建的分布式身份标识符，用于证明其身份和专业资格。通过DID和可验证凭证，医生可以安全地证明其专业资格，而无需依赖中央机构。 </p><h6 data-v-62bd98d1>使用场景</h6><ul data-v-62bd98d1><li data-v-62bd98d1><strong data-v-62bd98d1>医疗机构认证:</strong> 医院可以为其医生颁发可验证凭证，证明其在该医院的执业资格。</li><li data-v-62bd98d1><strong data-v-62bd98d1>跨机构协作:</strong> 医生可以使用DID在不同医疗机构之间安全地共享其专业资格。</li><li data-v-62bd98d1><strong data-v-62bd98d1>远程医疗:</strong> 患者可以验证远程医生的身份和资格。</li><li data-v-62bd98d1><strong data-v-62bd98d1>医学研究:</strong> 研究机构可以验证参与研究的医生的专业背景。</li></ul><h6 data-v-62bd98d1>创建流程</h6><ol data-v-62bd98d1><li data-v-62bd98d1>填写医生基本信息</li><li data-v-62bd98d1>系统为医生创建DID</li><li data-v-62bd98d1>医疗机构作为颁发者为医生颁发可验证凭证</li><li data-v-62bd98d1>医生可以使用DID和凭证证明其身份和专业资格</li></ol></div>',2)])))])]),(0,l.Lk)("div",Zd,[(0,l.Lk)("div",Yd,[(0,l.Lk)("div",ec,[(0,l.Lk)("div",tc,[t[44]||(t[44]=(0,l.Lk)("h5",{class:"mb-0"},[(0,l.Lk)("i",{class:"bi bi-list-check me-2"}),(0,l.eW)("医生DID列表")],-1)),(0,l.Lk)("button",{class:"btn btn-sm btn-outline-primary",onClick:t[12]||(t[12]=(...e)=>i.loadDoctorDIDs&&i.loadDoctorDIDs(...e))},t[43]||(t[43]=[(0,l.Lk)("i",{class:"bi bi-arrow-clockwise me-1"},null,-1),(0,l.eW)("刷新 ")]))]),(0,l.Lk)("div",ac,[i.isLoadingDoctors?((0,l.uX)(),(0,l.CE)("div",sc,t[45]||(t[45]=[(0,l.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,l.Lk)("span",{class:"visually-hidden"},"加载中...")],-1),(0,l.Lk)("p",{class:"mt-2"},"加载医生DID列表...",-1)]))):i.doctorDIDs.length?((0,l.uX)(),(0,l.CE)("div",ic,[(0,l.Lk)("table",nc,[t[50]||(t[50]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"姓名"),(0,l.Lk)("th",null,"医生ID"),(0,l.Lk)("th",null,"科室"),(0,l.Lk)("th",null,"医院"),(0,l.Lk)("th",null,"DID"),(0,l.Lk)("th",null,"凭证状态"),(0,l.Lk)("th",null,"操作")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.doctorDIDs,e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.id},[(0,l.Lk)("td",null,(0,L.v_)(e.name),1),(0,l.Lk)("td",null,(0,L.v_)(e.doctorId),1),(0,l.Lk)("td",null,(0,L.v_)(e.department),1),(0,l.Lk)("td",null,(0,L.v_)(e.hospital),1),(0,l.Lk)("td",null,[(0,l.Lk)("span",{title:e.did,class:"did-text"},(0,L.v_)(i.truncateDID(e.did)),9,oc),(0,l.Lk)("button",{class:"btn btn-sm btn-outline-secondary ms-1",onClick:t=>i.copyToClipboard(e.did)},t[47]||(t[47]=[(0,l.Lk)("i",{class:"bi bi-clipboard"},null,-1)]),8,rc)]),(0,l.Lk)("td",null,[(0,l.Lk)("span",{class:(0,L.C4)(["badge",e.hasVC?"bg-success":"bg-warning"])},(0,L.v_)(e.hasVC?"已颁发":"未颁发"),3)]),(0,l.Lk)("td",null,[(0,l.Lk)("button",{class:"btn btn-sm btn-primary me-1",onClick:t=>i.viewDoctorDID(e)},t[48]||(t[48]=[(0,l.Lk)("i",{class:"bi bi-eye"},null,-1)]),8,dc),e.hasVC?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("button",{key:0,class:"btn btn-sm btn-success",onClick:t=>i.issueDoctorCredential(e)},t[49]||(t[49]=[(0,l.Lk)("i",{class:"bi bi-card-checklist"},null,-1)]),8,cc))])]))),128))])])])):((0,l.uX)(),(0,l.CE)("div",lc,t[46]||(t[46]=[(0,l.Lk)("i",{class:"bi bi-person-badge fs-1 text-muted"},null,-1),(0,l.Lk)("p",{class:"lead mt-3"},"暂无医生DID记录",-1)])))])])])]),(0,l.Lk)("div",uc,[(0,l.Lk)("div",mc,[(0,l.Lk)("div",bc,[t[67]||(t[67]=(0,l.Lk)("div",{class:"modal-header"},[(0,l.Lk)("h5",{class:"modal-title"},"医生DID详情"),(0,l.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),i.selectedDoctor?((0,l.uX)(),(0,l.CE)("div",kc,[(0,l.Lk)("div",pc,[(0,l.Lk)("div",vc,[t[57]||(t[57]=(0,l.Lk)("h6",null,"基本信息",-1)),(0,l.Lk)("div",hc,[(0,l.Lk)("table",Lc,[(0,l.Lk)("tbody",null,[(0,l.Lk)("tr",null,[t[51]||(t[51]=(0,l.Lk)("th",null,"姓名",-1)),(0,l.Lk)("td",null,(0,L.v_)(i.selectedDoctor.name),1)]),(0,l.Lk)("tr",null,[t[52]||(t[52]=(0,l.Lk)("th",null,"医生ID",-1)),(0,l.Lk)("td",null,(0,L.v_)(i.selectedDoctor.doctorId),1)]),(0,l.Lk)("tr",null,[t[53]||(t[53]=(0,l.Lk)("th",null,"科室",-1)),(0,l.Lk)("td",null,(0,L.v_)(i.selectedDoctor.department),1)]),(0,l.Lk)("tr",null,[t[54]||(t[54]=(0,l.Lk)("th",null,"医院",-1)),(0,l.Lk)("td",null,(0,L.v_)(i.selectedDoctor.hospital),1)]),(0,l.Lk)("tr",null,[t[55]||(t[55]=(0,l.Lk)("th",null,"职称",-1)),(0,l.Lk)("td",null,(0,L.v_)(i.selectedDoctor.title),1)]),(0,l.Lk)("tr",null,[t[56]||(t[56]=(0,l.Lk)("th",null,"执业证书编号",-1)),(0,l.Lk)("td",null,(0,L.v_)(i.selectedDoctor.license),1)])])])])]),(0,l.Lk)("div",gc,[t[62]||(t[62]=(0,l.Lk)("h6",null,"DID信息",-1)),(0,l.Lk)("p",null,[t[58]||(t[58]=(0,l.Lk)("strong",null,"DID:",-1)),(0,l.eW)(" "+(0,L.v_)(i.selectedDoctor.did),1)]),(0,l.Lk)("p",null,[t[59]||(t[59]=(0,l.Lk)("strong",null,"创建时间:",-1)),(0,l.eW)(" "+(0,L.v_)(i.formatDate(i.selectedDoctor.createdAt)),1)]),(0,l.Lk)("p",null,[t[60]||(t[60]=(0,l.Lk)("strong",null,"凭证状态:",-1)),(0,l.Lk)("span",{class:(0,L.C4)(["badge",i.selectedDoctor.hasVC?"bg-success":"bg-warning"])},(0,L.v_)(i.selectedDoctor.hasVC?"已颁发":"未颁发"),3)]),i.selectedDoctor.vcId?((0,l.uX)(),(0,l.CE)("p",yc,[t[61]||(t[61]=(0,l.Lk)("strong",null,"凭证ID:",-1)),(0,l.eW)(" "+(0,L.v_)(i.selectedDoctor.vcId),1)])):(0,l.Q3)("",!0)])]),i.selectedDoctor.specialties?((0,l.uX)(),(0,l.CE)("div",fc,[t[63]||(t[63]=(0,l.Lk)("h6",null,"专长",-1)),(0,l.Lk)("p",null,(0,L.v_)(i.selectedDoctor.specialties),1)])):(0,l.Q3)("",!0),i.selectedDoctor.hasVC&&i.selectedDoctor.vc?((0,l.uX)(),(0,l.CE)("div",Dc,[t[64]||(t[64]=(0,l.Lk)("h6",null,"凭证内容",-1)),(0,l.Lk)("pre",wc,(0,L.v_)(JSON.stringify(i.selectedDoctor.vc,null,2)),1)])):(0,l.Q3)("",!0)])):(0,l.Q3)("",!0),(0,l.Lk)("div",Ic,[t[66]||(t[66]=(0,l.Lk)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"关闭",-1)),i.selectedDoctor&&!i.selectedDoctor.hasVC?((0,l.uX)(),(0,l.CE)("button",{key:0,type:"button",class:"btn btn-success",onClick:t[13]||(t[13]=e=>i.issueDoctorCredential(i.selectedDoctor))},t[65]||(t[65]=[(0,l.Lk)("i",{class:"bi bi-card-checklist me-1"},null,-1),(0,l.eW)("颁发凭证 ")]))):(0,l.Q3)("",!0)])])])],512)])}const Tc={name:"DoctorDID",setup(){const e=(0,h.Pj)(),t=(0,N.KR)(null);let a=null;const s=(0,N.KR)({name:"",id:"",department:"",hospital:"",title:"",license:"",specialties:""}),i=(0,N.KR)(null),n=(0,N.KR)(null),o=(0,N.KR)(!1),r=(0,N.KR)(!1),d=(0,N.KR)([]),c=(0,N.KR)(!1),u=(0,N.KR)(null),m=(0,l.EW)(()=>n.value?JSON.stringify(n.value,null,2):"{}"),b=async()=>{if(s.value.name&&s.value.id&&s.value.department&&s.value.hospital&&s.value.title&&s.value.license){o.value=!0;try{const t=await e.dispatch("did/createDoctorDID",{name:s.value.name,doctorId:s.value.id,department:s.value.department,hospital:s.value.hospital,title:s.value.title,license:s.value.license,specialties:s.value.specialties});t&&(i.value=t,e.dispatch("app/showSuccess","医生DID创建成功"),v())}finally{o.value=!1}}else e.dispatch("app/showError","请填写所有必填字段")},k=async()=>{if(i.value){r.value=!0;try{const t=await e.dispatch("did/issueDoctorCredential",{did:i.value.did,name:s.value.name,doctorId:s.value.id,department:s.value.department,hospital:s.value.hospital,title:s.value.title,license:s.value.license,specialties:s.value.specialties});t&&(n.value=t,e.dispatch("app/showSuccess","医生凭证颁发成功"),v())}finally{r.value=!1}}},p=async t=>{if(t){a&&a.hide(),r.value=!0;try{const a=await e.dispatch("did/issueDoctorCredential",{did:t.did,name:t.name,doctorId:t.doctorId,department:t.department,hospital:t.hospital,title:t.title,license:t.license,specialties:t.specialties});a&&(n.value=a,e.dispatch("app/showSuccess","医生凭证颁发成功"),v())}finally{r.value=!1}}},v=async()=>{c.value=!0;try{const t=await e.dispatch("did/loadDoctorDIDs");t&&(d.value=t)}finally{c.value=!1}},L=async t=>{if(u.value=t,t.hasVC&&t.vcId&&!t.vc)try{const a=await e.dispatch("did/getVC",t.vcId);a&&(u.value={...u.value,vc:a})}catch(s){console.error("加载凭证失败:",s)}a&&a.show()},g=()=>{if(!n.value)return;const e=JSON.stringify(n.value,null,2),t=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(t),s=document.createElement("a");s.href=a,s.download=`doctor-vc-${n.value.id.split(":").pop()}.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a)},y=t=>{navigator.clipboard.writeText(t).then(()=>{e.dispatch("app/showSuccess","已复制到剪贴板")}).catch(t=>{console.error("复制失败:",t),e.dispatch("app/showError","复制失败")})},f=e=>e?e.length<=30?e:e.substring(0,15)+"..."+e.substring(e.length-10):"",D=e=>{if(!e)return"";const t=new Date(e);return t.toLocaleString()};return(0,l.sV)(()=>{v(),t.value&&(a=new S.aF(t.value))}),{doctorForm:s,createdDoctorDID:i,createdVC:n,isSubmitting:o,isIssuingVC:r,doctorDIDs:d,isLoadingDoctors:c,selectedDoctor:u,formattedVC:m,doctorDetailModal:t,createDoctorDID:b,issueCredential:k,issueDoctorCredential:p,loadDoctorDIDs:v,viewDoctorDID:L,downloadVC:g,copyToClipboard:y,truncateDID:f,formatDate:D}}},Fc=(0,A.A)(Tc,[["render",Cc],["__scopeId","data-v-62bd98d1"]]),Ec=Fc,_c=[{path:"/",name:"Home",component:Ke},{path:"/nft",name:"NFTDashboard",component:Ze,children:[{path:"all",name:"AllNFTs",component:Oa},{path:"mint",name:"MintNFT",component:js},{path:"my",name:"MyNFTs",component:zl},{path:"metadata",name:"MetadataManager",component:Ri},{path:"requests",name:"RequestManager",component:dn},{path:"",redirect:{name:"AllNFTs"}}]},{path:"/abe",name:"ABEDashboard",component:rt,children:[{path:"setup",name:"ABESetup",component:Pn},{path:"keygen",name:"ABEKeyGen",component:co},{path:"",redirect:{name:"ABESetup"}}]},{path:"/did",name:"DIDDashboard",component:Lt,children:[{path:"list",name:"DIDList",component:Lr},{path:"create",name:"DIDCreate",component:kd},{path:"doctor",name:"DoctorDID",component:Ec},{path:"",redirect:{name:"DIDList"}}]},{path:"/:pathMatch(.*)*",name:"NotFound",component:Ct}],Nc=(0,x.aE)({history:(0,x.LA)("/"),routes:_c});Nc.beforeEach((e,t,a)=>{e.matched.some(e=>e.meta.requiresWallet)?ce.state.wallet.isConnected?a():(ce.commit("wallet/setRedirectRoute",e.fullPath),ce.commit("wallet/setShowConnectPrompt",!0),a({name:"Home"})):a()});const xc=Nc;var Sc=a(323);const Rc=(0,s.Ef)(B);Rc.config.globalProperties.$apiBaseUrl="/api",Rc.config.globalProperties.$bootstrap=Sc,Rc.use(xc),Rc.use(ce),Rc.mount("#app")}},t={};function a(s){var l=t[s];if(void 0!==l)return l.exports;var i=t[s]={exports:{}};return e[s].call(i.exports,i,i.exports,a),i.exports}a.m=e,(()=>{var e=[];a.O=(t,s,l,i)=>{if(!s){var n=1/0;for(c=0;c<e.length;c++){for(var[s,l,i]=e[c],o=!0,r=0;r<s.length;r++)(!1&i||n>=i)&&Object.keys(a.O).every(e=>a.O[e](s[r]))?s.splice(r--,1):(o=!1,i<n&&(n=i));if(o){e.splice(c--,1);var d=l();void 0!==d&&(t=d)}}return t}i=i||0;for(var c=e.length;c>0&&e[c-1][2]>i;c--)e[c]=e[c-1];e[c]=[s,l,i]}})(),(()=>{a.d=(e,t)=>{for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}})(),(()=>{a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})(),(()=>{a.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}})(),(()=>{var e={524:0};a.O.j=t=>0===e[t];var t=(t,s)=>{var l,i,[n,o,r]=s,d=0;if(n.some(t=>0!==e[t])){for(l in o)a.o(o,l)&&(a.m[l]=o[l]);if(r)var c=r(a)}for(t&&t(s);d<n.length;d++)i=n[d],a.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return a.O(c)},s=self["webpackChunknft_abe_frontend"]=self["webpackChunknft_abe_frontend"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var s=a.O(void 0,[504],()=>a(211));s=a.O(s)})();